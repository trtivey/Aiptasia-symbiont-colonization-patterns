---
title: "Figure 5 Chi-square comparisons"
author: "Trevor Tivey"
date: "2/4/2022"
output: html_document
---
# set up
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(data.table)
library(stringr)

```

# Creating all model comparisons
```{r}
asymptoteB <- c(909.0273,1094.558,1539.66,1649.232,1156.496,718.131,4784.066,1082.182,1823.272,1028.765,1439.063,1504.436)

midpointB <- c(13.3691,19.053,19.03,17.868,15.305,11.173,38.553,17.133,20.457,14.221,16.83,14.75)

scaleB <- c(3.2372,3.419,11.45,7.682,4.494,4.064,12.132,3.591,6.603,7.089,9.348,4.604)

Sample <- c("26B.1.4","26B.2.4","26B.3.4","26B.4.4","26B.5.4","26B.6.4","26B.7.4","26B.8.4","26B.9.4","26B.10.4","26B.11.4","26B.12.4")

logisdfB <- data.frame(Sample,asymptoteB,midpointB,scaleB)
```


```{r data set, include=FALSE}
# set up
setwd("./summarycsv")

popdata <- read.csv("Bmin_popmodel.csv", sep = ",", header = T)

popdatajoin <- merge(x=popdata,y=logisdfB,by="Sample",all=TRUE)


myvars <- c("Sample","Subsample", "initial.sample.day","clustersize","asymptoteB","midpointB","scaleB")

# subset and rename data set for input
cluster_init_data <- popdatajoin[myvars]

cluster_init_data <- cluster_init_data %>% dplyr::rename(
  sample = Sample,
  subsample = Subsample,
  day = initial.sample.day,
  size = clustersize,
  asymptote = asymptoteB,
  midpoint = midpointB,
  scale = scaleB
)

cluster_init_data$cells <- cut(cluster_init_data$size, breaks = c(0.001, 0.5, 1, 1.25, 2, 3, seq(3.501,1000.001,0.5)), labels = seq(1,1999,1), right = FALSE)

cluster_init_data$cells <- as.numeric(cluster_init_data$cells)

set.seed(34)
cluster_init_data %>% 
  group_by(sample) %>% sample_frac(0.33) -> cluster_sample_data_1

set.seed(256)
cluster_init_data %>% 
  group_by(sample) %>% sample_frac(0.33) -> cluster_sample_data_2

set.seed(88)
cluster_init_data %>% 
  group_by(sample) %>% sample_frac(0.33) -> cluster_sample_data_3
```




# Function to break initial day into new clusters for day 7 growth, apply growth rate to match observed linear model
# modify tsqrt variable to ^1/2, ^1/4, ^1/8, ^1/16


```{r migrate cluster logistic function}
##_______
# Warning: returns "output.df" to Global Environment

# inputs needed:
# input data with a column for $sample and $size
# migration rate i.e. probability of any cell to migrate
# initial day
# final day

migrate.cluster.log.sqrt <- function(input.df, migration.rate, initial.day, final.day, subsample) {

# input.df needs to contain columns titled 'sample', 'size'
  
# set up empty data frames  
df.final = data.frame()
df.temp = data.frame()
start.day <- initial.day
end.day <- final.day
migrate.rate <- migration.rate
subsample <- subsample

# for loop to calculate amount of migration from each cluster
for(i in 1:nrow(input.df)) {
  
  # variable selection
  sample.name <- input.df$sample[i]
  start.cells <- input.df$cells[i]
  asymp <- input.df$asymptote[i]
  midp <- input.df$midpoint[i]
  sca <- input.df$scale[i]
  

  # variable classification
  sample.name <- as.character(sample.name)
  start.cells <- as.numeric(start.cells)
  start.day <- as.numeric(start.day)
  end.day <- as.numeric(end.day)
  asymp <- as.numeric(asymp)
  midp <- as.numeric(midp)
  sca <- as.numeric(sca)
  
  if(start.day  <  end.day) {
    
# apply migration probability
# returns a binary vector of which cells have migrated

bern.trial <- rbinom(start.cells,1,migrate.rate)

# randomize singlet sizes within size distribution of singlets
size.randomizer <- runif(start.cells,min=1, max=1.49)    

# apply sizes to migrating cells
migrate.vector <- bern.trial * size.randomizer

# define new size of original cluster
end.size.vector <- start.cells - sum(migrate.vector)


# generate list of newly migrated clusters and original cluster

if(end.size.vector > 0 && sum(migrate.vector) > 0){
  migrate.vector.select <- migrate.vector[migrate.vector > 0.9]
  new.cells <- c(migrate.vector.select, end.size.vector)
  did.it.migrate <- "Yes"
  # create temporary df for new sizes
  df.temp <- data.frame(sample.name, start.day, end.day, new.cells, did.it.migrate, asymp, midp, sca)
  # append temporary df to summary df containing clusters for entire sample
  df.final <- bind_rows(df.final,df.temp)
  
} else{
  # original cluster size continues to exist without migration event
  new.cells <- c(start.cells)
  did.it.migrate <- "No"
  # create temporary df for original cluster
  df.temp <- data.frame(sample.name, start.day, end.day, new.cells, did.it.migrate, asymp, midp, sca)
  # append temporary df to summary df containing clusters for entire sample
  df.final <- bind_rows(df.final,df.temp)
} 

} else{
    # not enough time has passed, return the same list of objects as input
    new.cells <- c(start.cells)
    did.it.migrate <- "No"
    # create temporary df for original cluster
    df.temp <- data.frame(sample.name, start.day, end.day, new.cells, did.it.migrate, asymp, midp, sca)
    # append temporary df to summary df containing clusters for entire sample
    df.final <- bind_rows(df.final,df.temp)
    }  
  }

# optional summary check to console before applying growth rate
print("post-migration: input and output cell sum total should be equal")
print(sum(input.df$cells))
print(sum(df.final$new.cells))
print("output cluster number should increase")
print(nrow(input.df))
print(nrow(df.final))


# applying growth rate
# lm general to all, not specific to each sample
# take generated size distributions and add growth rate to form new clusters sizes
#d7_final_lm <- df.final

#write.csv(df.final, file = paste("migrate", migrate.rate, start.day, end.day, "postmigration.csv", sep = "-"))

# add columns to df.final: total cluster number, 

# hist sum and asym model are in total cells
# newsizes are not cut yet

output.df <- data.frame()

if(start.day  <  end.day) {
df.final %>% 
  group_by(end.day, sample.name) %>% 
  mutate(sample = sample.name,
         start.sum = sum(new.cells),
         model.start.sum = (asymp/(1+exp((midp - start.day)/sca))),
         model.end.sum = (asymp/(1+exp((midp - end.day)/sca))),
         pop.growth = model.end.sum - start.sum,
         perc.clust = new.cells / start.sum,
         
         tsqrt = (new.cells)^(1/2),
         tsqrtnorm = tsqrt/sum(tsqrt),
         
         cells = new.cells + (pop.growth)*tsqrtnorm,
         asymptote = asymp,
         midpoint = midp,
         scale = sca,
         Subsample = subsample
         ) -> output.df

# SSlogis vector output = Asym/(1+exp((xmid-input)/scal))
  #y ~ SSlogis(log(x), Asym, xmid, scal),
#              se = FALSE,
#              method.args = list(start = list(Asym = 2750.5520, xmid = # 3.6170, scal = 0.6951)
write.csv(output.df, file = paste(migrate.rate, start.day, end.day, subsample, "postgrowth.csv", sep = "-"))

} else{
  df.final %>% 
  group_by(end.day, sample.name) %>% 
  mutate(sample = sample.name,
         start.sum = sum(new.cells),
         model.start.sum = (asymp/(1+exp((midp - start.day)/sca))),
         model.end.sum = (asymp/(1+exp((midp - end.day)/sca))),
         pop.growth = model.end.sum - start.sum,
         perc.clust = new.cells / start.sum,
         
         tsqrt = (new.cells)^(1/2),
         tsqrtnorm = tsqrt/sum(tsqrt),
         
         cells = new.cells,
         asymptote = asymp,
         midpoint = midp,
         scale = sca,
         Subsample = subsample
         ) -> output.df
  

  
  
  
# SSlogis vector output = Asym/(1+exp((xmid-input)/scal))
  #y ~ SSlogis(log(x), Asym, xmid, scal),
#              se = FALSE,
#              method.args = list(start = list(Asym = 2750.5520, xmid = # 3.6170, scal = 0.6951)
write.csv(output.df, file = paste(migrate.rate, start.day, end.day, subsample, "postgrowth.csv", sep = "-"))
}

print("post-growth: output cell sum total should increase")
print(sum(df.final$new.cells))
print(sum(output.df$cells))
print("input and output cluster number should be equal")
print(nrow(output.df))
print(nrow(output.df))

print("next day input file is output.df, which is saved as ... ")
print(paste(migration.rate, start.day, end.day, subsample, "postgrowth.csv", sep = "-"))

# return output.df to Global environment for next input
assign("output.df", output.df, envir=.GlobalEnv)
return(output.df)

}

```



```{r, echo = F, include = F, results = F}
setwd("./summarycsv/migration_models/sqrt/mr0.1/")
migrate.cluster.log.sqrt(cluster_sample_data_1,0.1,4,4,1)
migrate.cluster.log.sqrt(output.df,0.1,4,5,1)
migrate.cluster.log.sqrt(output.df,0.1,5,6,1)
migrate.cluster.log.sqrt(output.df,0.1,6,7,1)
migrate.cluster.log.sqrt(output.df,0.1,7,8,1)
migrate.cluster.log.sqrt(output.df,0.1,8,9,1)
migrate.cluster.log.sqrt(output.df,0.1,9,10,1)
migrate.cluster.log.sqrt(output.df,0.1,10,11,1)
migrate.cluster.log.sqrt(output.df,0.1,11,12,1)
migrate.cluster.log.sqrt(output.df,0.1,12,13,1)
migrate.cluster.log.sqrt(output.df,0.1,13,14,1)
migrate.cluster.log.sqrt(output.df,0.1,14,15,1)
migrate.cluster.log.sqrt(output.df,0.1,15,16,1)
migrate.cluster.log.sqrt(output.df,0.1,16,17,1)
migrate.cluster.log.sqrt(output.df,0.1,17,18,1)
migrate.cluster.log.sqrt(output.df,0.1,18,19,1)
migrate.cluster.log.sqrt(output.df,0.1,19,20,1)
migrate.cluster.log.sqrt(output.df,0.1,20,21,1)
migrate.cluster.log.sqrt(output.df,0.1,21,22,1)
migrate.cluster.log.sqrt(output.df,0.1,22,23,1)
migrate.cluster.log.sqrt(output.df,0.1,23,24,1)
migrate.cluster.log.sqrt(output.df,0.1,24,25,1)
migrate.cluster.log.sqrt(output.df,0.1,25,26,1)
migrate.cluster.log.sqrt(output.df,0.1,26,27,1)
migrate.cluster.log.sqrt(output.df,0.1,27,28,1)
migrate.cluster.log.sqrt(output.df,0.1,28,29,1)
migrate.cluster.log.sqrt(output.df,0.1,29,30,1)
migrate.cluster.log.sqrt(output.df,0.1,30,31,1)
migrate.cluster.log.sqrt(output.df,0.1,31,32,1)
migrate.cluster.log.sqrt(output.df,0.1,32,33,1)

```

```{r, echo = F, include = F, results = F}
setwd("./summarycsv/migration_models/sqrt/mr0.1/")
migrate.cluster.log.sqrt(cluster_sample_data_2,0.1,4,4,2)
migrate.cluster.log.sqrt(output.df,0.1,4,5,2)
migrate.cluster.log.sqrt(output.df,0.1,5,6,2)
migrate.cluster.log.sqrt(output.df,0.1,6,7,2)
migrate.cluster.log.sqrt(output.df,0.1,7,8,2)
migrate.cluster.log.sqrt(output.df,0.1,8,9,2)
migrate.cluster.log.sqrt(output.df,0.1,9,10,2)
migrate.cluster.log.sqrt(output.df,0.1,10,11,2)
migrate.cluster.log.sqrt(output.df,0.1,11,12,2)
migrate.cluster.log.sqrt(output.df,0.1,12,13,2)
migrate.cluster.log.sqrt(output.df,0.1,13,14,2)
migrate.cluster.log.sqrt(output.df,0.1,14,15,2)
migrate.cluster.log.sqrt(output.df,0.1,15,16,2)
migrate.cluster.log.sqrt(output.df,0.1,16,17,2)
migrate.cluster.log.sqrt(output.df,0.1,17,18,2)
migrate.cluster.log.sqrt(output.df,0.1,18,19,2)
migrate.cluster.log.sqrt(output.df,0.1,19,20,2)
migrate.cluster.log.sqrt(output.df,0.1,20,21,2)
migrate.cluster.log.sqrt(output.df,0.1,21,22,2)
migrate.cluster.log.sqrt(output.df,0.1,22,23,2)
migrate.cluster.log.sqrt(output.df,0.1,23,24,2)
migrate.cluster.log.sqrt(output.df,0.1,24,25,2)
migrate.cluster.log.sqrt(output.df,0.1,25,26,2)
migrate.cluster.log.sqrt(output.df,0.1,26,27,2)
migrate.cluster.log.sqrt(output.df,0.1,27,28,2)
migrate.cluster.log.sqrt(output.df,0.1,28,29,2)
migrate.cluster.log.sqrt(output.df,0.1,29,30,2)
migrate.cluster.log.sqrt(output.df,0.1,30,31,2)
migrate.cluster.log.sqrt(output.df,0.1,31,32,2)
migrate.cluster.log.sqrt(output.df,0.1,32,33,2)

```

```{r, echo = F, include = F, results = F}
setwd("./summarycsv/migration_models/sqrt/mr0.1/")
migrate.cluster.log.sqrt(cluster_sample_data_3,0.1,4,4,3)
migrate.cluster.log.sqrt(output.df,0.1,4,5,3)
migrate.cluster.log.sqrt(output.df,0.1,5,6,3)
migrate.cluster.log.sqrt(output.df,0.1,6,7,3)
migrate.cluster.log.sqrt(output.df,0.1,7,8,3)
migrate.cluster.log.sqrt(output.df,0.1,8,9,3)
migrate.cluster.log.sqrt(output.df,0.1,9,10,3)
migrate.cluster.log.sqrt(output.df,0.1,10,11,3)
migrate.cluster.log.sqrt(output.df,0.1,11,12,3)
migrate.cluster.log.sqrt(output.df,0.1,12,13,3)
migrate.cluster.log.sqrt(output.df,0.1,13,14,3)
migrate.cluster.log.sqrt(output.df,0.1,14,15,3)
migrate.cluster.log.sqrt(output.df,0.1,15,16,3)
migrate.cluster.log.sqrt(output.df,0.1,16,17,3)
migrate.cluster.log.sqrt(output.df,0.1,17,18,3)
migrate.cluster.log.sqrt(output.df,0.1,18,19,3)
migrate.cluster.log.sqrt(output.df,0.1,19,20,3)
migrate.cluster.log.sqrt(output.df,0.1,20,21,3)
migrate.cluster.log.sqrt(output.df,0.1,21,22,3)
migrate.cluster.log.sqrt(output.df,0.1,22,23,3)
migrate.cluster.log.sqrt(output.df,0.1,23,24,3)
migrate.cluster.log.sqrt(output.df,0.1,24,25,3)
migrate.cluster.log.sqrt(output.df,0.1,25,26,3)
migrate.cluster.log.sqrt(output.df,0.1,26,27,3)
migrate.cluster.log.sqrt(output.df,0.1,27,28,3)
migrate.cluster.log.sqrt(output.df,0.1,28,29,3)
migrate.cluster.log.sqrt(output.df,0.1,29,30,3)
migrate.cluster.log.sqrt(output.df,0.1,30,31,3)
migrate.cluster.log.sqrt(output.df,0.1,31,32,3)
migrate.cluster.log.sqrt(output.df,0.1,32,33,3)

```


```{r, include=FALSE, results= FALSE}
setwd("./summarycsv/migration_models/sqrt/mr0.015/")
migrate.cluster.log.sqrt(cluster_sample_data_1,0.015,4,4,1)
migrate.cluster.log.sqrt(output.df,0.015,4,5,1)
migrate.cluster.log.sqrt(output.df,0.015,5,6,1)
migrate.cluster.log.sqrt(output.df,0.015,6,7,1)
migrate.cluster.log.sqrt(output.df,0.015,7,8,1)
migrate.cluster.log.sqrt(output.df,0.015,8,9,1)
migrate.cluster.log.sqrt(output.df,0.015,9,10,1)
migrate.cluster.log.sqrt(output.df,0.015,10,11,1)
migrate.cluster.log.sqrt(output.df,0.015,11,12,1)
migrate.cluster.log.sqrt(output.df,0.015,12,13,1)
migrate.cluster.log.sqrt(output.df,0.015,13,14,1)
migrate.cluster.log.sqrt(output.df,0.015,14,15,1)
migrate.cluster.log.sqrt(output.df,0.015,15,16,1)
migrate.cluster.log.sqrt(output.df,0.015,16,17,1)
migrate.cluster.log.sqrt(output.df,0.015,17,18,1)
migrate.cluster.log.sqrt(output.df,0.015,18,19,1)
migrate.cluster.log.sqrt(output.df,0.015,19,20,1)
migrate.cluster.log.sqrt(output.df,0.015,20,21,1)
migrate.cluster.log.sqrt(output.df,0.015,21,22,1)
migrate.cluster.log.sqrt(output.df,0.015,22,23,1)
migrate.cluster.log.sqrt(output.df,0.015,23,24,1)
migrate.cluster.log.sqrt(output.df,0.015,24,25,1)
migrate.cluster.log.sqrt(output.df,0.015,25,26,1)
migrate.cluster.log.sqrt(output.df,0.015,26,27,1)
migrate.cluster.log.sqrt(output.df,0.015,27,28,1)
migrate.cluster.log.sqrt(output.df,0.015,28,29,1)
migrate.cluster.log.sqrt(output.df,0.015,29,30,1)
migrate.cluster.log.sqrt(output.df,0.015,30,31,1)
migrate.cluster.log.sqrt(output.df,0.015,31,32,1)
migrate.cluster.log.sqrt(output.df,0.015,32,33,1)

```


```{r, include=FALSE, results= FALSE}
setwd("./summarycsv/migration_models/sqrt/mr0.015/")
migrate.cluster.log.sqrt(cluster_sample_data_2,0.015,4,4,2)
migrate.cluster.log.sqrt(output.df,0.015,4,5,2)
migrate.cluster.log.sqrt(output.df,0.015,5,6,2)
migrate.cluster.log.sqrt(output.df,0.015,6,7,2)
migrate.cluster.log.sqrt(output.df,0.015,7,8,2)
migrate.cluster.log.sqrt(output.df,0.015,8,9,2)
migrate.cluster.log.sqrt(output.df,0.015,9,10,2)
migrate.cluster.log.sqrt(output.df,0.015,10,11,2)
migrate.cluster.log.sqrt(output.df,0.015,11,12,2)
migrate.cluster.log.sqrt(output.df,0.015,12,13,2)
migrate.cluster.log.sqrt(output.df,0.015,13,14,2)
migrate.cluster.log.sqrt(output.df,0.015,14,15,2)
migrate.cluster.log.sqrt(output.df,0.015,15,16,2)
migrate.cluster.log.sqrt(output.df,0.015,16,17,2)
migrate.cluster.log.sqrt(output.df,0.015,17,18,2)
migrate.cluster.log.sqrt(output.df,0.015,18,19,2)
migrate.cluster.log.sqrt(output.df,0.015,19,20,2)
migrate.cluster.log.sqrt(output.df,0.015,20,21,2)
migrate.cluster.log.sqrt(output.df,0.015,21,22,2)
migrate.cluster.log.sqrt(output.df,0.015,22,23,2)
migrate.cluster.log.sqrt(output.df,0.015,23,24,2)
migrate.cluster.log.sqrt(output.df,0.015,24,25,2)
migrate.cluster.log.sqrt(output.df,0.015,25,26,2)
migrate.cluster.log.sqrt(output.df,0.015,26,27,2)
migrate.cluster.log.sqrt(output.df,0.015,27,28,2)
migrate.cluster.log.sqrt(output.df,0.015,28,29,2)
migrate.cluster.log.sqrt(output.df,0.015,29,30,2)
migrate.cluster.log.sqrt(output.df,0.015,30,31,2)
migrate.cluster.log.sqrt(output.df,0.015,31,32,2)
migrate.cluster.log.sqrt(output.df,0.015,32,33,2)

```



```{r, include=FALSE, results= FALSE}
setwd("./summarycsv/migration_models/sqrt/mr0.015/")
migrate.cluster.log.sqrt(cluster_sample_data_3,0.015,4,4,3)
migrate.cluster.log.sqrt(output.df,0.015,4,5,3)
migrate.cluster.log.sqrt(output.df,0.015,5,6,3)
migrate.cluster.log.sqrt(output.df,0.015,6,7,3)
migrate.cluster.log.sqrt(output.df,0.015,7,8,3)
migrate.cluster.log.sqrt(output.df,0.015,8,9,3)
migrate.cluster.log.sqrt(output.df,0.015,9,10,3)
migrate.cluster.log.sqrt(output.df,0.015,10,11,3)
migrate.cluster.log.sqrt(output.df,0.015,11,12,3)
migrate.cluster.log.sqrt(output.df,0.015,12,13,3)
migrate.cluster.log.sqrt(output.df,0.015,13,14,3)
migrate.cluster.log.sqrt(output.df,0.015,14,15,3)
migrate.cluster.log.sqrt(output.df,0.015,15,16,3)
migrate.cluster.log.sqrt(output.df,0.015,16,17,3)
migrate.cluster.log.sqrt(output.df,0.015,17,18,3)
migrate.cluster.log.sqrt(output.df,0.015,18,19,3)
migrate.cluster.log.sqrt(output.df,0.015,19,20,3)
migrate.cluster.log.sqrt(output.df,0.015,20,21,3)
migrate.cluster.log.sqrt(output.df,0.015,21,22,3)
migrate.cluster.log.sqrt(output.df,0.015,22,23,3)
migrate.cluster.log.sqrt(output.df,0.015,23,24,3)
migrate.cluster.log.sqrt(output.df,0.015,24,25,3)
migrate.cluster.log.sqrt(output.df,0.015,25,26,3)
migrate.cluster.log.sqrt(output.df,0.015,26,27,3)
migrate.cluster.log.sqrt(output.df,0.015,27,28,3)
migrate.cluster.log.sqrt(output.df,0.015,28,29,3)
migrate.cluster.log.sqrt(output.df,0.015,29,30,3)
migrate.cluster.log.sqrt(output.df,0.015,30,31,3)
migrate.cluster.log.sqrt(output.df,0.015,31,32,3)
migrate.cluster.log.sqrt(output.df,0.015,32,33,3)

```

```{r, include=FALSE, results= FALSE}
setwd("./summarycsv/migration_models/sqrt/mr0.01/")
migrate.cluster.log.sqrt(cluster_sample_data_1,0.01,4,4,1)
migrate.cluster.log.sqrt(output.df,0.01,4,5,1)
migrate.cluster.log.sqrt(output.df,0.01,5,6,1)
migrate.cluster.log.sqrt(output.df,0.01,6,7,1)
migrate.cluster.log.sqrt(output.df,0.01,7,8,1)
migrate.cluster.log.sqrt(output.df,0.01,8,9,1)
migrate.cluster.log.sqrt(output.df,0.01,9,10,1)
migrate.cluster.log.sqrt(output.df,0.01,10,11,1)
migrate.cluster.log.sqrt(output.df,0.01,11,12,1)
migrate.cluster.log.sqrt(output.df,0.01,12,13,1)
migrate.cluster.log.sqrt(output.df,0.01,13,14,1)
migrate.cluster.log.sqrt(output.df,0.01,14,15,1)
migrate.cluster.log.sqrt(output.df,0.01,15,16,1)
migrate.cluster.log.sqrt(output.df,0.01,16,17,1)
migrate.cluster.log.sqrt(output.df,0.01,17,18,1)
migrate.cluster.log.sqrt(output.df,0.01,18,19,1)
migrate.cluster.log.sqrt(output.df,0.01,19,20,1)
migrate.cluster.log.sqrt(output.df,0.01,20,21,1)
migrate.cluster.log.sqrt(output.df,0.01,21,22,1)
migrate.cluster.log.sqrt(output.df,0.01,22,23,1)
migrate.cluster.log.sqrt(output.df,0.01,23,24,1)
migrate.cluster.log.sqrt(output.df,0.01,24,25,1)
migrate.cluster.log.sqrt(output.df,0.01,25,26,1)
migrate.cluster.log.sqrt(output.df,0.01,26,27,1)
migrate.cluster.log.sqrt(output.df,0.01,27,28,1)
migrate.cluster.log.sqrt(output.df,0.01,28,29,1)
migrate.cluster.log.sqrt(output.df,0.01,29,30,1)
migrate.cluster.log.sqrt(output.df,0.01,30,31,1)
migrate.cluster.log.sqrt(output.df,0.01,31,32,1)
migrate.cluster.log.sqrt(output.df,0.01,32,33,1)

```



```{r, include=FALSE, results= FALSE}
setwd("./summarycsv/migration_models/sqrt/mr0.01/")
migrate.cluster.log.sqrt(cluster_sample_data_2,0.01,4,4,2)
migrate.cluster.log.sqrt(output.df,0.01,4,5,2)
migrate.cluster.log.sqrt(output.df,0.01,5,6,2)
migrate.cluster.log.sqrt(output.df,0.01,6,7,2)
migrate.cluster.log.sqrt(output.df,0.01,7,8,2)
migrate.cluster.log.sqrt(output.df,0.01,8,9,2)
migrate.cluster.log.sqrt(output.df,0.01,9,10,2)
migrate.cluster.log.sqrt(output.df,0.01,10,11,2)
migrate.cluster.log.sqrt(output.df,0.01,11,12,2)
migrate.cluster.log.sqrt(output.df,0.01,12,13,2)
migrate.cluster.log.sqrt(output.df,0.01,13,14,2)
migrate.cluster.log.sqrt(output.df,0.01,14,15,2)
migrate.cluster.log.sqrt(output.df,0.01,15,16,2)
migrate.cluster.log.sqrt(output.df,0.01,16,17,2)
migrate.cluster.log.sqrt(output.df,0.01,17,18,2)
migrate.cluster.log.sqrt(output.df,0.01,18,19,2)
migrate.cluster.log.sqrt(output.df,0.01,19,20,2)
migrate.cluster.log.sqrt(output.df,0.01,20,21,2)
migrate.cluster.log.sqrt(output.df,0.01,21,22,2)
migrate.cluster.log.sqrt(output.df,0.01,22,23,2)
migrate.cluster.log.sqrt(output.df,0.01,23,24,2)
migrate.cluster.log.sqrt(output.df,0.01,24,25,2)
migrate.cluster.log.sqrt(output.df,0.01,25,26,2)
migrate.cluster.log.sqrt(output.df,0.01,26,27,2)
migrate.cluster.log.sqrt(output.df,0.01,27,28,2)
migrate.cluster.log.sqrt(output.df,0.01,28,29,2)
migrate.cluster.log.sqrt(output.df,0.01,29,30,2)
migrate.cluster.log.sqrt(output.df,0.01,30,31,2)
migrate.cluster.log.sqrt(output.df,0.01,31,32,2)
migrate.cluster.log.sqrt(output.df,0.01,32,33,2)

```


```{r, include=FALSE, results= FALSE}
setwd("./summarycsv/migration_models/sqrt/mr0.01/")
migrate.cluster.log.sqrt(cluster_sample_data_3,0.01,4,4,3)
migrate.cluster.log.sqrt(output.df,0.01,4,5,3)
migrate.cluster.log.sqrt(output.df,0.01,5,6,3)
migrate.cluster.log.sqrt(output.df,0.01,6,7,3)
migrate.cluster.log.sqrt(output.df,0.01,7,8,3)
migrate.cluster.log.sqrt(output.df,0.01,8,9,3)
migrate.cluster.log.sqrt(output.df,0.01,9,10,3)
migrate.cluster.log.sqrt(output.df,0.01,10,11,3)
migrate.cluster.log.sqrt(output.df,0.01,11,12,3)
migrate.cluster.log.sqrt(output.df,0.01,12,13,3)
migrate.cluster.log.sqrt(output.df,0.01,13,14,3)
migrate.cluster.log.sqrt(output.df,0.01,14,15,3)
migrate.cluster.log.sqrt(output.df,0.01,15,16,3)
migrate.cluster.log.sqrt(output.df,0.01,16,17,3)
migrate.cluster.log.sqrt(output.df,0.01,17,18,3)
migrate.cluster.log.sqrt(output.df,0.01,18,19,3)
migrate.cluster.log.sqrt(output.df,0.01,19,20,3)
migrate.cluster.log.sqrt(output.df,0.01,20,21,3)
migrate.cluster.log.sqrt(output.df,0.01,21,22,3)
migrate.cluster.log.sqrt(output.df,0.01,22,23,3)
migrate.cluster.log.sqrt(output.df,0.01,23,24,3)
migrate.cluster.log.sqrt(output.df,0.01,24,25,3)
migrate.cluster.log.sqrt(output.df,0.01,25,26,3)
migrate.cluster.log.sqrt(output.df,0.01,26,27,3)
migrate.cluster.log.sqrt(output.df,0.01,27,28,3)
migrate.cluster.log.sqrt(output.df,0.01,28,29,3)
migrate.cluster.log.sqrt(output.df,0.01,29,30,3)
migrate.cluster.log.sqrt(output.df,0.01,30,31,3)
migrate.cluster.log.sqrt(output.df,0.01,31,32,3)
migrate.cluster.log.sqrt(output.df,0.01,32,33,3)

```



```{r, include=FALSE, results= FALSE}
setwd("./summarycsv/migration_models/sqrt/mr0.02/")
migrate.cluster.log.sqrt(cluster_sample_data_1,0.02,4,4,1)
migrate.cluster.log.sqrt(output.df,0.02,4,5,1)
migrate.cluster.log.sqrt(output.df,0.02,5,6,1)
migrate.cluster.log.sqrt(output.df,0.02,6,7,1)
migrate.cluster.log.sqrt(output.df,0.02,7,8,1)
migrate.cluster.log.sqrt(output.df,0.02,8,9,1)
migrate.cluster.log.sqrt(output.df,0.02,9,10,1)
migrate.cluster.log.sqrt(output.df,0.02,10,11,1)
migrate.cluster.log.sqrt(output.df,0.02,11,12,1)
migrate.cluster.log.sqrt(output.df,0.02,12,13,1)
migrate.cluster.log.sqrt(output.df,0.02,13,14,1)
migrate.cluster.log.sqrt(output.df,0.02,14,15,1)
migrate.cluster.log.sqrt(output.df,0.02,15,16,1)
migrate.cluster.log.sqrt(output.df,0.02,16,17,1)
migrate.cluster.log.sqrt(output.df,0.02,17,18,1)
migrate.cluster.log.sqrt(output.df,0.02,18,19,1)
migrate.cluster.log.sqrt(output.df,0.02,19,20,1)
migrate.cluster.log.sqrt(output.df,0.02,20,21,1)
migrate.cluster.log.sqrt(output.df,0.02,21,22,1)
migrate.cluster.log.sqrt(output.df,0.02,22,23,1)
migrate.cluster.log.sqrt(output.df,0.02,23,24,1)
migrate.cluster.log.sqrt(output.df,0.02,24,25,1)
migrate.cluster.log.sqrt(output.df,0.02,25,26,1)
migrate.cluster.log.sqrt(output.df,0.02,26,27,1)
migrate.cluster.log.sqrt(output.df,0.02,27,28,1)
migrate.cluster.log.sqrt(output.df,0.02,28,29,1)
migrate.cluster.log.sqrt(output.df,0.02,29,30,1)
migrate.cluster.log.sqrt(output.df,0.02,30,31,1)
migrate.cluster.log.sqrt(output.df,0.02,31,32,1)
migrate.cluster.log.sqrt(output.df,0.02,32,33,1)

```


```{r, include=FALSE, results= FALSE}
setwd("./summarycsv/migration_models/sqrt/mr0.02/")
migrate.cluster.log.sqrt(cluster_sample_data_2,0.02,4,4,2)
migrate.cluster.log.sqrt(output.df,0.02,4,5,2)
migrate.cluster.log.sqrt(output.df,0.02,5,6,2)
migrate.cluster.log.sqrt(output.df,0.02,6,7,2)
migrate.cluster.log.sqrt(output.df,0.02,7,8,2)
migrate.cluster.log.sqrt(output.df,0.02,8,9,2)
migrate.cluster.log.sqrt(output.df,0.02,9,10,2)
migrate.cluster.log.sqrt(output.df,0.02,10,11,2)
migrate.cluster.log.sqrt(output.df,0.02,11,12,2)
migrate.cluster.log.sqrt(output.df,0.02,12,13,2)
migrate.cluster.log.sqrt(output.df,0.02,13,14,2)
migrate.cluster.log.sqrt(output.df,0.02,14,15,2)
migrate.cluster.log.sqrt(output.df,0.02,15,16,2)
migrate.cluster.log.sqrt(output.df,0.02,16,17,2)
migrate.cluster.log.sqrt(output.df,0.02,17,18,2)
migrate.cluster.log.sqrt(output.df,0.02,18,19,2)
migrate.cluster.log.sqrt(output.df,0.02,19,20,2)
migrate.cluster.log.sqrt(output.df,0.02,20,21,2)
migrate.cluster.log.sqrt(output.df,0.02,21,22,2)
migrate.cluster.log.sqrt(output.df,0.02,22,23,2)
migrate.cluster.log.sqrt(output.df,0.02,23,24,2)
migrate.cluster.log.sqrt(output.df,0.02,24,25,2)
migrate.cluster.log.sqrt(output.df,0.02,25,26,2)
migrate.cluster.log.sqrt(output.df,0.02,26,27,2)
migrate.cluster.log.sqrt(output.df,0.02,27,28,2)
migrate.cluster.log.sqrt(output.df,0.02,28,29,2)
migrate.cluster.log.sqrt(output.df,0.02,29,30,2)
migrate.cluster.log.sqrt(output.df,0.02,30,31,2)
migrate.cluster.log.sqrt(output.df,0.02,31,32,2)
migrate.cluster.log.sqrt(output.df,0.02,32,33,2)

```




```{r, include=FALSE, results= FALSE}
setwd("./summarycsv/migration_models/sqrt/mr0.02/")
migrate.cluster.log.sqrt(cluster_sample_data_3,0.02,4,4,3)
migrate.cluster.log.sqrt(output.df,0.02,4,5,3)
migrate.cluster.log.sqrt(output.df,0.02,5,6,3)
migrate.cluster.log.sqrt(output.df,0.02,6,7,3)
migrate.cluster.log.sqrt(output.df,0.02,7,8,3)
migrate.cluster.log.sqrt(output.df,0.02,8,9,3)
migrate.cluster.log.sqrt(output.df,0.02,9,10,3)
migrate.cluster.log.sqrt(output.df,0.02,10,11,3)
migrate.cluster.log.sqrt(output.df,0.02,11,12,3)
migrate.cluster.log.sqrt(output.df,0.02,12,13,3)
migrate.cluster.log.sqrt(output.df,0.02,13,14,3)
migrate.cluster.log.sqrt(output.df,0.02,14,15,3)
migrate.cluster.log.sqrt(output.df,0.02,15,16,3)
migrate.cluster.log.sqrt(output.df,0.02,16,17,3)
migrate.cluster.log.sqrt(output.df,0.02,17,18,3)
migrate.cluster.log.sqrt(output.df,0.02,18,19,3)
migrate.cluster.log.sqrt(output.df,0.02,19,20,3)
migrate.cluster.log.sqrt(output.df,0.02,20,21,3)
migrate.cluster.log.sqrt(output.df,0.02,21,22,3)
migrate.cluster.log.sqrt(output.df,0.02,22,23,3)
migrate.cluster.log.sqrt(output.df,0.02,23,24,3)
migrate.cluster.log.sqrt(output.df,0.02,24,25,3)
migrate.cluster.log.sqrt(output.df,0.02,25,26,3)
migrate.cluster.log.sqrt(output.df,0.02,26,27,3)
migrate.cluster.log.sqrt(output.df,0.02,27,28,3)
migrate.cluster.log.sqrt(output.df,0.02,28,29,3)
migrate.cluster.log.sqrt(output.df,0.02,29,30,3)
migrate.cluster.log.sqrt(output.df,0.02,30,31,3)
migrate.cluster.log.sqrt(output.df,0.02,31,32,3)
migrate.cluster.log.sqrt(output.df,0.02,32,33,3)

```


```{r,include=FALSE, results= FALSE}
setwd("./summarycsv/migration_models/sqrt/mr0.03/")
migrate.cluster.log.sqrt(cluster_sample_data_1,0.03,4,4,1)
migrate.cluster.log.sqrt(output.df,0.03,4,5,1)
migrate.cluster.log.sqrt(output.df,0.03,5,6,1)
migrate.cluster.log.sqrt(output.df,0.03,6,7,1)
migrate.cluster.log.sqrt(output.df,0.03,7,8,1)
migrate.cluster.log.sqrt(output.df,0.03,8,9,1)
migrate.cluster.log.sqrt(output.df,0.03,9,10,1)
migrate.cluster.log.sqrt(output.df,0.03,10,11,1)
migrate.cluster.log.sqrt(output.df,0.03,11,12,1)
migrate.cluster.log.sqrt(output.df,0.03,12,13,1)
migrate.cluster.log.sqrt(output.df,0.03,13,14,1)
migrate.cluster.log.sqrt(output.df,0.03,14,15,1)
migrate.cluster.log.sqrt(output.df,0.03,15,16,1)
migrate.cluster.log.sqrt(output.df,0.03,16,17,1)
migrate.cluster.log.sqrt(output.df,0.03,17,18,1)
migrate.cluster.log.sqrt(output.df,0.03,18,19,1)
migrate.cluster.log.sqrt(output.df,0.03,19,20,1)
migrate.cluster.log.sqrt(output.df,0.03,20,21,1)
migrate.cluster.log.sqrt(output.df,0.03,21,22,1)
migrate.cluster.log.sqrt(output.df,0.03,22,23,1)
migrate.cluster.log.sqrt(output.df,0.03,23,24,1)
migrate.cluster.log.sqrt(output.df,0.03,24,25,1)
migrate.cluster.log.sqrt(output.df,0.03,25,26,1)
migrate.cluster.log.sqrt(output.df,0.03,26,27,1)
migrate.cluster.log.sqrt(output.df,0.03,27,28,1)
migrate.cluster.log.sqrt(output.df,0.03,28,29,1)
migrate.cluster.log.sqrt(output.df,0.03,29,30,1)
migrate.cluster.log.sqrt(output.df,0.03,30,31,1)
migrate.cluster.log.sqrt(output.df,0.03,31,32,1)
migrate.cluster.log.sqrt(output.df,0.03,32,33,1)

```


```{r,include=FALSE, results= FALSE}
setwd("./summarycsv/migration_models/sqrt/mr0.03/")
migrate.cluster.log.sqrt(cluster_sample_data_2,0.03,4,4,2)
migrate.cluster.log.sqrt(output.df,0.03,4,5,2)
migrate.cluster.log.sqrt(output.df,0.03,5,6,2)
migrate.cluster.log.sqrt(output.df,0.03,6,7,2)
migrate.cluster.log.sqrt(output.df,0.03,7,8,2)
migrate.cluster.log.sqrt(output.df,0.03,8,9,2)
migrate.cluster.log.sqrt(output.df,0.03,9,10,2)
migrate.cluster.log.sqrt(output.df,0.03,10,11,2)
migrate.cluster.log.sqrt(output.df,0.03,11,12,2)
migrate.cluster.log.sqrt(output.df,0.03,12,13,2)
migrate.cluster.log.sqrt(output.df,0.03,13,14,2)
migrate.cluster.log.sqrt(output.df,0.03,14,15,2)
migrate.cluster.log.sqrt(output.df,0.03,15,16,2)
migrate.cluster.log.sqrt(output.df,0.03,16,17,2)
migrate.cluster.log.sqrt(output.df,0.03,17,18,2)
migrate.cluster.log.sqrt(output.df,0.03,18,19,2)
migrate.cluster.log.sqrt(output.df,0.03,19,20,2)
migrate.cluster.log.sqrt(output.df,0.03,20,21,2)
migrate.cluster.log.sqrt(output.df,0.03,21,22,2)
migrate.cluster.log.sqrt(output.df,0.03,22,23,2)
migrate.cluster.log.sqrt(output.df,0.03,23,24,2)
migrate.cluster.log.sqrt(output.df,0.03,24,25,2)
migrate.cluster.log.sqrt(output.df,0.03,25,26,2)
migrate.cluster.log.sqrt(output.df,0.03,26,27,2)
migrate.cluster.log.sqrt(output.df,0.03,27,28,2)
migrate.cluster.log.sqrt(output.df,0.03,28,29,2)
migrate.cluster.log.sqrt(output.df,0.03,29,30,2)
migrate.cluster.log.sqrt(output.df,0.03,30,31,2)
migrate.cluster.log.sqrt(output.df,0.03,31,32,2)
migrate.cluster.log.sqrt(output.df,0.03,32,33,2)

```


```{r,include=FALSE, results= FALSE}
setwd("./summarycsv/migration_models/sqrt/mr0.03/")
migrate.cluster.log.sqrt(cluster_sample_data_3,0.03,4,4,3)
migrate.cluster.log.sqrt(output.df,0.03,4,5,3)
migrate.cluster.log.sqrt(output.df,0.03,5,6,3)
migrate.cluster.log.sqrt(output.df,0.03,6,7,3)
migrate.cluster.log.sqrt(output.df,0.03,7,8,3)
migrate.cluster.log.sqrt(output.df,0.03,8,9,3)
migrate.cluster.log.sqrt(output.df,0.03,9,10,3)
migrate.cluster.log.sqrt(output.df,0.03,10,11,3)
migrate.cluster.log.sqrt(output.df,0.03,11,12,3)
migrate.cluster.log.sqrt(output.df,0.03,12,13,3)
migrate.cluster.log.sqrt(output.df,0.03,13,14,3)
migrate.cluster.log.sqrt(output.df,0.03,14,15,3)
migrate.cluster.log.sqrt(output.df,0.03,15,16,3)
migrate.cluster.log.sqrt(output.df,0.03,16,17,3)
migrate.cluster.log.sqrt(output.df,0.03,17,18,3)
migrate.cluster.log.sqrt(output.df,0.03,18,19,3)
migrate.cluster.log.sqrt(output.df,0.03,19,20,3)
migrate.cluster.log.sqrt(output.df,0.03,20,21,3)
migrate.cluster.log.sqrt(output.df,0.03,21,22,3)
migrate.cluster.log.sqrt(output.df,0.03,22,23,3)
migrate.cluster.log.sqrt(output.df,0.03,23,24,3)
migrate.cluster.log.sqrt(output.df,0.03,24,25,3)
migrate.cluster.log.sqrt(output.df,0.03,25,26,3)
migrate.cluster.log.sqrt(output.df,0.03,26,27,3)
migrate.cluster.log.sqrt(output.df,0.03,27,28,3)
migrate.cluster.log.sqrt(output.df,0.03,28,29,3)
migrate.cluster.log.sqrt(output.df,0.03,29,30,3)
migrate.cluster.log.sqrt(output.df,0.03,30,31,3)
migrate.cluster.log.sqrt(output.df,0.03,31,32,3)
migrate.cluster.log.sqrt(output.df,0.03,32,33,3)

```



```{r,include=FALSE, results= FALSE}
setwd("./summarycsv/migration_models/sqrt/mr0.04/")
migrate.cluster.log.sqrt(cluster_sample_data_1,0.04,4,4,1)
migrate.cluster.log.sqrt(output.df,0.04,4,5,1)
migrate.cluster.log.sqrt(output.df,0.04,5,6,1)
migrate.cluster.log.sqrt(output.df,0.04,6,7,1)
migrate.cluster.log.sqrt(output.df,0.04,7,8,1)
migrate.cluster.log.sqrt(output.df,0.04,8,9,1)
migrate.cluster.log.sqrt(output.df,0.04,9,10,1)
migrate.cluster.log.sqrt(output.df,0.04,10,11,1)
migrate.cluster.log.sqrt(output.df,0.04,11,12,1)
migrate.cluster.log.sqrt(output.df,0.04,12,13,1)
migrate.cluster.log.sqrt(output.df,0.04,13,14,1)
migrate.cluster.log.sqrt(output.df,0.04,14,15,1)
migrate.cluster.log.sqrt(output.df,0.04,15,16,1)
migrate.cluster.log.sqrt(output.df,0.04,16,17,1)
migrate.cluster.log.sqrt(output.df,0.04,17,18,1)
migrate.cluster.log.sqrt(output.df,0.04,18,19,1)
migrate.cluster.log.sqrt(output.df,0.04,19,20,1)
migrate.cluster.log.sqrt(output.df,0.04,20,21,1)
migrate.cluster.log.sqrt(output.df,0.04,21,22,1)
migrate.cluster.log.sqrt(output.df,0.04,22,23,1)
migrate.cluster.log.sqrt(output.df,0.04,23,24,1)
migrate.cluster.log.sqrt(output.df,0.04,24,25,1)
migrate.cluster.log.sqrt(output.df,0.04,25,26,1)
migrate.cluster.log.sqrt(output.df,0.04,26,27,1)
migrate.cluster.log.sqrt(output.df,0.04,27,28,1)
migrate.cluster.log.sqrt(output.df,0.04,28,29,1)
migrate.cluster.log.sqrt(output.df,0.04,29,30,1)
migrate.cluster.log.sqrt(output.df,0.04,30,31,1)
migrate.cluster.log.sqrt(output.df,0.04,31,32,1)
migrate.cluster.log.sqrt(output.df,0.04,32,33,1)

```


```{r,include=FALSE, results= FALSE}
setwd("./summarycsv/migration_models/sqrt/mr0.04/")
migrate.cluster.log.sqrt(cluster_sample_data_2,0.04,4,4,2)
migrate.cluster.log.sqrt(output.df,0.04,4,5,2)
migrate.cluster.log.sqrt(output.df,0.04,5,6,2)
migrate.cluster.log.sqrt(output.df,0.04,6,7,2)
migrate.cluster.log.sqrt(output.df,0.04,7,8,2)
migrate.cluster.log.sqrt(output.df,0.04,8,9,2)
migrate.cluster.log.sqrt(output.df,0.04,9,10,2)
migrate.cluster.log.sqrt(output.df,0.04,10,11,2)
migrate.cluster.log.sqrt(output.df,0.04,11,12,2)
migrate.cluster.log.sqrt(output.df,0.04,12,13,2)
migrate.cluster.log.sqrt(output.df,0.04,13,14,2)
migrate.cluster.log.sqrt(output.df,0.04,14,15,2)
migrate.cluster.log.sqrt(output.df,0.04,15,16,2)
migrate.cluster.log.sqrt(output.df,0.04,16,17,2)
migrate.cluster.log.sqrt(output.df,0.04,17,18,2)
migrate.cluster.log.sqrt(output.df,0.04,18,19,2)
migrate.cluster.log.sqrt(output.df,0.04,19,20,2)
migrate.cluster.log.sqrt(output.df,0.04,20,21,2)
migrate.cluster.log.sqrt(output.df,0.04,21,22,2)
migrate.cluster.log.sqrt(output.df,0.04,22,23,2)
migrate.cluster.log.sqrt(output.df,0.04,23,24,2)
migrate.cluster.log.sqrt(output.df,0.04,24,25,2)
migrate.cluster.log.sqrt(output.df,0.04,25,26,2)
migrate.cluster.log.sqrt(output.df,0.04,26,27,2)
migrate.cluster.log.sqrt(output.df,0.04,27,28,2)
migrate.cluster.log.sqrt(output.df,0.04,28,29,2)
migrate.cluster.log.sqrt(output.df,0.04,29,30,2)
migrate.cluster.log.sqrt(output.df,0.04,30,31,2)
migrate.cluster.log.sqrt(output.df,0.04,31,32,2)
migrate.cluster.log.sqrt(output.df,0.04,32,33,2)

```


```{r,include=FALSE, results= FALSE}
setwd("./summarycsv/migration_models/sqrt/mr0.04/")
migrate.cluster.log.sqrt(cluster_sample_data_3,0.04,4,4,3)
migrate.cluster.log.sqrt(output.df,0.04,4,5,3)
migrate.cluster.log.sqrt(output.df,0.04,5,6,3)
migrate.cluster.log.sqrt(output.df,0.04,6,7,3)
migrate.cluster.log.sqrt(output.df,0.04,7,8,3)
migrate.cluster.log.sqrt(output.df,0.04,8,9,3)
migrate.cluster.log.sqrt(output.df,0.04,9,10,3)
migrate.cluster.log.sqrt(output.df,0.04,10,11,3)
migrate.cluster.log.sqrt(output.df,0.04,11,12,3)
migrate.cluster.log.sqrt(output.df,0.04,12,13,3)
migrate.cluster.log.sqrt(output.df,0.04,13,14,3)
migrate.cluster.log.sqrt(output.df,0.04,14,15,3)
migrate.cluster.log.sqrt(output.df,0.04,15,16,3)
migrate.cluster.log.sqrt(output.df,0.04,16,17,3)
migrate.cluster.log.sqrt(output.df,0.04,17,18,3)
migrate.cluster.log.sqrt(output.df,0.04,18,19,3)
migrate.cluster.log.sqrt(output.df,0.04,19,20,3)
migrate.cluster.log.sqrt(output.df,0.04,20,21,3)
migrate.cluster.log.sqrt(output.df,0.04,21,22,3)
migrate.cluster.log.sqrt(output.df,0.04,22,23,3)
migrate.cluster.log.sqrt(output.df,0.04,23,24,3)
migrate.cluster.log.sqrt(output.df,0.04,24,25,3)
migrate.cluster.log.sqrt(output.df,0.04,25,26,3)
migrate.cluster.log.sqrt(output.df,0.04,26,27,3)
migrate.cluster.log.sqrt(output.df,0.04,27,28,3)
migrate.cluster.log.sqrt(output.df,0.04,28,29,3)
migrate.cluster.log.sqrt(output.df,0.04,29,30,3)
migrate.cluster.log.sqrt(output.df,0.04,30,31,3)
migrate.cluster.log.sqrt(output.df,0.04,31,32,3)
migrate.cluster.log.sqrt(output.df,0.04,32,33,3)

```



```{r,include=FALSE, results= FALSE}
setwd("./summarycsv/migration_models/sqrt/mr0.0/")
migrate.cluster.log.sqrt(cluster_sample_data_1,0,4,4,1)
migrate.cluster.log.sqrt(output.df,0.0,4,5,1)
migrate.cluster.log.sqrt(output.df,0.0,5,6,1)
migrate.cluster.log.sqrt(output.df,0.0,6,7,1)
migrate.cluster.log.sqrt(output.df,0.0,7,8,1)
migrate.cluster.log.sqrt(output.df,0.0,8,9,1)
migrate.cluster.log.sqrt(output.df,0.0,9,10,1)
migrate.cluster.log.sqrt(output.df,0.0,10,11,1)
migrate.cluster.log.sqrt(output.df,0.0,11,12,1)
migrate.cluster.log.sqrt(output.df,0.0,12,13,1)
migrate.cluster.log.sqrt(output.df,0.0,13,14,1)
migrate.cluster.log.sqrt(output.df,0.0,14,15,1)
migrate.cluster.log.sqrt(output.df,0.0,15,16,1)
migrate.cluster.log.sqrt(output.df,0.0,16,17,1)
migrate.cluster.log.sqrt(output.df,0.0,17,18,1)
migrate.cluster.log.sqrt(output.df,0.0,18,19,1)
migrate.cluster.log.sqrt(output.df,0.0,19,20,1)
migrate.cluster.log.sqrt(output.df,0.0,20,21,1)
migrate.cluster.log.sqrt(output.df,0.0,21,22,1)
migrate.cluster.log.sqrt(output.df,0.0,22,23,1)
migrate.cluster.log.sqrt(output.df,0.0,23,24,1)
migrate.cluster.log.sqrt(output.df,0.0,24,25,1)
migrate.cluster.log.sqrt(output.df,0.0,25,26,1)
migrate.cluster.log.sqrt(output.df,0.0,26,27,1)
migrate.cluster.log.sqrt(output.df,0.0,27,28,1)
migrate.cluster.log.sqrt(output.df,0.0,28,29,1)
migrate.cluster.log.sqrt(output.df,0.0,29,30,1)
migrate.cluster.log.sqrt(output.df,0.0,30,31,1)
migrate.cluster.log.sqrt(output.df,0.0,31,32,1)
migrate.cluster.log.sqrt(output.df,0.0,32,33,1)

```


```{r,include=FALSE, results= FALSE}
setwd("./summarycsv/migration_models/sqrt/mr0.0/")
migrate.cluster.log.sqrt(cluster_sample_data_2,0,4,4,2)
migrate.cluster.log.sqrt(output.df,0.0,4,5,2)
migrate.cluster.log.sqrt(output.df,0.0,5,6,2)
migrate.cluster.log.sqrt(output.df,0.0,6,7,2)
migrate.cluster.log.sqrt(output.df,0.0,7,8,2)
migrate.cluster.log.sqrt(output.df,0.0,8,9,2)
migrate.cluster.log.sqrt(output.df,0.0,9,10,2)
migrate.cluster.log.sqrt(output.df,0.0,10,11,2)
migrate.cluster.log.sqrt(output.df,0.0,11,12,2)
migrate.cluster.log.sqrt(output.df,0.0,12,13,2)
migrate.cluster.log.sqrt(output.df,0.0,13,14,2)
migrate.cluster.log.sqrt(output.df,0.0,14,15,2)
migrate.cluster.log.sqrt(output.df,0.0,15,16,2)
migrate.cluster.log.sqrt(output.df,0.0,16,17,2)
migrate.cluster.log.sqrt(output.df,0.0,17,18,2)
migrate.cluster.log.sqrt(output.df,0.0,18,19,2)
migrate.cluster.log.sqrt(output.df,0.0,19,20,2)
migrate.cluster.log.sqrt(output.df,0.0,20,21,2)
migrate.cluster.log.sqrt(output.df,0.0,21,22,2)
migrate.cluster.log.sqrt(output.df,0.0,22,23,2)
migrate.cluster.log.sqrt(output.df,0.0,23,24,2)
migrate.cluster.log.sqrt(output.df,0.0,24,25,2)
migrate.cluster.log.sqrt(output.df,0.0,25,26,2)
migrate.cluster.log.sqrt(output.df,0.0,26,27,2)
migrate.cluster.log.sqrt(output.df,0.0,27,28,2)
migrate.cluster.log.sqrt(output.df,0.0,28,29,2)
migrate.cluster.log.sqrt(output.df,0.0,29,30,2)
migrate.cluster.log.sqrt(output.df,0.0,30,31,2)
migrate.cluster.log.sqrt(output.df,0.0,31,32,2)
migrate.cluster.log.sqrt(output.df,0.0,32,33,2)

```


```{r,include=FALSE, results= FALSE}
setwd("./summarycsv/migration_models/sqrt/mr0.0/")
migrate.cluster.log.sqrt(cluster_sample_data_3,0,4,4,3)
migrate.cluster.log.sqrt(output.df,0.0,4,5,3)
migrate.cluster.log.sqrt(output.df,0.0,5,6,3)
migrate.cluster.log.sqrt(output.df,0.0,6,7,3)
migrate.cluster.log.sqrt(output.df,0.0,7,8,3)
migrate.cluster.log.sqrt(output.df,0.0,8,9,3)
migrate.cluster.log.sqrt(output.df,0.0,9,10,3)
migrate.cluster.log.sqrt(output.df,0.0,10,11,3)
migrate.cluster.log.sqrt(output.df,0.0,11,12,3)
migrate.cluster.log.sqrt(output.df,0.0,12,13,3)
migrate.cluster.log.sqrt(output.df,0.0,13,14,3)
migrate.cluster.log.sqrt(output.df,0.0,14,15,3)
migrate.cluster.log.sqrt(output.df,0.0,15,16,3)
migrate.cluster.log.sqrt(output.df,0.0,16,17,3)
migrate.cluster.log.sqrt(output.df,0.0,17,18,3)
migrate.cluster.log.sqrt(output.df,0.0,18,19,3)
migrate.cluster.log.sqrt(output.df,0.0,19,20,3)
migrate.cluster.log.sqrt(output.df,0.0,20,21,3)
migrate.cluster.log.sqrt(output.df,0.0,21,22,3)
migrate.cluster.log.sqrt(output.df,0.0,22,23,3)
migrate.cluster.log.sqrt(output.df,0.0,23,24,3)
migrate.cluster.log.sqrt(output.df,0.0,24,25,3)
migrate.cluster.log.sqrt(output.df,0.0,25,26,3)
migrate.cluster.log.sqrt(output.df,0.0,26,27,3)
migrate.cluster.log.sqrt(output.df,0.0,27,28,3)
migrate.cluster.log.sqrt(output.df,0.0,28,29,3)
migrate.cluster.log.sqrt(output.df,0.0,29,30,3)
migrate.cluster.log.sqrt(output.df,0.0,30,31,3)
migrate.cluster.log.sqrt(output.df,0.0,31,32,3)
migrate.cluster.log.sqrt(output.df,0.0,32,33,3)

```


```{r,include=FALSE, results= FALSE}
setwd("./summarycsv/migration_models/sqrt/mr0.005/")
migrate.cluster.log.sqrt(cluster_sample_data_1,0.005,4,4,1)
migrate.cluster.log.sqrt(output.df,0.005,4,5,1)
migrate.cluster.log.sqrt(output.df,0.005,5,6,1)
migrate.cluster.log.sqrt(output.df,0.005,6,7,1)
migrate.cluster.log.sqrt(output.df,0.005,7,8,1)
migrate.cluster.log.sqrt(output.df,0.005,8,9,1)
migrate.cluster.log.sqrt(output.df,0.005,9,10,1)
migrate.cluster.log.sqrt(output.df,0.005,10,11,1)
migrate.cluster.log.sqrt(output.df,0.005,11,12,1)
migrate.cluster.log.sqrt(output.df,0.005,12,13,1)
migrate.cluster.log.sqrt(output.df,0.005,13,14,1)
migrate.cluster.log.sqrt(output.df,0.005,14,15,1)
migrate.cluster.log.sqrt(output.df,0.005,15,16,1)
migrate.cluster.log.sqrt(output.df,0.005,16,17,1)
migrate.cluster.log.sqrt(output.df,0.005,17,18,1)
migrate.cluster.log.sqrt(output.df,0.005,18,19,1)
migrate.cluster.log.sqrt(output.df,0.005,19,20,1)
migrate.cluster.log.sqrt(output.df,0.005,20,21,1)
migrate.cluster.log.sqrt(output.df,0.005,21,22,1)
migrate.cluster.log.sqrt(output.df,0.005,22,23,1)
migrate.cluster.log.sqrt(output.df,0.005,23,24,1)
migrate.cluster.log.sqrt(output.df,0.005,24,25,1)
migrate.cluster.log.sqrt(output.df,0.005,25,26,1)
migrate.cluster.log.sqrt(output.df,0.005,26,27,1)
migrate.cluster.log.sqrt(output.df,0.005,27,28,1)
migrate.cluster.log.sqrt(output.df,0.005,28,29,1)
migrate.cluster.log.sqrt(output.df,0.005,29,30,1)
migrate.cluster.log.sqrt(output.df,0.005,30,31,1)
migrate.cluster.log.sqrt(output.df,0.005,31,32,1)
migrate.cluster.log.sqrt(output.df,0.005,32,33,1)

```


```{r,include=FALSE, results= FALSE}
setwd("./summarycsv/migration_models/sqrt/mr0.005/")
migrate.cluster.log.sqrt(cluster_sample_data_2,0.005,4,4,2)
migrate.cluster.log.sqrt(output.df,0.005,4,5,2)
migrate.cluster.log.sqrt(output.df,0.005,5,6,2)
migrate.cluster.log.sqrt(output.df,0.005,6,7,2)
migrate.cluster.log.sqrt(output.df,0.005,7,8,2)
migrate.cluster.log.sqrt(output.df,0.005,8,9,2)
migrate.cluster.log.sqrt(output.df,0.005,9,10,2)
migrate.cluster.log.sqrt(output.df,0.005,10,11,2)
migrate.cluster.log.sqrt(output.df,0.005,11,12,2)
migrate.cluster.log.sqrt(output.df,0.005,12,13,2)
migrate.cluster.log.sqrt(output.df,0.005,13,14,2)
migrate.cluster.log.sqrt(output.df,0.005,14,15,2)
migrate.cluster.log.sqrt(output.df,0.005,15,16,2)
migrate.cluster.log.sqrt(output.df,0.005,16,17,2)
migrate.cluster.log.sqrt(output.df,0.005,17,18,2)
migrate.cluster.log.sqrt(output.df,0.005,18,19,2)
migrate.cluster.log.sqrt(output.df,0.005,19,20,2)
migrate.cluster.log.sqrt(output.df,0.005,20,21,2)
migrate.cluster.log.sqrt(output.df,0.005,21,22,2)
migrate.cluster.log.sqrt(output.df,0.005,22,23,2)
migrate.cluster.log.sqrt(output.df,0.005,23,24,2)
migrate.cluster.log.sqrt(output.df,0.005,24,25,2)
migrate.cluster.log.sqrt(output.df,0.005,25,26,2)
migrate.cluster.log.sqrt(output.df,0.005,26,27,2)
migrate.cluster.log.sqrt(output.df,0.005,27,28,2)
migrate.cluster.log.sqrt(output.df,0.005,28,29,2)
migrate.cluster.log.sqrt(output.df,0.005,29,30,2)
migrate.cluster.log.sqrt(output.df,0.005,30,31,2)
migrate.cluster.log.sqrt(output.df,0.005,31,32,2)
migrate.cluster.log.sqrt(output.df,0.005,32,33,2)

```


```{r,include=FALSE, results= FALSE}
setwd("./summarycsv/migration_models/sqrt/mr0.005/")
migrate.cluster.log.sqrt(cluster_sample_data_3,0.005,4,4,3)
migrate.cluster.log.sqrt(output.df,0.005,4,5,3)
migrate.cluster.log.sqrt(output.df,0.005,5,6,3)
migrate.cluster.log.sqrt(output.df,0.005,6,7,3)
migrate.cluster.log.sqrt(output.df,0.005,7,8,3)
migrate.cluster.log.sqrt(output.df,0.005,8,9,3)
migrate.cluster.log.sqrt(output.df,0.005,9,10,3)
migrate.cluster.log.sqrt(output.df,0.005,10,11,3)
migrate.cluster.log.sqrt(output.df,0.005,11,12,3)
migrate.cluster.log.sqrt(output.df,0.005,12,13,3)
migrate.cluster.log.sqrt(output.df,0.005,13,14,3)
migrate.cluster.log.sqrt(output.df,0.005,14,15,3)
migrate.cluster.log.sqrt(output.df,0.005,15,16,3)
migrate.cluster.log.sqrt(output.df,0.005,16,17,3)
migrate.cluster.log.sqrt(output.df,0.005,17,18,3)
migrate.cluster.log.sqrt(output.df,0.005,18,19,3)
migrate.cluster.log.sqrt(output.df,0.005,19,20,3)
migrate.cluster.log.sqrt(output.df,0.005,20,21,3)
migrate.cluster.log.sqrt(output.df,0.005,21,22,3)
migrate.cluster.log.sqrt(output.df,0.005,22,23,3)
migrate.cluster.log.sqrt(output.df,0.005,23,24,3)
migrate.cluster.log.sqrt(output.df,0.005,24,25,3)
migrate.cluster.log.sqrt(output.df,0.005,25,26,3)
migrate.cluster.log.sqrt(output.df,0.005,26,27,3)
migrate.cluster.log.sqrt(output.df,0.005,27,28,3)
migrate.cluster.log.sqrt(output.df,0.005,28,29,3)
migrate.cluster.log.sqrt(output.df,0.005,29,30,3)
migrate.cluster.log.sqrt(output.df,0.005,30,31,3)
migrate.cluster.log.sqrt(output.df,0.005,31,32,3)
migrate.cluster.log.sqrt(output.df,0.005,32,33,3)

```


```{r, echo = F, include = F, results = F}
setwd("./summarycsv/migration_models/sqrt/mr0.07/")
migrate.cluster.log.sqrt(cluster_sample_data_1,0.07,4,4,1)
migrate.cluster.log.sqrt(output.df,0.07,4,5,1)
migrate.cluster.log.sqrt(output.df,0.07,5,6,1)
migrate.cluster.log.sqrt(output.df,0.07,6,7,1)
migrate.cluster.log.sqrt(output.df,0.07,7,8,1)
migrate.cluster.log.sqrt(output.df,0.07,8,9,1)
migrate.cluster.log.sqrt(output.df,0.07,9,10,1)
migrate.cluster.log.sqrt(output.df,0.07,10,11,1)
migrate.cluster.log.sqrt(output.df,0.07,11,12,1)
migrate.cluster.log.sqrt(output.df,0.07,12,13,1)
migrate.cluster.log.sqrt(output.df,0.07,13,14,1)
migrate.cluster.log.sqrt(output.df,0.07,14,15,1)
migrate.cluster.log.sqrt(output.df,0.07,15,16,1)
migrate.cluster.log.sqrt(output.df,0.07,16,17,1)
migrate.cluster.log.sqrt(output.df,0.07,17,18,1)
migrate.cluster.log.sqrt(output.df,0.07,18,19,1)
migrate.cluster.log.sqrt(output.df,0.07,19,20,1)
migrate.cluster.log.sqrt(output.df,0.07,20,21,1)
migrate.cluster.log.sqrt(output.df,0.07,21,22,1)
migrate.cluster.log.sqrt(output.df,0.07,22,23,1)
migrate.cluster.log.sqrt(output.df,0.07,23,24,1)
migrate.cluster.log.sqrt(output.df,0.07,24,25,1)
migrate.cluster.log.sqrt(output.df,0.07,25,26,1)
migrate.cluster.log.sqrt(output.df,0.07,26,27,1)
migrate.cluster.log.sqrt(output.df,0.07,27,28,1)
migrate.cluster.log.sqrt(output.df,0.07,28,29,1)
migrate.cluster.log.sqrt(output.df,0.07,29,30,1)
migrate.cluster.log.sqrt(output.df,0.07,30,31,1)
migrate.cluster.log.sqrt(output.df,0.07,31,32,1)
migrate.cluster.log.sqrt(output.df,0.07,32,33,1)

```



```{r, echo = F, include = F, results = F}
setwd("./summarycsv/migration_models/sqrt/mr0.07/")
migrate.cluster.log.sqrt(cluster_sample_data_2,0.07,4,4,2)
migrate.cluster.log.sqrt(output.df,0.07,4,5,2)
migrate.cluster.log.sqrt(output.df,0.07,5,6,2)
migrate.cluster.log.sqrt(output.df,0.07,6,7,2)
migrate.cluster.log.sqrt(output.df,0.07,7,8,2)
migrate.cluster.log.sqrt(output.df,0.07,8,9,2)
migrate.cluster.log.sqrt(output.df,0.07,9,10,2)
migrate.cluster.log.sqrt(output.df,0.07,10,11,2)
migrate.cluster.log.sqrt(output.df,0.07,11,12,2)
migrate.cluster.log.sqrt(output.df,0.07,12,13,2)
migrate.cluster.log.sqrt(output.df,0.07,13,14,2)
migrate.cluster.log.sqrt(output.df,0.07,14,15,2)
migrate.cluster.log.sqrt(output.df,0.07,15,16,2)
migrate.cluster.log.sqrt(output.df,0.07,16,17,2)
migrate.cluster.log.sqrt(output.df,0.07,17,18,2)
migrate.cluster.log.sqrt(output.df,0.07,18,19,2)
migrate.cluster.log.sqrt(output.df,0.07,19,20,2)
migrate.cluster.log.sqrt(output.df,0.07,20,21,2)
migrate.cluster.log.sqrt(output.df,0.07,21,22,2)
migrate.cluster.log.sqrt(output.df,0.07,22,23,2)
migrate.cluster.log.sqrt(output.df,0.07,23,24,2)
migrate.cluster.log.sqrt(output.df,0.07,24,25,2)
migrate.cluster.log.sqrt(output.df,0.07,25,26,2)
migrate.cluster.log.sqrt(output.df,0.07,26,27,2)
migrate.cluster.log.sqrt(output.df,0.07,27,28,2)
migrate.cluster.log.sqrt(output.df,0.07,28,29,2)
migrate.cluster.log.sqrt(output.df,0.07,29,30,2)
migrate.cluster.log.sqrt(output.df,0.07,30,31,2)
migrate.cluster.log.sqrt(output.df,0.07,31,32,2)
migrate.cluster.log.sqrt(output.df,0.07,32,33,2)

```


```{r, echo = F, include = F, results = F}
setwd("./summarycsv/migration_models/sqrt/mr0.07/")
migrate.cluster.log.sqrt(cluster_sample_data_3,0.07,4,4,3)
migrate.cluster.log.sqrt(output.df,0.07,4,5,3)
migrate.cluster.log.sqrt(output.df,0.07,5,6,3)
migrate.cluster.log.sqrt(output.df,0.07,6,7,3)
migrate.cluster.log.sqrt(output.df,0.07,7,8,3)
migrate.cluster.log.sqrt(output.df,0.07,8,9,3)
migrate.cluster.log.sqrt(output.df,0.07,9,10,3)
migrate.cluster.log.sqrt(output.df,0.07,10,11,3)
migrate.cluster.log.sqrt(output.df,0.07,11,12,3)
migrate.cluster.log.sqrt(output.df,0.07,12,13,3)
migrate.cluster.log.sqrt(output.df,0.07,13,14,3)
migrate.cluster.log.sqrt(output.df,0.07,14,15,3)
migrate.cluster.log.sqrt(output.df,0.07,15,16,3)
migrate.cluster.log.sqrt(output.df,0.07,16,17,3)
migrate.cluster.log.sqrt(output.df,0.07,17,18,3)
migrate.cluster.log.sqrt(output.df,0.07,18,19,3)
migrate.cluster.log.sqrt(output.df,0.07,19,20,3)
migrate.cluster.log.sqrt(output.df,0.07,20,21,3)
migrate.cluster.log.sqrt(output.df,0.07,21,22,3)
migrate.cluster.log.sqrt(output.df,0.07,22,23,3)
migrate.cluster.log.sqrt(output.df,0.07,23,24,3)
migrate.cluster.log.sqrt(output.df,0.07,24,25,3)
migrate.cluster.log.sqrt(output.df,0.07,25,26,3)
migrate.cluster.log.sqrt(output.df,0.07,26,27,3)
migrate.cluster.log.sqrt(output.df,0.07,27,28,3)
migrate.cluster.log.sqrt(output.df,0.07,28,29,3)
migrate.cluster.log.sqrt(output.df,0.07,29,30,3)
migrate.cluster.log.sqrt(output.df,0.07,30,31,3)
migrate.cluster.log.sqrt(output.df,0.07,31,32,3)
migrate.cluster.log.sqrt(output.df,0.07,32,33,3)

```












# Log Data for Figure B

# Start here
```{r}
setwd("./summarycsv/migration_models/logistic growth/mr0.1/")
migrationmodels.list = list.files(pattern = ".csv")
migrationmodels.read = lapply(migrationmodels.list, read.csv, header=T, stringsAsFactors = F)
migrationmodel.log.0.1 <- rbindlist(migrationmodels.read, fill = T)

setwd("../mr0.015/")
migrationmodels.list = list.files(pattern = ".csv")
migrationmodels.read = lapply(migrationmodels.list, read.csv, header=T, stringsAsFactors = F)
migrationmodel.log.0.015 <- rbindlist(migrationmodels.read, fill = T)

setwd("../mr0.01/")
migrationmodels.list = list.files(pattern = ".csv")
migrationmodels.read = lapply(migrationmodels.list, read.csv, header=T, stringsAsFactors = F)
migrationmodel.log.0.01 <- rbindlist(migrationmodels.read, fill = T)

setwd("../mr0.005/")
migrationmodels.list = list.files(pattern = ".csv")
migrationmodels.read = lapply(migrationmodels.list, read.csv, header=T, stringsAsFactors = F)
migrationmodel.log.0.005 <- rbindlist(migrationmodels.read, fill = T)

setwd("../mr0.0/")
migrationmodels.list = list.files(pattern = ".csv")
migrationmodels.read = lapply(migrationmodels.list, read.csv, header=T, stringsAsFactors = F)
migrationmodel.log.0.0 <- rbindlist(migrationmodels.read, fill = T)

setwd("../mr0.02/")
migrationmodels.list = list.files(pattern = ".csv")
migrationmodels.read = lapply(migrationmodels.list, read.csv, header=T, stringsAsFactors = F)
migrationmodel.log.0.02 <- rbindlist(migrationmodels.read, fill = T)

setwd("../mr0.03/")
migrationmodels.list = list.files(pattern = ".csv")
migrationmodels.read = lapply(migrationmodels.list, read.csv, header=T, stringsAsFactors = F)
migrationmodel.log.0.03 <- rbindlist(migrationmodels.read, fill = T)

setwd("../mr0.04/")
migrationmodels.list = list.files(pattern = ".csv")
migrationmodels.read = lapply(migrationmodels.list, read.csv, header=T, stringsAsFactors = F)
migrationmodel.log.0.04 <- rbindlist(migrationmodels.read, fill = T)

setwd("../mr0.07/")
migrationmodels.list = list.files(pattern = ".csv")
migrationmodels.read = lapply(migrationmodels.list, read.csv, header=T, stringsAsFactors = F)
migrationmodel.log.0.07 <- rbindlist(migrationmodels.read, fill = T)
```

```{r}
migrationmodel.log.0.0$migrate.rate <- 0
migrationmodel.log.0.005$migrate.rate <- 0.005
migrationmodel.log.0.01$migrate.rate <- 0.01
migrationmodel.log.0.015$migrate.rate <- 0.015
migrationmodel.log.0.1$migrate.rate <- 0.1
migrationmodel.log.0.02$migrate.rate <- 0.02
migrationmodel.log.0.03$migrate.rate <- 0.03
migrationmodel.log.0.04$migrate.rate <- 0.04
migrationmodel.log.0.07$migrate.rate <- 0.07



migrationmodelcombine.log <- bind_rows(migrationmodel.log.0.0, migrationmodel.log.0.005, migrationmodel.log.0.01, migrationmodel.log.0.02,
migrationmodel.log.0.03,
migrationmodel.log.0.04,
migrationmodel.log.0.015,
migrationmodel.log.0.1,
migrationmodel.log.0.07
)



# round cells

migrationmodelcombine.log$cellspercluster <- round(migrationmodelcombine.log$cells)
migrationmodelcombine.log <- subset(migrationmodelcombine.log, cellspercluster > 0)




# Create breaks to divide groups


breaks = seq(1,2000,1)
breaks_names = seq(1,1999,1)
```


# Create frequency table
```{r}

migrationmodelcombine.log$migrate.rate <- as.factor(migrationmodelcombine.log$migrate.rate)

migrationmodelcombine2.log <- migrationmodelcombine.log %>%
group_by(sample.name, Subsample, end.day, migrate.rate) %>%
  dplyr::summarize(cellspercluster = cellspercluster, histgroup = cut(cellspercluster, right = F, breaks = breaks, labels = breaks_names), freq = 1)

```



# turn frequency table into histogram summary table

```{r}
migrationmodel_sum.log <- migrationmodelcombine2.log %>%
  group_by(sample.name, Subsample, end.day, migrate.rate, histgroup) %>%
  dplyr::summarize(frequency = sum(freq))

```

```{r}
arrange(migrationmodel_sum.log, histgroup)

```
# pivot to wide
```{r}
migrationmodel_sum_wide.log <- migrationmodel_sum.log %>% 
    pivot_wider(names_from = histgroup, values_from = frequency, values_fill = 0, names_sort = T)


colnames(migrationmodel_sum_wide.log) <- paste("X", colnames(migrationmodel_sum_wide.log), sep = "")

migrationmodel_sum_wide.log <- dplyr::rename(migrationmodel_sum_wide.log, sample.name = Xsample.name)
migrationmodel_sum_wide.log <- dplyr::rename(migrationmodel_sum_wide.log, Subsample = XSubsample)
migrationmodel_sum_wide.log <- dplyr::rename(migrationmodel_sum_wide.log, end.day = Xend.day)
migrationmodel_sum_wide.log <- dplyr::rename(migrationmodel_sum_wide.log, migrate.rate = Xmigrate.rate)

migmodel.ncol <- length(migrationmodel_sum_wide.log)


# create same groups as before
migrationmodel_sum_wide.log$Xone <- migrationmodel_sum_wide.log$X1

migrationmodel_sum_wide.log$Xtwo <- migrationmodel_sum_wide.log$X2

migrationmodel_sum_wide.log$Xthreefour <- migrationmodel_sum_wide.log$X3 + migrationmodel_sum_wide.log$X4
  

migrationmodel_sum_wide.log <- migrationmodel_sum_wide.log %>% ungroup %>%
  
  mutate(X3to4 = dplyr::select(., X3:X4) %>% rowSums(na.rm = TRUE))
migrationmodel_sum_wide.log <- migrationmodel_sum_wide.log %>%
    mutate(X5to10 = dplyr::select(., X5:X10) %>% rowSums(na.rm = TRUE))

migrationmodel_sum_wide.log <- migrationmodel_sum_wide.log %>%
    mutate(X15to50 = dplyr::select(., X15:X50) %>% rowSums(na.rm = TRUE))

migrationmodel_sum_wide.log <- migrationmodel_sum_wide.log %>%
    mutate(Xover50 = dplyr::select(., X51:all_of(migmodel.ncol)) %>% rowSums(na.rm = TRUE))

migrationmodel_sum_wide.log <- migrationmodel_sum_wide.log %>%
    mutate(Xover10 = dplyr::select(., X11:all_of(migmodel.ncol)) %>% rowSums(na.rm = TRUE))

migrationmodel_sum_wide.log <- migrationmodel_sum_wide.log %>%
    mutate(hist_count = dplyr::select(., X1:all_of(migmodel.ncol)) %>% rowSums(na.rm = TRUE))
```



# hist sums

```{r}
migrationmodel_sum_wide.log %>% 
dplyr::select(., X1:all_of(migmodel.ncol)) -> histnamesubset

histnames <- as.numeric(unlist(str_extract_all(names(histnamesubset), '[0-9]+')))

histsumsubset <- data.frame(mapply(`*`,histnamesubset,histnames))

colnames(histsumsubset) <- paste(colnames(histsumsubset),"hist",sep="_")
histsumsubset$hist_sum <- rowSums(histsumsubset)




migrationmodel_sum_wide.log$hist_sum <- histsumsubset$hist_sum

```



# convert short to long df
```{r}

migrationmodel_log_pop_long <- reshape2::melt(migrationmodel_sum_wide.log,
        # ID variables - all the variables to keep but not split apart on
    id.vars=c(1:4),
        # The source columns
        # Name of the destination column that will identify the original
        # column that the measurement came from
    variable.name="cluster_type",
    value.name="frequency"
)


```


```{r}


mm_log_migrate_one <- subset(migrationmodel_log_pop_long, (cluster_type %in% c("Xone","Xtwo","Xthreefour","X5to10","Xover10")))

mm_log_migrate_one$day <- mm_log_migrate_one$day_post_inoc
```


# subsets
```{r}

mm_log_migrate_one.subset3day <- mm_log_migrate_one[mm_log_migrate_one$end.day %in% c(4,7,9,11,14,16,18,21,25,29,31),]

mm_log_migrate_one.subset3day$anemone <- str_sub(mm_log_migrate_one.subset3day$sample.name,1,nchar(mm_log_migrate_one.subset3day$sample.name)-2)

mm_log_migrate_one.subset3day$anemoneunique <- str_c(mm_log_migrate_one.subset3day$anemone, sep = ".", mm_log_migrate_one.subset3day$end.day)


mm_log_migrate_one.subset3day$unique <- str_c(mm_log_migrate_one.subset3day$anemoneunique, sep = ".", mm_log_migrate_one.subset3day$Subsample)
```


```{r}
clusts_26B_modelmerge <- subset(clusts_plus_long_bleach, treatment == "B26")
clusts_26B_modelmerge <- subset(clusts_26B_modelmerge, (cluster_type %in% c("Xone","Xtwo","Xthreefour","X5to10","Xover10")))



clusts_26B_modelmerge$end.day <- clusts_26B_modelmerge$day
clusts_26B_modelmerge$migrate.rate <- "observed"
clusts_26B_modelmerge$migrate.rate <- as.factor(clusts_26B_modelmerge$migrate.rate)


clusts_26B_modelmerge <- clusts_26B_modelmerge[clusts_26B_modelmerge$end.day %in% c(4,7,9,11,14,16,18,21,25,29,31),]
```


```{r}
clusts_26B_modelmerge %>%
group_by(anemoneunique) %>%
  dplyr::summarize(obsfrequency = sum(frequency)) -> exp_table
```

```{r}
mm_log_migrate_one.subset3day %>%
group_by(anemoneunique, migrate.rate) %>%
  dplyr::summarize(modfrequency = sum(frequency)) -> log_table

log_table <- subset(log_table, anemoneunique != "26B.2.16")
log_table <- subset(log_table, anemoneunique != "26B.2.21")
log_table <- subset(log_table, anemoneunique != "26B.3.11")
log_table <- subset(log_table, anemoneunique != "26B.9.31")
```


```{r}
# chi-square tests
# cs = sum ((obs - exp)^2 / exp)
logtable0 <- subset(log_table, migrate.rate == 0)
logtable0.005 <- subset(log_table, migrate.rate == 0.005)
logtable0.01 <- subset(log_table, migrate.rate == 0.01)
logtable0.015 <- subset(log_table, migrate.rate == 0.015)
logtable0.02 <- subset(log_table, migrate.rate == 0.02)
logtable0.03 <- subset(log_table, migrate.rate == 0.03)
logtable0.04 <- subset(log_table, migrate.rate == 0.04)
logtable0.07 <- subset(log_table, migrate.rate == 0.07)
logtable0.1 <- subset(log_table, migrate.rate == 0.1)

```


```{r}
anti_join(logtable0,exp_table, by = "anemoneunique")
# all same
```

```{r}
cs0 <- sum(((logtable0$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.005 <- sum(((logtable0.005$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)


cs0.01 <- sum(((logtable0.01$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.015<- sum(((logtable0.015$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.02 <- sum(((logtable0.02$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.03 <- sum(((logtable0.03$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.04 <- sum(((logtable0.04$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.07 <- sum(((logtable0.07$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.1 <- sum(((logtable0.1$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)


cs_log_tot <- c(cs0,cs0.005,cs0.01,cs0.015,cs0.02,cs0.03,cs0.04,cs0.07,cs0.1)
cs_log_tot

```
#xone
```{r}
clusts_26B_modelmerge %>% subset(cluster_type == "Xone") %>%
group_by(anemoneunique) %>%
  dplyr::summarize(obsfrequency = sum(frequency)) -> exp_table

mm_log_migrate_one.subset3day %>% subset(cluster_type == "Xone") %>%
group_by(anemoneunique, migrate.rate) %>%
  dplyr::summarize(modfrequency = sum(frequency)) -> log_table

log_table <- subset(log_table, anemoneunique != "26B.2.16")
log_table <- subset(log_table, anemoneunique != "26B.2.21")
log_table <- subset(log_table, anemoneunique != "26B.3.11")
log_table <- subset(log_table, anemoneunique != "26B.9.31")

# shifted data points by 1 to avoid 0s
log_table$modfrequency = log_table$modfrequency + 1
exp_table$obsfrequency = exp_table$obsfrequency + 1

# chi-square tests
# cs = sum ((obs - exp)^2 / exp)
logtable0 <- subset(log_table, migrate.rate == 0)
logtable0.005 <- subset(log_table, migrate.rate == 0.005)
logtable0.01 <- subset(log_table, migrate.rate == 0.01)
logtable0.015 <- subset(log_table, migrate.rate == 0.015)
logtable0.02 <- subset(log_table, migrate.rate == 0.02)
logtable0.03 <- subset(log_table, migrate.rate == 0.03)
logtable0.04 <- subset(log_table, migrate.rate == 0.04)
logtable0.07 <- subset(log_table, migrate.rate == 0.07)
logtable0.1 <- subset(log_table, migrate.rate == 0.1)


anti_join(logtable0,exp_table, by = "anemoneunique")
# all same

cs0 <- sum(((logtable0$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.005 <- sum(((logtable0.005$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)


cs0.01 <- sum(((logtable0.01$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.015<- sum(((logtable0.015$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.02 <- sum(((logtable0.02$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.03 <- sum(((logtable0.03$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.04 <- sum(((logtable0.04$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.07 <- sum(((logtable0.07$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.1 <- sum(((logtable0.1$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)


cs_log_one <- c(cs0,cs0.005,cs0.01,cs0.015,cs0.02,cs0.03,cs0.04,cs0.07,cs0.1)
cs_log_one

```


#xtwo
```{r}
clusts_26B_modelmerge %>% subset(cluster_type == "Xtwo") %>%
group_by(anemoneunique) %>%
  dplyr::summarize(obsfrequency = sum(frequency)) -> exp_table

mm_log_migrate_one.subset3day %>% subset(cluster_type == "Xtwo") %>%
group_by(anemoneunique, migrate.rate) %>%
  dplyr::summarize(modfrequency = sum(frequency)) -> log_table

log_table <- subset(log_table, anemoneunique != "26B.2.16")
log_table <- subset(log_table, anemoneunique != "26B.2.21")
log_table <- subset(log_table, anemoneunique != "26B.3.11")
log_table <- subset(log_table, anemoneunique != "26B.9.31")

# shifted data points by 1 to avoid 0s
log_table$modfrequency = log_table$modfrequency + 1
exp_table$obsfrequency = exp_table$obsfrequency + 1

# chi-square tests
# cs = sum ((obs - exp)^2 / exp)
logtable0 <- subset(log_table, migrate.rate == 0)
logtable0.005 <- subset(log_table, migrate.rate == 0.005)
logtable0.01 <- subset(log_table, migrate.rate == 0.01)
logtable0.015 <- subset(log_table, migrate.rate == 0.015)
logtable0.02 <- subset(log_table, migrate.rate == 0.02)
logtable0.03 <- subset(log_table, migrate.rate == 0.03)
logtable0.04 <- subset(log_table, migrate.rate == 0.04)
logtable0.07 <- subset(log_table, migrate.rate == 0.07)
logtable0.1 <- subset(log_table, migrate.rate == 0.1)


anti_join(logtable0,exp_table, by = "anemoneunique")
# all same

cs0 <- sum(((logtable0$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.005 <- sum(((logtable0.005$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)


cs0.01 <- sum(((logtable0.01$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.015<- sum(((logtable0.015$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.02 <- sum(((logtable0.02$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.03 <- sum(((logtable0.03$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.04 <- sum(((logtable0.04$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.07 <- sum(((logtable0.07$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.1 <- sum(((logtable0.1$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)


cs_log_two <- c(cs0,cs0.005,cs0.01,cs0.015,cs0.02,cs0.03,cs0.04,cs0.07,cs0.1)
cs_log_two

```


#xthreefour
```{r}
clusts_26B_modelmerge %>% subset(cluster_type == "Xthreefour") %>%
group_by(anemoneunique) %>%
  dplyr::summarize(obsfrequency = sum(frequency)) -> exp_table

mm_log_migrate_one.subset3day %>% subset(cluster_type == "Xthreefour") %>%
group_by(anemoneunique, migrate.rate) %>%
  dplyr::summarize(modfrequency = sum(frequency)) -> log_table

log_table <- subset(log_table, anemoneunique != "26B.2.16")
log_table <- subset(log_table, anemoneunique != "26B.2.21")
log_table <- subset(log_table, anemoneunique != "26B.3.11")
log_table <- subset(log_table, anemoneunique != "26B.9.31")

# shifted data points by 1 to avoid 0s
log_table$modfrequency = log_table$modfrequency + 1
exp_table$obsfrequency = exp_table$obsfrequency + 1

# chi-square tests
# cs = sum ((obs - exp)^2 / exp)
logtable0 <- subset(log_table, migrate.rate == 0)
logtable0.005 <- subset(log_table, migrate.rate == 0.005)
logtable0.01 <- subset(log_table, migrate.rate == 0.01)
logtable0.015 <- subset(log_table, migrate.rate == 0.015)
logtable0.02 <- subset(log_table, migrate.rate == 0.02)
logtable0.03 <- subset(log_table, migrate.rate == 0.03)
logtable0.04 <- subset(log_table, migrate.rate == 0.04)
logtable0.07 <- subset(log_table, migrate.rate == 0.07)
logtable0.1 <- subset(log_table, migrate.rate == 0.1)


anti_join(logtable0,exp_table, by = "anemoneunique")
# all same

cs0 <- sum(((logtable0$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.005 <- sum(((logtable0.005$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)


cs0.01 <- sum(((logtable0.01$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.015<- sum(((logtable0.015$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.02 <- sum(((logtable0.02$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.03 <- sum(((logtable0.03$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.04 <- sum(((logtable0.04$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.07 <- sum(((logtable0.07$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.1 <- sum(((logtable0.1$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)


cs_log_threefour <- c(cs0,cs0.005,cs0.01,cs0.015,cs0.02,cs0.03,cs0.04,cs0.07,cs0.1)
cs_log_threefour

```

#x5to10
```{r}
clusts_26B_modelmerge %>% subset(cluster_type == "X5to10") %>%
group_by(anemoneunique) %>%
  dplyr::summarize(obsfrequency = sum(frequency)) -> exp_table

mm_log_migrate_one.subset3day %>% subset(cluster_type == "X5to10") %>%
group_by(anemoneunique, migrate.rate) %>%
  dplyr::summarize(modfrequency = sum(frequency)) -> log_table

log_table <- subset(log_table, anemoneunique != "26B.2.16")
log_table <- subset(log_table, anemoneunique != "26B.2.21")
log_table <- subset(log_table, anemoneunique != "26B.3.11")
log_table <- subset(log_table, anemoneunique != "26B.9.31")

# shifted data points by 1 to avoid 0s
log_table$modfrequency = log_table$modfrequency + 1
exp_table$obsfrequency = exp_table$obsfrequency + 1

# chi-square tests
# cs = sum ((obs - exp)^2 / exp)
logtable0 <- subset(log_table, migrate.rate == 0)
logtable0.005 <- subset(log_table, migrate.rate == 0.005)
logtable0.01 <- subset(log_table, migrate.rate == 0.01)
logtable0.015 <- subset(log_table, migrate.rate == 0.015)
logtable0.02 <- subset(log_table, migrate.rate == 0.02)
logtable0.03 <- subset(log_table, migrate.rate == 0.03)
logtable0.04 <- subset(log_table, migrate.rate == 0.04)
logtable0.07 <- subset(log_table, migrate.rate == 0.07)
logtable0.1 <- subset(log_table, migrate.rate == 0.1)


anti_join(logtable0,exp_table, by = "anemoneunique")
# all same

cs0 <- sum(((logtable0$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.005 <- sum(((logtable0.005$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)


cs0.01 <- sum(((logtable0.01$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.015<- sum(((logtable0.015$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.02 <- sum(((logtable0.02$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.03 <- sum(((logtable0.03$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.04 <- sum(((logtable0.04$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.07 <- sum(((logtable0.07$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.1 <- sum(((logtable0.1$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)


cs_log_5to10 <- c(cs0,cs0.005,cs0.01,cs0.015,cs0.02,cs0.03,cs0.04,cs0.07,cs0.1)
cs_log_5to10

```


#xover10
```{r}
clusts_26B_modelmerge %>% subset(cluster_type == "Xover10") %>%
group_by(anemoneunique) %>%
  dplyr::summarize(obsfrequency = sum(frequency)) -> exp_table

mm_log_migrate_one.subset3day %>% subset(cluster_type == "Xover10") %>%
group_by(anemoneunique, migrate.rate) %>%
  dplyr::summarize(modfrequency = sum(frequency)) -> log_table

log_table <- subset(log_table, anemoneunique != "26B.2.16")
log_table <- subset(log_table, anemoneunique != "26B.2.21")
log_table <- subset(log_table, anemoneunique != "26B.3.11")
log_table <- subset(log_table, anemoneunique != "26B.9.31")

# shifted data points by 1 to avoid 0s
log_table$modfrequency = log_table$modfrequency + 1
exp_table$obsfrequency = exp_table$obsfrequency + 1

# chi-square tests
# cs = sum ((obs - exp)^2 / exp)
logtable0 <- subset(log_table, migrate.rate == 0)
logtable0.005 <- subset(log_table, migrate.rate == 0.005)
logtable0.01 <- subset(log_table, migrate.rate == 0.01)
logtable0.015 <- subset(log_table, migrate.rate == 0.015)
logtable0.02 <- subset(log_table, migrate.rate == 0.02)
logtable0.03 <- subset(log_table, migrate.rate == 0.03)
logtable0.04 <- subset(log_table, migrate.rate == 0.04)
logtable0.07 <- subset(log_table, migrate.rate == 0.07)
logtable0.1 <- subset(log_table, migrate.rate == 0.1)


anti_join(logtable0,exp_table, by = "anemoneunique")
# all same

cs0 <- sum(((logtable0$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.005 <- sum(((logtable0.005$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)


cs0.01 <- sum(((logtable0.01$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.015<- sum(((logtable0.015$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.02 <- sum(((logtable0.02$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.03 <- sum(((logtable0.03$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.04 <- sum(((logtable0.04$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.07 <- sum(((logtable0.07$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.1 <- sum(((logtable0.1$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)


cs_log_over10 <- c(cs0,cs0.005,cs0.01,cs0.015,cs0.02,cs0.03,cs0.04,cs0.07,cs0.1)
cs_log_over10

```
#full chisq dataframe
```{r}
df.chsq.log <- rbind(cs_log_tot,cs_log_one,cs_log_two,cs_log_threefour,cs_log_5to10,cs_log_over10)
colnames(df.chsq.log) <- c("0","0.005","0.01","0.015","0.02","0.03","0.04","0.07","0.1")
df.chsq.log
write.csv(df.chsq.log, "df.chsq.log.csv")

```








# sqrt Data for Figure B

# Start here
```{r}
setwd("./summarycsv/migration_models/sqrt/mr0.1/")
migrationmodels.list = list.files(pattern = ".csv")
migrationmodels.read = lapply(migrationmodels.list, read.csv, header=T, stringsAsFactors = F)
migrationmodel.log.0.1 <- rbindlist(migrationmodels.read, fill = T)

setwd("../mr0.015/")
migrationmodels.list = list.files(pattern = ".csv")
migrationmodels.read = lapply(migrationmodels.list, read.csv, header=T, stringsAsFactors = F)
migrationmodel.log.0.015 <- rbindlist(migrationmodels.read, fill = T)

setwd("../mr0.01/")
migrationmodels.list = list.files(pattern = ".csv")
migrationmodels.read = lapply(migrationmodels.list, read.csv, header=T, stringsAsFactors = F)
migrationmodel.log.0.01 <- rbindlist(migrationmodels.read, fill = T)

setwd("../mr0.005/")
migrationmodels.list = list.files(pattern = ".csv")
migrationmodels.read = lapply(migrationmodels.list, read.csv, header=T, stringsAsFactors = F)
migrationmodel.log.0.005 <- rbindlist(migrationmodels.read, fill = T)

setwd("../mr0.0/")
migrationmodels.list = list.files(pattern = ".csv")
migrationmodels.read = lapply(migrationmodels.list, read.csv, header=T, stringsAsFactors = F)
migrationmodel.log.0.0 <- rbindlist(migrationmodels.read, fill = T)

setwd("../mr0.02/")
migrationmodels.list = list.files(pattern = ".csv")
migrationmodels.read = lapply(migrationmodels.list, read.csv, header=T, stringsAsFactors = F)
migrationmodel.log.0.02 <- rbindlist(migrationmodels.read, fill = T)

setwd("../mr0.03/")
migrationmodels.list = list.files(pattern = ".csv")
migrationmodels.read = lapply(migrationmodels.list, read.csv, header=T, stringsAsFactors = F)
migrationmodel.log.0.03 <- rbindlist(migrationmodels.read, fill = T)

setwd("../mr0.04/")
migrationmodels.list = list.files(pattern = ".csv")
migrationmodels.read = lapply(migrationmodels.list, read.csv, header=T, stringsAsFactors = F)
migrationmodel.log.0.04 <- rbindlist(migrationmodels.read, fill = T)

setwd("../mr0.07/")
migrationmodels.list = list.files(pattern = ".csv")
migrationmodels.read = lapply(migrationmodels.list, read.csv, header=T, stringsAsFactors = F)
migrationmodel.log.0.07 <- rbindlist(migrationmodels.read, fill = T)
```

```{r}
migrationmodel.log.0.0$migrate.rate <- 0
migrationmodel.log.0.005$migrate.rate <- 0.005
migrationmodel.log.0.01$migrate.rate <- 0.01
migrationmodel.log.0.015$migrate.rate <- 0.015
migrationmodel.log.0.1$migrate.rate <- 0.1
migrationmodel.log.0.02$migrate.rate <- 0.02
migrationmodel.log.0.03$migrate.rate <- 0.03
migrationmodel.log.0.04$migrate.rate <- 0.04
migrationmodel.log.0.07$migrate.rate <- 0.07



migrationmodelcombine.log <- bind_rows(migrationmodel.log.0.0, migrationmodel.log.0.005, migrationmodel.log.0.01, migrationmodel.log.0.02,
migrationmodel.log.0.03,
migrationmodel.log.0.04,
migrationmodel.log.0.015,
migrationmodel.log.0.1,
migrationmodel.log.0.07
)



# round cells

migrationmodelcombine.log$cellspercluster <- round(migrationmodelcombine.log$cells)
migrationmodelcombine.log <- subset(migrationmodelcombine.log, cellspercluster > 0)




# Create breaks to divide groups


breaks = seq(1,2000,1)
breaks_names = seq(1,1999,1)



# Create frequency table


migrationmodelcombine.log$migrate.rate <- as.factor(migrationmodelcombine.log$migrate.rate)

migrationmodelcombine2.log <- migrationmodelcombine.log %>%
group_by(sample.name, Subsample, end.day, migrate.rate) %>%
  dplyr::summarize(cellspercluster = cellspercluster, histgroup = cut(cellspercluster, right = F, breaks = breaks, labels = breaks_names), freq = 1)




# turn frequency table into histogram summary table


migrationmodel_sum.log <- migrationmodelcombine2.log %>%
  group_by(sample.name, Subsample, end.day, migrate.rate, histgroup) %>%
  dplyr::summarize(frequency = sum(freq))




arrange(migrationmodel_sum.log, histgroup)

# pivot to wide

migrationmodel_sum_wide.log <- migrationmodel_sum.log %>% 
    pivot_wider(names_from = histgroup, values_from = frequency, values_fill = 0, names_sort = T)


colnames(migrationmodel_sum_wide.log) <- paste("X", colnames(migrationmodel_sum_wide.log), sep = "")

migrationmodel_sum_wide.log <- dplyr::rename(migrationmodel_sum_wide.log, sample.name = Xsample.name)
migrationmodel_sum_wide.log <- dplyr::rename(migrationmodel_sum_wide.log, Subsample = XSubsample)
migrationmodel_sum_wide.log <- dplyr::rename(migrationmodel_sum_wide.log, end.day = Xend.day)
migrationmodel_sum_wide.log <- dplyr::rename(migrationmodel_sum_wide.log, migrate.rate = Xmigrate.rate)

migmodel.ncol <- length(migrationmodel_sum_wide.log)


# create same groups as before
migrationmodel_sum_wide.log$Xone <- migrationmodel_sum_wide.log$X1

migrationmodel_sum_wide.log$Xtwo <- migrationmodel_sum_wide.log$X2

migrationmodel_sum_wide.log$Xthreefour <- migrationmodel_sum_wide.log$X3 + migrationmodel_sum_wide.log$X4
  

migrationmodel_sum_wide.log <- migrationmodel_sum_wide.log %>% ungroup %>%
  
  mutate(X3to4 = dplyr::select(., X3:X4) %>% rowSums(na.rm = TRUE))
migrationmodel_sum_wide.log <- migrationmodel_sum_wide.log %>%
    mutate(X5to10 = dplyr::select(., X5:X10) %>% rowSums(na.rm = TRUE))

migrationmodel_sum_wide.log <- migrationmodel_sum_wide.log %>%
    mutate(X15to50 = dplyr::select(., X15:X50) %>% rowSums(na.rm = TRUE))

migrationmodel_sum_wide.log <- migrationmodel_sum_wide.log %>%
    mutate(Xover50 = dplyr::select(., X51:all_of(migmodel.ncol)) %>% rowSums(na.rm = TRUE))

migrationmodel_sum_wide.log <- migrationmodel_sum_wide.log %>%
    mutate(Xover10 = dplyr::select(., X11:all_of(migmodel.ncol)) %>% rowSums(na.rm = TRUE))

migrationmodel_sum_wide.log <- migrationmodel_sum_wide.log %>%
    mutate(hist_count = dplyr::select(., X1:all_of(migmodel.ncol)) %>% rowSums(na.rm = TRUE))




# hist sums


migrationmodel_sum_wide.log %>% 
dplyr::select(., X1:all_of(migmodel.ncol)) -> histnamesubset

histnames <- as.numeric(unlist(str_extract_all(names(histnamesubset), '[0-9]+')))

histsumsubset <- data.frame(mapply(`*`,histnamesubset,histnames))

colnames(histsumsubset) <- paste(colnames(histsumsubset),"hist",sep="_")
histsumsubset$hist_sum <- rowSums(histsumsubset)




migrationmodel_sum_wide.log$hist_sum <- histsumsubset$hist_sum





# convert short to long df


migrationmodel_log_pop_long <- reshape2::melt(migrationmodel_sum_wide.log,
        # ID variables - all the variables to keep but not split apart on
    id.vars=c(1:4),
        # The source columns
        # Name of the destination column that will identify the original
        # column that the measurement came from
    variable.name="cluster_type",
    value.name="frequency"
)




mm_log_migrate_one <- subset(migrationmodel_log_pop_long, (cluster_type %in% c("Xone","Xtwo","Xthreefour","X5to10","Xover10")))

mm_log_migrate_one$day <- mm_log_migrate_one$day_post_inoc



# subsets


mm_log_migrate_one.subset3day <- mm_log_migrate_one[mm_log_migrate_one$end.day %in% c(4,7,9,11,14,16,18,21,25,29,31),]

mm_log_migrate_one.subset3day$anemone <- str_sub(mm_log_migrate_one.subset3day$sample.name,1,nchar(mm_log_migrate_one.subset3day$sample.name)-2)

mm_log_migrate_one.subset3day$anemoneunique <- str_c(mm_log_migrate_one.subset3day$anemone, sep = ".", mm_log_migrate_one.subset3day$end.day)


mm_log_migrate_one.subset3day$unique <- str_c(mm_log_migrate_one.subset3day$anemoneunique, sep = ".", mm_log_migrate_one.subset3day$Subsample)
```

```{r}
clusts_26B_modelmerge %>%
group_by(anemoneunique) %>%
  dplyr::summarize(obsfrequency = sum(frequency)) -> exp_table



mm_log_migrate_one.subset3day %>%
group_by(anemoneunique, migrate.rate) %>%
  dplyr::summarize(modfrequency = sum(frequency)) -> log_table

log_table <- subset(log_table, anemoneunique != "26B.2.16")
log_table <- subset(log_table, anemoneunique != "26B.2.21")
log_table <- subset(log_table, anemoneunique != "26B.3.11")
log_table <- subset(log_table, anemoneunique != "26B.9.31")


# chi-square tests
# cs = sum ((obs - exp)^2 / exp)
logtable0 <- subset(log_table, migrate.rate == 0)
logtable0.005 <- subset(log_table, migrate.rate == 0.005)
logtable0.01 <- subset(log_table, migrate.rate == 0.01)
logtable0.015 <- subset(log_table, migrate.rate == 0.015)
logtable0.02 <- subset(log_table, migrate.rate == 0.02)
logtable0.03 <- subset(log_table, migrate.rate == 0.03)
logtable0.04 <- subset(log_table, migrate.rate == 0.04)
logtable0.07 <- subset(log_table, migrate.rate == 0.07)
logtable0.1 <- subset(log_table, migrate.rate == 0.1)


anti_join(logtable0,exp_table, by = "anemoneunique")
# all same
```

```{r}
cs0 <- sum(((logtable0$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.005 <- sum(((logtable0.005$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.01 <- sum(((logtable0.01$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.015<- sum(((logtable0.015$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.02 <- sum(((logtable0.02$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.03 <- sum(((logtable0.03$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.04 <- sum(((logtable0.04$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.07 <- sum(((logtable0.07$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.1 <- sum(((logtable0.1$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)


cs_log_tot <- c(cs0,cs0.005,cs0.01,cs0.015,cs0.02,cs0.03,cs0.04,cs0.07,cs0.1)
cs_log_tot

```

#xone
```{r}
clusts_26B_modelmerge %>% subset(cluster_type == "Xone") %>%
group_by(anemoneunique) %>%
  dplyr::summarize(obsfrequency = sum(frequency)) -> exp_table

mm_log_migrate_one.subset3day %>% subset(cluster_type == "Xone") %>%
group_by(anemoneunique, migrate.rate) %>%
  dplyr::summarize(modfrequency = sum(frequency)) -> log_table

log_table <- subset(log_table, anemoneunique != "26B.2.16")
log_table <- subset(log_table, anemoneunique != "26B.2.21")
log_table <- subset(log_table, anemoneunique != "26B.3.11")
log_table <- subset(log_table, anemoneunique != "26B.9.31")

# shifted data points by 1 to avoid 0s
log_table$modfrequency = log_table$modfrequency + 1
exp_table$obsfrequency = exp_table$obsfrequency + 1

# chi-square tests
# cs = sum ((obs - exp)^2 / exp)
logtable0 <- subset(log_table, migrate.rate == 0)
logtable0.005 <- subset(log_table, migrate.rate == 0.005)
logtable0.01 <- subset(log_table, migrate.rate == 0.01)
logtable0.015 <- subset(log_table, migrate.rate == 0.015)
logtable0.02 <- subset(log_table, migrate.rate == 0.02)
logtable0.03 <- subset(log_table, migrate.rate == 0.03)
logtable0.04 <- subset(log_table, migrate.rate == 0.04)
logtable0.07 <- subset(log_table, migrate.rate == 0.07)
logtable0.1 <- subset(log_table, migrate.rate == 0.1)


anti_join(logtable0,exp_table, by = "anemoneunique")
# all same

cs0 <- sum(((logtable0$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.005 <- sum(((logtable0.005$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)


cs0.01 <- sum(((logtable0.01$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.015<- sum(((logtable0.015$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.02 <- sum(((logtable0.02$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.03 <- sum(((logtable0.03$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.04 <- sum(((logtable0.04$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.07 <- sum(((logtable0.07$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.1 <- sum(((logtable0.1$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)


cs_log_one <- c(cs0,cs0.005,cs0.01,cs0.015,cs0.02,cs0.03,cs0.04,cs0.07,cs0.1)
cs_log_one

```


#xtwo
```{r}
clusts_26B_modelmerge %>% subset(cluster_type == "Xtwo") %>%
group_by(anemoneunique) %>%
  dplyr::summarize(obsfrequency = sum(frequency)) -> exp_table

mm_log_migrate_one.subset3day %>% subset(cluster_type == "Xtwo") %>%
group_by(anemoneunique, migrate.rate) %>%
  dplyr::summarize(modfrequency = sum(frequency)) -> log_table

log_table <- subset(log_table, anemoneunique != "26B.2.16")
log_table <- subset(log_table, anemoneunique != "26B.2.21")
log_table <- subset(log_table, anemoneunique != "26B.3.11")
log_table <- subset(log_table, anemoneunique != "26B.9.31")

# shifted data points by 1 to avoid 0s
log_table$modfrequency = log_table$modfrequency + 1
exp_table$obsfrequency = exp_table$obsfrequency + 1

# chi-square tests
# cs = sum ((obs - exp)^2 / exp)
logtable0 <- subset(log_table, migrate.rate == 0)
logtable0.005 <- subset(log_table, migrate.rate == 0.005)
logtable0.01 <- subset(log_table, migrate.rate == 0.01)
logtable0.015 <- subset(log_table, migrate.rate == 0.015)
logtable0.02 <- subset(log_table, migrate.rate == 0.02)
logtable0.03 <- subset(log_table, migrate.rate == 0.03)
logtable0.04 <- subset(log_table, migrate.rate == 0.04)
logtable0.07 <- subset(log_table, migrate.rate == 0.07)
logtable0.1 <- subset(log_table, migrate.rate == 0.1)


anti_join(logtable0,exp_table, by = "anemoneunique")
# all same

cs0 <- sum(((logtable0$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.005 <- sum(((logtable0.005$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)


cs0.01 <- sum(((logtable0.01$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.015<- sum(((logtable0.015$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.02 <- sum(((logtable0.02$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.03 <- sum(((logtable0.03$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.04 <- sum(((logtable0.04$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.07 <- sum(((logtable0.07$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.1 <- sum(((logtable0.1$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)


cs_log_two <- c(cs0,cs0.005,cs0.01,cs0.015,cs0.02,cs0.03,cs0.04,cs0.07,cs0.1)
cs_log_two

```


#xthreefour
```{r}
clusts_26B_modelmerge %>% subset(cluster_type == "Xthreefour") %>%
group_by(anemoneunique) %>%
  dplyr::summarize(obsfrequency = sum(frequency)) -> exp_table

mm_log_migrate_one.subset3day %>% subset(cluster_type == "Xthreefour") %>%
group_by(anemoneunique, migrate.rate) %>%
  dplyr::summarize(modfrequency = sum(frequency)) -> log_table

log_table <- subset(log_table, anemoneunique != "26B.2.16")
log_table <- subset(log_table, anemoneunique != "26B.2.21")
log_table <- subset(log_table, anemoneunique != "26B.3.11")
log_table <- subset(log_table, anemoneunique != "26B.9.31")

# shifted data points by 1 to avoid 0s
log_table$modfrequency = log_table$modfrequency + 1
exp_table$obsfrequency = exp_table$obsfrequency + 1

# chi-square tests
# cs = sum ((obs - exp)^2 / exp)
logtable0 <- subset(log_table, migrate.rate == 0)
logtable0.005 <- subset(log_table, migrate.rate == 0.005)
logtable0.01 <- subset(log_table, migrate.rate == 0.01)
logtable0.015 <- subset(log_table, migrate.rate == 0.015)
logtable0.02 <- subset(log_table, migrate.rate == 0.02)
logtable0.03 <- subset(log_table, migrate.rate == 0.03)
logtable0.04 <- subset(log_table, migrate.rate == 0.04)
logtable0.07 <- subset(log_table, migrate.rate == 0.07)
logtable0.1 <- subset(log_table, migrate.rate == 0.1)


anti_join(logtable0,exp_table, by = "anemoneunique")
# all same

cs0 <- sum(((logtable0$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.005 <- sum(((logtable0.005$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)


cs0.01 <- sum(((logtable0.01$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.015<- sum(((logtable0.015$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.02 <- sum(((logtable0.02$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.03 <- sum(((logtable0.03$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.04 <- sum(((logtable0.04$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.07 <- sum(((logtable0.07$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.1 <- sum(((logtable0.1$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)


cs_log_threefour <- c(cs0,cs0.005,cs0.01,cs0.015,cs0.02,cs0.03,cs0.04,cs0.07,cs0.1)
cs_log_threefour

```

#x5to10
```{r}
clusts_26B_modelmerge %>% subset(cluster_type == "X5to10") %>%
group_by(anemoneunique) %>%
  dplyr::summarize(obsfrequency = sum(frequency)) -> exp_table

mm_log_migrate_one.subset3day %>% subset(cluster_type == "X5to10") %>%
group_by(anemoneunique, migrate.rate) %>%
  dplyr::summarize(modfrequency = sum(frequency)) -> log_table

log_table <- subset(log_table, anemoneunique != "26B.2.16")
log_table <- subset(log_table, anemoneunique != "26B.2.21")
log_table <- subset(log_table, anemoneunique != "26B.3.11")
log_table <- subset(log_table, anemoneunique != "26B.9.31")

# shifted data points by 1 to avoid 0s
log_table$modfrequency = log_table$modfrequency + 1
exp_table$obsfrequency = exp_table$obsfrequency + 1

# chi-square tests
# cs = sum ((obs - exp)^2 / exp)
logtable0 <- subset(log_table, migrate.rate == 0)
logtable0.005 <- subset(log_table, migrate.rate == 0.005)
logtable0.01 <- subset(log_table, migrate.rate == 0.01)
logtable0.015 <- subset(log_table, migrate.rate == 0.015)
logtable0.02 <- subset(log_table, migrate.rate == 0.02)
logtable0.03 <- subset(log_table, migrate.rate == 0.03)
logtable0.04 <- subset(log_table, migrate.rate == 0.04)
logtable0.07 <- subset(log_table, migrate.rate == 0.07)
logtable0.1 <- subset(log_table, migrate.rate == 0.1)


anti_join(logtable0,exp_table, by = "anemoneunique")
# all same

cs0 <- sum(((logtable0$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.005 <- sum(((logtable0.005$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)


cs0.01 <- sum(((logtable0.01$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.015<- sum(((logtable0.015$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.02 <- sum(((logtable0.02$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.03 <- sum(((logtable0.03$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.04 <- sum(((logtable0.04$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.07 <- sum(((logtable0.07$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.1 <- sum(((logtable0.1$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)


cs_log_5to10 <- c(cs0,cs0.005,cs0.01,cs0.015,cs0.02,cs0.03,cs0.04,cs0.07,cs0.1)
cs_log_5to10

```


#xover10
```{r}
clusts_26B_modelmerge %>% subset(cluster_type == "Xover10") %>%
group_by(anemoneunique) %>%
  dplyr::summarize(obsfrequency = sum(frequency)) -> exp_table

mm_log_migrate_one.subset3day %>% subset(cluster_type == "Xover10") %>%
group_by(anemoneunique, migrate.rate) %>%
  dplyr::summarize(modfrequency = sum(frequency)) -> log_table

log_table <- subset(log_table, anemoneunique != "26B.2.16")
log_table <- subset(log_table, anemoneunique != "26B.2.21")
log_table <- subset(log_table, anemoneunique != "26B.3.11")
log_table <- subset(log_table, anemoneunique != "26B.9.31")

# shifted data points by 1 to avoid 0s
log_table$modfrequency = log_table$modfrequency + 1
exp_table$obsfrequency = exp_table$obsfrequency + 1

# chi-square tests
# cs = sum ((obs - exp)^2 / exp)
logtable0 <- subset(log_table, migrate.rate == 0)
logtable0.005 <- subset(log_table, migrate.rate == 0.005)
logtable0.01 <- subset(log_table, migrate.rate == 0.01)
logtable0.015 <- subset(log_table, migrate.rate == 0.015)
logtable0.02 <- subset(log_table, migrate.rate == 0.02)
logtable0.03 <- subset(log_table, migrate.rate == 0.03)
logtable0.04 <- subset(log_table, migrate.rate == 0.04)
logtable0.07 <- subset(log_table, migrate.rate == 0.07)
logtable0.1 <- subset(log_table, migrate.rate == 0.1)


anti_join(logtable0,exp_table, by = "anemoneunique")
# all same

cs0 <- sum(((logtable0$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.005 <- sum(((logtable0.005$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)


cs0.01 <- sum(((logtable0.01$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.015<- sum(((logtable0.015$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.02 <- sum(((logtable0.02$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.03 <- sum(((logtable0.03$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.04 <- sum(((logtable0.04$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.07 <- sum(((logtable0.07$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.1 <- sum(((logtable0.1$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)


cs_log_over10 <- c(cs0,cs0.005,cs0.01,cs0.015,cs0.02,cs0.03,cs0.04,cs0.07,cs0.1)
cs_log_over10

```
#full chisq dataframe
```{r}
df.chsq.sqrt <- rbind(cs_log_tot,cs_log_one,cs_log_two,cs_log_threefour,cs_log_5to10,cs_log_over10)
colnames(df.chsq.sqrt) <- c("0","0.005","0.015","0.01","0.02","0.03","0.04","0.07","0.1")
df.chsq.sqrt
write.csv(df.chsq.sqrt, "df.chsq.sqrt.csv")

```











# fourrt Data for Figure B

# Start here
```{r}
setwd("./summarycsv/migration_models/fourrt/mr0.1/")
migrationmodels.list = list.files(pattern = ".csv")
migrationmodels.read = lapply(migrationmodels.list, read.csv, header=T, stringsAsFactors = F)
migrationmodel.log.0.1 <- rbindlist(migrationmodels.read, fill = T)

setwd("../mr0.015/")
migrationmodels.list = list.files(pattern = ".csv")
migrationmodels.read = lapply(migrationmodels.list, read.csv, header=T, stringsAsFactors = F)
migrationmodel.log.0.015 <- rbindlist(migrationmodels.read, fill = T)

setwd("../mr0.01/")
migrationmodels.list = list.files(pattern = ".csv")
migrationmodels.read = lapply(migrationmodels.list, read.csv, header=T, stringsAsFactors = F)
migrationmodel.log.0.01 <- rbindlist(migrationmodels.read, fill = T)

setwd("../mr0.005/")
migrationmodels.list = list.files(pattern = ".csv")
migrationmodels.read = lapply(migrationmodels.list, read.csv, header=T, stringsAsFactors = F)
migrationmodel.log.0.005 <- rbindlist(migrationmodels.read, fill = T)

setwd("../mr0.0/")
migrationmodels.list = list.files(pattern = ".csv")
migrationmodels.read = lapply(migrationmodels.list, read.csv, header=T, stringsAsFactors = F)
migrationmodel.log.0.0 <- rbindlist(migrationmodels.read, fill = T)

setwd("../mr0.02/")
migrationmodels.list = list.files(pattern = ".csv")
migrationmodels.read = lapply(migrationmodels.list, read.csv, header=T, stringsAsFactors = F)
migrationmodel.log.0.02 <- rbindlist(migrationmodels.read, fill = T)

setwd("../mr0.03/")
migrationmodels.list = list.files(pattern = ".csv")
migrationmodels.read = lapply(migrationmodels.list, read.csv, header=T, stringsAsFactors = F)
migrationmodel.log.0.03 <- rbindlist(migrationmodels.read, fill = T)

setwd("../mr0.04/")
migrationmodels.list = list.files(pattern = ".csv")
migrationmodels.read = lapply(migrationmodels.list, read.csv, header=T, stringsAsFactors = F)
migrationmodel.log.0.04 <- rbindlist(migrationmodels.read, fill = T)

setwd("../mr0.07/")
migrationmodels.list = list.files(pattern = ".csv")
migrationmodels.read = lapply(migrationmodels.list, read.csv, header=T, stringsAsFactors = F)
migrationmodel.log.0.07 <- rbindlist(migrationmodels.read, fill = T)
```

```{r}
migrationmodel.log.0.0$migrate.rate <- 0
migrationmodel.log.0.005$migrate.rate <- 0.005
migrationmodel.log.0.01$migrate.rate <- 0.01
migrationmodel.log.0.015$migrate.rate <- 0.015
migrationmodel.log.0.1$migrate.rate <- 0.1
migrationmodel.log.0.02$migrate.rate <- 0.02
migrationmodel.log.0.03$migrate.rate <- 0.03
migrationmodel.log.0.04$migrate.rate <- 0.04
migrationmodel.log.0.07$migrate.rate <- 0.07



migrationmodelcombine.log <- bind_rows(migrationmodel.log.0.0, migrationmodel.log.0.005, migrationmodel.log.0.01, migrationmodel.log.0.02,
migrationmodel.log.0.03,
migrationmodel.log.0.04,
migrationmodel.log.0.015,
migrationmodel.log.0.1,
migrationmodel.log.0.07
)



# round cells

migrationmodelcombine.log$cellspercluster <- round(migrationmodelcombine.log$cells)
migrationmodelcombine.log <- subset(migrationmodelcombine.log, cellspercluster > 0)




# Create breaks to divide groups


breaks = seq(1,2000,1)
breaks_names = seq(1,1999,1)



# Create frequency table


migrationmodelcombine.log$migrate.rate <- as.factor(migrationmodelcombine.log$migrate.rate)

migrationmodelcombine2.log <- migrationmodelcombine.log %>%
group_by(sample.name, Subsample, end.day, migrate.rate) %>%
  dplyr::summarize(cellspercluster = cellspercluster, histgroup = cut(cellspercluster, right = F, breaks = breaks, labels = breaks_names), freq = 1)




# turn frequency table into histogram summary table


migrationmodel_sum.log <- migrationmodelcombine2.log %>%
  group_by(sample.name, Subsample, end.day, migrate.rate, histgroup) %>%
  dplyr::summarize(frequency = sum(freq))




arrange(migrationmodel_sum.log, histgroup)

# pivot to wide

migrationmodel_sum_wide.log <- migrationmodel_sum.log %>% 
    pivot_wider(names_from = histgroup, values_from = frequency, values_fill = 0, names_sort = T)


colnames(migrationmodel_sum_wide.log) <- paste("X", colnames(migrationmodel_sum_wide.log), sep = "")

migrationmodel_sum_wide.log <- dplyr::rename(migrationmodel_sum_wide.log, sample.name = Xsample.name)
migrationmodel_sum_wide.log <- dplyr::rename(migrationmodel_sum_wide.log, Subsample = XSubsample)
migrationmodel_sum_wide.log <- dplyr::rename(migrationmodel_sum_wide.log, end.day = Xend.day)
migrationmodel_sum_wide.log <- dplyr::rename(migrationmodel_sum_wide.log, migrate.rate = Xmigrate.rate)

migmodel.ncol <- length(migrationmodel_sum_wide.log)


# create same groups as before
migrationmodel_sum_wide.log$Xone <- migrationmodel_sum_wide.log$X1

migrationmodel_sum_wide.log$Xtwo <- migrationmodel_sum_wide.log$X2

migrationmodel_sum_wide.log$Xthreefour <- migrationmodel_sum_wide.log$X3 + migrationmodel_sum_wide.log$X4
  

migrationmodel_sum_wide.log <- migrationmodel_sum_wide.log %>% ungroup %>%
  
  mutate(X3to4 = dplyr::select(., X3:X4) %>% rowSums(na.rm = TRUE))
migrationmodel_sum_wide.log <- migrationmodel_sum_wide.log %>%
    mutate(X5to10 = dplyr::select(., X5:X10) %>% rowSums(na.rm = TRUE))

migrationmodel_sum_wide.log <- migrationmodel_sum_wide.log %>%
    mutate(X15to50 = dplyr::select(., X15:X50) %>% rowSums(na.rm = TRUE))

migrationmodel_sum_wide.log <- migrationmodel_sum_wide.log %>%
    mutate(Xover50 = dplyr::select(., X51:all_of(migmodel.ncol)) %>% rowSums(na.rm = TRUE))

migrationmodel_sum_wide.log <- migrationmodel_sum_wide.log %>%
    mutate(Xover10 = dplyr::select(., X11:all_of(migmodel.ncol)) %>% rowSums(na.rm = TRUE))

migrationmodel_sum_wide.log <- migrationmodel_sum_wide.log %>%
    mutate(hist_count = dplyr::select(., X1:all_of(migmodel.ncol)) %>% rowSums(na.rm = TRUE))




# hist sums


migrationmodel_sum_wide.log %>% 
dplyr::select(., X1:all_of(migmodel.ncol)) -> histnamesubset

histnames <- as.numeric(unlist(str_extract_all(names(histnamesubset), '[0-9]+')))

histsumsubset <- data.frame(mapply(`*`,histnamesubset,histnames))

colnames(histsumsubset) <- paste(colnames(histsumsubset),"hist",sep="_")
histsumsubset$hist_sum <- rowSums(histsumsubset)




migrationmodel_sum_wide.log$hist_sum <- histsumsubset$hist_sum





# convert short to long df


migrationmodel_log_pop_long <- reshape2::melt(migrationmodel_sum_wide.log,
        # ID variables - all the variables to keep but not split apart on
    id.vars=c(1:4),
        # The source columns
        # Name of the destination column that will identify the original
        # column that the measurement came from
    variable.name="cluster_type",
    value.name="frequency"
)




mm_log_migrate_one <- subset(migrationmodel_log_pop_long, (cluster_type %in% c("Xone","Xtwo","Xthreefour","X5to10","Xover10")))

mm_log_migrate_one$day <- mm_log_migrate_one$day_post_inoc



# subsets


mm_log_migrate_one.subset3day <- mm_log_migrate_one[mm_log_migrate_one$end.day %in% c(4,7,9,11,14,16,18,21,25,29,31),]

mm_log_migrate_one.subset3day$anemone <- str_sub(mm_log_migrate_one.subset3day$sample.name,1,nchar(mm_log_migrate_one.subset3day$sample.name)-2)

mm_log_migrate_one.subset3day$anemoneunique <- str_c(mm_log_migrate_one.subset3day$anemone, sep = ".", mm_log_migrate_one.subset3day$end.day)


mm_log_migrate_one.subset3day$unique <- str_c(mm_log_migrate_one.subset3day$anemoneunique, sep = ".", mm_log_migrate_one.subset3day$Subsample)
```

```{r}
clusts_26B_modelmerge %>%
group_by(anemoneunique) %>%
  dplyr::summarize(obsfrequency = sum(frequency)) -> exp_table


mm_log_migrate_one.subset3day %>%
group_by(anemoneunique, migrate.rate) %>%
  dplyr::summarize(modfrequency = sum(frequency)) -> log_table

log_table <- subset(log_table, anemoneunique != "26B.2.16")
log_table <- subset(log_table, anemoneunique != "26B.2.21")
log_table <- subset(log_table, anemoneunique != "26B.3.11")
log_table <- subset(log_table, anemoneunique != "26B.9.31")


# chi-square tests
# cs = sum ((obs - exp)^2 / exp)
logtable0 <- subset(log_table, migrate.rate == 0)
logtable0.005 <- subset(log_table, migrate.rate == 0.005)
logtable0.01 <- subset(log_table, migrate.rate == 0.01)
logtable0.015 <- subset(log_table, migrate.rate == 0.015)
logtable0.02 <- subset(log_table, migrate.rate == 0.02)
logtable0.03 <- subset(log_table, migrate.rate == 0.03)
logtable0.04 <- subset(log_table, migrate.rate == 0.04)
logtable0.07 <- subset(log_table, migrate.rate == 0.07)
logtable0.1 <- subset(log_table, migrate.rate == 0.1)


anti_join(logtable0,exp_table, by = "anemoneunique")
# all same
```

```{r}
cs0 <- sum(((logtable0$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.005 <- sum(((logtable0.005$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.01 <- sum(((logtable0.01$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.015<- sum(((logtable0.015$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.02 <- sum(((logtable0.02$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.03 <- sum(((logtable0.03$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.04 <- sum(((logtable0.04$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.07 <- sum(((logtable0.07$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.1 <- sum(((logtable0.1$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)


cs_log_tot <- c(cs0,cs0.005,cs0.01,cs0.015,cs0.02,cs0.03,cs0.04,cs0.07,cs0.1)
cs_log_tot

```


#xone
```{r}
clusts_26B_modelmerge %>% subset(cluster_type == "Xone") %>%
group_by(anemoneunique) %>%
  dplyr::summarize(obsfrequency = sum(frequency)) -> exp_table

mm_log_migrate_one.subset3day %>% subset(cluster_type == "Xone") %>%
group_by(anemoneunique, migrate.rate) %>%
  dplyr::summarize(modfrequency = sum(frequency)) -> log_table

log_table <- subset(log_table, anemoneunique != "26B.2.16")
log_table <- subset(log_table, anemoneunique != "26B.2.21")
log_table <- subset(log_table, anemoneunique != "26B.3.11")
log_table <- subset(log_table, anemoneunique != "26B.9.31")

# shifted data points by 1 to avoid 0s
log_table$modfrequency = log_table$modfrequency + 1
exp_table$obsfrequency = exp_table$obsfrequency + 1

# chi-square tests
# cs = sum ((obs - exp)^2 / exp)
logtable0 <- subset(log_table, migrate.rate == 0)
logtable0.005 <- subset(log_table, migrate.rate == 0.005)
logtable0.01 <- subset(log_table, migrate.rate == 0.01)
logtable0.015 <- subset(log_table, migrate.rate == 0.015)
logtable0.02 <- subset(log_table, migrate.rate == 0.02)
logtable0.03 <- subset(log_table, migrate.rate == 0.03)
logtable0.04 <- subset(log_table, migrate.rate == 0.04)
logtable0.07 <- subset(log_table, migrate.rate == 0.07)
logtable0.1 <- subset(log_table, migrate.rate == 0.1)


anti_join(logtable0,exp_table, by = "anemoneunique")
# all same

cs0 <- sum(((logtable0$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.005 <- sum(((logtable0.005$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)


cs0.01 <- sum(((logtable0.01$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.015<- sum(((logtable0.015$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.02 <- sum(((logtable0.02$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.03 <- sum(((logtable0.03$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.04 <- sum(((logtable0.04$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.07 <- sum(((logtable0.07$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.1 <- sum(((logtable0.1$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)


cs_log_one <- c(cs0,cs0.005,cs0.01,cs0.015,cs0.02,cs0.03,cs0.04,cs0.07,cs0.1)
cs_log_one

```


#xtwo
```{r}
clusts_26B_modelmerge %>% subset(cluster_type == "Xtwo") %>%
group_by(anemoneunique) %>%
  dplyr::summarize(obsfrequency = sum(frequency)) -> exp_table

mm_log_migrate_one.subset3day %>% subset(cluster_type == "Xtwo") %>%
group_by(anemoneunique, migrate.rate) %>%
  dplyr::summarize(modfrequency = sum(frequency)) -> log_table

log_table <- subset(log_table, anemoneunique != "26B.2.16")
log_table <- subset(log_table, anemoneunique != "26B.2.21")
log_table <- subset(log_table, anemoneunique != "26B.3.11")
log_table <- subset(log_table, anemoneunique != "26B.9.31")

# shifted data points by 1 to avoid 0s
log_table$modfrequency = log_table$modfrequency + 1
exp_table$obsfrequency = exp_table$obsfrequency + 1

# chi-square tests
# cs = sum ((obs - exp)^2 / exp)
logtable0 <- subset(log_table, migrate.rate == 0)
logtable0.005 <- subset(log_table, migrate.rate == 0.005)
logtable0.01 <- subset(log_table, migrate.rate == 0.01)
logtable0.015 <- subset(log_table, migrate.rate == 0.015)
logtable0.02 <- subset(log_table, migrate.rate == 0.02)
logtable0.03 <- subset(log_table, migrate.rate == 0.03)
logtable0.04 <- subset(log_table, migrate.rate == 0.04)
logtable0.07 <- subset(log_table, migrate.rate == 0.07)
logtable0.1 <- subset(log_table, migrate.rate == 0.1)


anti_join(logtable0,exp_table, by = "anemoneunique")
# all same

cs0 <- sum(((logtable0$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.005 <- sum(((logtable0.005$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)


cs0.01 <- sum(((logtable0.01$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.015<- sum(((logtable0.015$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.02 <- sum(((logtable0.02$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.03 <- sum(((logtable0.03$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.04 <- sum(((logtable0.04$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.07 <- sum(((logtable0.07$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.1 <- sum(((logtable0.1$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)


cs_log_two <- c(cs0,cs0.005,cs0.01,cs0.015,cs0.02,cs0.03,cs0.04,cs0.07,cs0.1)
cs_log_two

```


#xthreefour
```{r}
clusts_26B_modelmerge %>% subset(cluster_type == "Xthreefour") %>%
group_by(anemoneunique) %>%
  dplyr::summarize(obsfrequency = sum(frequency)) -> exp_table

mm_log_migrate_one.subset3day %>% subset(cluster_type == "Xthreefour") %>%
group_by(anemoneunique, migrate.rate) %>%
  dplyr::summarize(modfrequency = sum(frequency)) -> log_table

log_table <- subset(log_table, anemoneunique != "26B.2.16")
log_table <- subset(log_table, anemoneunique != "26B.2.21")
log_table <- subset(log_table, anemoneunique != "26B.3.11")
log_table <- subset(log_table, anemoneunique != "26B.9.31")

# shifted data points by 1 to avoid 0s
log_table$modfrequency = log_table$modfrequency + 1
exp_table$obsfrequency = exp_table$obsfrequency + 1

# chi-square tests
# cs = sum ((obs - exp)^2 / exp)
logtable0 <- subset(log_table, migrate.rate == 0)
logtable0.005 <- subset(log_table, migrate.rate == 0.005)
logtable0.01 <- subset(log_table, migrate.rate == 0.01)
logtable0.015 <- subset(log_table, migrate.rate == 0.015)
logtable0.02 <- subset(log_table, migrate.rate == 0.02)
logtable0.03 <- subset(log_table, migrate.rate == 0.03)
logtable0.04 <- subset(log_table, migrate.rate == 0.04)
logtable0.07 <- subset(log_table, migrate.rate == 0.07)
logtable0.1 <- subset(log_table, migrate.rate == 0.1)


anti_join(logtable0,exp_table, by = "anemoneunique")
# all same

cs0 <- sum(((logtable0$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.005 <- sum(((logtable0.005$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)


cs0.01 <- sum(((logtable0.01$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.015<- sum(((logtable0.015$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.02 <- sum(((logtable0.02$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.03 <- sum(((logtable0.03$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.04 <- sum(((logtable0.04$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.07 <- sum(((logtable0.07$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.1 <- sum(((logtable0.1$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)


cs_log_threefour <- c(cs0,cs0.005,cs0.01,cs0.015,cs0.02,cs0.03,cs0.04,cs0.07,cs0.1)
cs_log_threefour

```

#x5to10
```{r}
clusts_26B_modelmerge %>% subset(cluster_type == "X5to10") %>%
group_by(anemoneunique) %>%
  dplyr::summarize(obsfrequency = sum(frequency)) -> exp_table

mm_log_migrate_one.subset3day %>% subset(cluster_type == "X5to10") %>%
group_by(anemoneunique, migrate.rate) %>%
  dplyr::summarize(modfrequency = sum(frequency)) -> log_table

log_table <- subset(log_table, anemoneunique != "26B.2.16")
log_table <- subset(log_table, anemoneunique != "26B.2.21")
log_table <- subset(log_table, anemoneunique != "26B.3.11")
log_table <- subset(log_table, anemoneunique != "26B.9.31")

# shifted data points by 1 to avoid 0s
log_table$modfrequency = log_table$modfrequency + 1
exp_table$obsfrequency = exp_table$obsfrequency + 1

# chi-square tests
# cs = sum ((obs - exp)^2 / exp)
logtable0 <- subset(log_table, migrate.rate == 0)
logtable0.005 <- subset(log_table, migrate.rate == 0.005)
logtable0.01 <- subset(log_table, migrate.rate == 0.01)
logtable0.015 <- subset(log_table, migrate.rate == 0.015)
logtable0.02 <- subset(log_table, migrate.rate == 0.02)
logtable0.03 <- subset(log_table, migrate.rate == 0.03)
logtable0.04 <- subset(log_table, migrate.rate == 0.04)
logtable0.07 <- subset(log_table, migrate.rate == 0.07)
logtable0.1 <- subset(log_table, migrate.rate == 0.1)


anti_join(logtable0,exp_table, by = "anemoneunique")
# all same

cs0 <- sum(((logtable0$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.005 <- sum(((logtable0.005$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)


cs0.01 <- sum(((logtable0.01$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.015<- sum(((logtable0.015$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.02 <- sum(((logtable0.02$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.03 <- sum(((logtable0.03$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.04 <- sum(((logtable0.04$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.07 <- sum(((logtable0.07$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.1 <- sum(((logtable0.1$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)


cs_log_5to10 <- c(cs0,cs0.005,cs0.01,cs0.015,cs0.02,cs0.03,cs0.04,cs0.07,cs0.1)
cs_log_5to10

```


#xover10
```{r}
clusts_26B_modelmerge %>% subset(cluster_type == "Xover10") %>%
group_by(anemoneunique) %>%
  dplyr::summarize(obsfrequency = sum(frequency)) -> exp_table

mm_log_migrate_one.subset3day %>% subset(cluster_type == "Xover10") %>%
group_by(anemoneunique, migrate.rate) %>%
  dplyr::summarize(modfrequency = sum(frequency)) -> log_table

log_table <- subset(log_table, anemoneunique != "26B.2.16")
log_table <- subset(log_table, anemoneunique != "26B.2.21")
log_table <- subset(log_table, anemoneunique != "26B.3.11")
log_table <- subset(log_table, anemoneunique != "26B.9.31")

# shifted data points by 1 to avoid 0s
log_table$modfrequency = log_table$modfrequency + 1
exp_table$obsfrequency = exp_table$obsfrequency + 1

# chi-square tests
# cs = sum ((obs - exp)^2 / exp)
logtable0 <- subset(log_table, migrate.rate == 0)
logtable0.005 <- subset(log_table, migrate.rate == 0.005)
logtable0.01 <- subset(log_table, migrate.rate == 0.01)
logtable0.015 <- subset(log_table, migrate.rate == 0.015)
logtable0.02 <- subset(log_table, migrate.rate == 0.02)
logtable0.03 <- subset(log_table, migrate.rate == 0.03)
logtable0.04 <- subset(log_table, migrate.rate == 0.04)
logtable0.07 <- subset(log_table, migrate.rate == 0.07)
logtable0.1 <- subset(log_table, migrate.rate == 0.1)


anti_join(logtable0,exp_table, by = "anemoneunique")
# all same

cs0 <- sum(((logtable0$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.005 <- sum(((logtable0.005$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)


cs0.01 <- sum(((logtable0.01$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.015<- sum(((logtable0.015$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.02 <- sum(((logtable0.02$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.03 <- sum(((logtable0.03$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.04 <- sum(((logtable0.04$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.07 <- sum(((logtable0.07$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.1 <- sum(((logtable0.1$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)


cs_log_over10 <- c(cs0,cs0.005,cs0.01,cs0.015,cs0.02,cs0.03,cs0.04,cs0.07,cs0.1)
cs_log_over10

```
#full chisq dataframe
```{r}
df.chsq.fourrt <- rbind(cs_log_tot,cs_log_one,cs_log_two,cs_log_threefour,cs_log_5to10,cs_log_over10)
colnames(df.chsq.fourrt) <- c("0","0.005","0.015","0.01","0.02","0.03","0.04","0.07","0.1")
df.chsq.fourrt
write.csv(df.chsq.fourrt, "df.chsq.fourrt.csv")

```

















# eightrt Data for Figure B

# Start here
```{r}
setwd("./summarycsv/migration_models/eightrt/mr0.1/")
migrationmodels.list = list.files(pattern = ".csv")
migrationmodels.read = lapply(migrationmodels.list, read.csv, header=T, stringsAsFactors = F)
migrationmodel.log.0.1 <- rbindlist(migrationmodels.read, fill = T)

setwd("../mr0.015/")
migrationmodels.list = list.files(pattern = ".csv")
migrationmodels.read = lapply(migrationmodels.list, read.csv, header=T, stringsAsFactors = F)
migrationmodel.log.0.015 <- rbindlist(migrationmodels.read, fill = T)

setwd("../mr0.01/")
migrationmodels.list = list.files(pattern = ".csv")
migrationmodels.read = lapply(migrationmodels.list, read.csv, header=T, stringsAsFactors = F)
migrationmodel.log.0.01 <- rbindlist(migrationmodels.read, fill = T)

setwd("../mr0.005/")
migrationmodels.list = list.files(pattern = ".csv")
migrationmodels.read = lapply(migrationmodels.list, read.csv, header=T, stringsAsFactors = F)
migrationmodel.log.0.005 <- rbindlist(migrationmodels.read, fill = T)

setwd("../mr0.0/")
migrationmodels.list = list.files(pattern = ".csv")
migrationmodels.read = lapply(migrationmodels.list, read.csv, header=T, stringsAsFactors = F)
migrationmodel.log.0.0 <- rbindlist(migrationmodels.read, fill = T)

setwd("../mr0.02/")
migrationmodels.list = list.files(pattern = ".csv")
migrationmodels.read = lapply(migrationmodels.list, read.csv, header=T, stringsAsFactors = F)
migrationmodel.log.0.02 <- rbindlist(migrationmodels.read, fill = T)

setwd("../mr0.03/")
migrationmodels.list = list.files(pattern = ".csv")
migrationmodels.read = lapply(migrationmodels.list, read.csv, header=T, stringsAsFactors = F)
migrationmodel.log.0.03 <- rbindlist(migrationmodels.read, fill = T)

setwd("../mr0.04/")
migrationmodels.list = list.files(pattern = ".csv")
migrationmodels.read = lapply(migrationmodels.list, read.csv, header=T, stringsAsFactors = F)
migrationmodel.log.0.04 <- rbindlist(migrationmodels.read, fill = T)

setwd("../mr0.07/")
migrationmodels.list = list.files(pattern = ".csv")
migrationmodels.read = lapply(migrationmodels.list, read.csv, header=T, stringsAsFactors = F)
migrationmodel.log.0.07 <- rbindlist(migrationmodels.read, fill = T)
```

```{r}
migrationmodel.log.0.0$migrate.rate <- 0
migrationmodel.log.0.005$migrate.rate <- 0.005
migrationmodel.log.0.01$migrate.rate <- 0.01
migrationmodel.log.0.015$migrate.rate <- 0.015
migrationmodel.log.0.1$migrate.rate <- 0.1
migrationmodel.log.0.02$migrate.rate <- 0.02
migrationmodel.log.0.03$migrate.rate <- 0.03
migrationmodel.log.0.04$migrate.rate <- 0.04
migrationmodel.log.0.07$migrate.rate <- 0.07



migrationmodelcombine.log <- bind_rows(migrationmodel.log.0.0, migrationmodel.log.0.005, migrationmodel.log.0.01, migrationmodel.log.0.02,
migrationmodel.log.0.03,
migrationmodel.log.0.04,
migrationmodel.log.0.015,
migrationmodel.log.0.1,
migrationmodel.log.0.07
)



# round cells

migrationmodelcombine.log$cellspercluster <- round(migrationmodelcombine.log$cells)
migrationmodelcombine.log <- subset(migrationmodelcombine.log, cellspercluster > 0)




# Create breaks to divide groups


breaks = seq(1,2000,1)
breaks_names = seq(1,1999,1)



# Create frequency table


migrationmodelcombine.log$migrate.rate <- as.factor(migrationmodelcombine.log$migrate.rate)

migrationmodelcombine2.log <- migrationmodelcombine.log %>%
group_by(sample.name, Subsample, end.day, migrate.rate) %>%
  dplyr::summarize(cellspercluster = cellspercluster, histgroup = cut(cellspercluster, right = F, breaks = breaks, labels = breaks_names), freq = 1)




# turn frequency table into histogram summary table


migrationmodel_sum.log <- migrationmodelcombine2.log %>%
  group_by(sample.name, Subsample, end.day, migrate.rate, histgroup) %>%
  dplyr::summarize(frequency = sum(freq))




arrange(migrationmodel_sum.log, histgroup)

# pivot to wide

migrationmodel_sum_wide.log <- migrationmodel_sum.log %>% 
    pivot_wider(names_from = histgroup, values_from = frequency, values_fill = 0, names_sort = T)


colnames(migrationmodel_sum_wide.log) <- paste("X", colnames(migrationmodel_sum_wide.log), sep = "")

migrationmodel_sum_wide.log <- dplyr::rename(migrationmodel_sum_wide.log, sample.name = Xsample.name)
migrationmodel_sum_wide.log <- dplyr::rename(migrationmodel_sum_wide.log, Subsample = XSubsample)
migrationmodel_sum_wide.log <- dplyr::rename(migrationmodel_sum_wide.log, end.day = Xend.day)
migrationmodel_sum_wide.log <- dplyr::rename(migrationmodel_sum_wide.log, migrate.rate = Xmigrate.rate)

migmodel.ncol <- length(migrationmodel_sum_wide.log)


# create same groups as before
migrationmodel_sum_wide.log$Xone <- migrationmodel_sum_wide.log$X1

migrationmodel_sum_wide.log$Xtwo <- migrationmodel_sum_wide.log$X2

migrationmodel_sum_wide.log$Xthreefour <- migrationmodel_sum_wide.log$X3 + migrationmodel_sum_wide.log$X4
  

migrationmodel_sum_wide.log <- migrationmodel_sum_wide.log %>% ungroup %>%
  
  mutate(X3to4 = dplyr::select(., X3:X4) %>% rowSums(na.rm = TRUE))
migrationmodel_sum_wide.log <- migrationmodel_sum_wide.log %>%
    mutate(X5to10 = dplyr::select(., X5:X10) %>% rowSums(na.rm = TRUE))

migrationmodel_sum_wide.log <- migrationmodel_sum_wide.log %>%
    mutate(X15to50 = dplyr::select(., X15:X50) %>% rowSums(na.rm = TRUE))

migrationmodel_sum_wide.log <- migrationmodel_sum_wide.log %>%
    mutate(Xover50 = dplyr::select(., X51:all_of(migmodel.ncol)) %>% rowSums(na.rm = TRUE))

migrationmodel_sum_wide.log <- migrationmodel_sum_wide.log %>%
    mutate(Xover10 = dplyr::select(., X11:all_of(migmodel.ncol)) %>% rowSums(na.rm = TRUE))

migrationmodel_sum_wide.log <- migrationmodel_sum_wide.log %>%
    mutate(hist_count = dplyr::select(., X1:all_of(migmodel.ncol)) %>% rowSums(na.rm = TRUE))




# hist sums


migrationmodel_sum_wide.log %>% 
dplyr::select(., X1:all_of(migmodel.ncol)) -> histnamesubset

histnames <- as.numeric(unlist(str_extract_all(names(histnamesubset), '[0-9]+')))

histsumsubset <- data.frame(mapply(`*`,histnamesubset,histnames))

colnames(histsumsubset) <- paste(colnames(histsumsubset),"hist",sep="_")
histsumsubset$hist_sum <- rowSums(histsumsubset)




migrationmodel_sum_wide.log$hist_sum <- histsumsubset$hist_sum





# convert short to long df


migrationmodel_log_pop_long <- reshape2::melt(migrationmodel_sum_wide.log,
        # ID variables - all the variables to keep but not split apart on
    id.vars=c(1:4),
        # The source columns
        # Name of the destination column that will identify the original
        # column that the measurement came from
    variable.name="cluster_type",
    value.name="frequency"
)




mm_log_migrate_one <- subset(migrationmodel_log_pop_long, (cluster_type %in% c("Xone","Xtwo","Xthreefour","X5to10","Xover10")))

mm_log_migrate_one$day <- mm_log_migrate_one$day_post_inoc



# subsets


mm_log_migrate_one.subset3day <- mm_log_migrate_one[mm_log_migrate_one$end.day %in% c(4,7,9,11,14,16,18,21,25,29,31),]

mm_log_migrate_one.subset3day$anemone <- str_sub(mm_log_migrate_one.subset3day$sample.name,1,nchar(mm_log_migrate_one.subset3day$sample.name)-2)

mm_log_migrate_one.subset3day$anemoneunique <- str_c(mm_log_migrate_one.subset3day$anemone, sep = ".", mm_log_migrate_one.subset3day$end.day)


mm_log_migrate_one.subset3day$unique <- str_c(mm_log_migrate_one.subset3day$anemoneunique, sep = ".", mm_log_migrate_one.subset3day$Subsample)
```

```{r}
clusts_26B_modelmerge %>%
group_by(anemoneunique) %>%
  dplyr::summarize(obsfrequency = sum(frequency)) -> exp_table


mm_log_migrate_one.subset3day %>%
group_by(anemoneunique, migrate.rate) %>%
  dplyr::summarize(modfrequency = sum(frequency)) -> log_table

log_table <- subset(log_table, anemoneunique != "26B.2.16")
log_table <- subset(log_table, anemoneunique != "26B.2.21")
log_table <- subset(log_table, anemoneunique != "26B.3.11")
log_table <- subset(log_table, anemoneunique != "26B.9.31")


# chi-square tests
# cs = sum ((obs - exp)^2 / exp)
logtable0 <- subset(log_table, migrate.rate == 0)
logtable0.005 <- subset(log_table, migrate.rate == 0.005)
logtable0.01 <- subset(log_table, migrate.rate == 0.01)
logtable0.015 <- subset(log_table, migrate.rate == 0.015)
logtable0.02 <- subset(log_table, migrate.rate == 0.02)
logtable0.03 <- subset(log_table, migrate.rate == 0.03)
logtable0.04 <- subset(log_table, migrate.rate == 0.04)
logtable0.07 <- subset(log_table, migrate.rate == 0.07)
logtable0.1 <- subset(log_table, migrate.rate == 0.1)


anti_join(logtable0,exp_table, by = "anemoneunique")
# all same
```

```{r}
cs0 <- sum(((logtable0$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.005 <- sum(((logtable0.005$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.01 <- sum(((logtable0.01$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.015<- sum(((logtable0.015$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.02 <- sum(((logtable0.02$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.03 <- sum(((logtable0.03$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.04 <- sum(((logtable0.04$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.07 <- sum(((logtable0.07$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.1 <- sum(((logtable0.1$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)


cs_log_tot <- c(cs0,cs0.005,cs0.01,cs0.015,cs0.02,cs0.03,cs0.04,cs0.07,cs0.1)
cs_log_tot

```


#xone
```{r}
clusts_26B_modelmerge %>% subset(cluster_type == "Xone") %>%
group_by(anemoneunique) %>%
  dplyr::summarize(obsfrequency = sum(frequency)) -> exp_table

mm_log_migrate_one.subset3day %>% subset(cluster_type == "Xone") %>%
group_by(anemoneunique, migrate.rate) %>%
  dplyr::summarize(modfrequency = sum(frequency)) -> log_table

log_table <- subset(log_table, anemoneunique != "26B.2.16")
log_table <- subset(log_table, anemoneunique != "26B.2.21")
log_table <- subset(log_table, anemoneunique != "26B.3.11")
log_table <- subset(log_table, anemoneunique != "26B.9.31")

# shifted data points by 1 to avoid 0s
log_table$modfrequency = log_table$modfrequency + 1
exp_table$obsfrequency = exp_table$obsfrequency + 1

# chi-square tests
# cs = sum ((obs - exp)^2 / exp)
logtable0 <- subset(log_table, migrate.rate == 0)
logtable0.005 <- subset(log_table, migrate.rate == 0.005)
logtable0.01 <- subset(log_table, migrate.rate == 0.01)
logtable0.015 <- subset(log_table, migrate.rate == 0.015)
logtable0.02 <- subset(log_table, migrate.rate == 0.02)
logtable0.03 <- subset(log_table, migrate.rate == 0.03)
logtable0.04 <- subset(log_table, migrate.rate == 0.04)
logtable0.07 <- subset(log_table, migrate.rate == 0.07)
logtable0.1 <- subset(log_table, migrate.rate == 0.1)


anti_join(logtable0,exp_table, by = "anemoneunique")
# all same

cs0 <- sum(((logtable0$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.005 <- sum(((logtable0.005$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)


cs0.01 <- sum(((logtable0.01$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.015<- sum(((logtable0.015$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.02 <- sum(((logtable0.02$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.03 <- sum(((logtable0.03$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.04 <- sum(((logtable0.04$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.07 <- sum(((logtable0.07$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.1 <- sum(((logtable0.1$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)


cs_log_one <- c(cs0,cs0.005,cs0.01,cs0.015,cs0.02,cs0.03,cs0.04,cs0.07,cs0.1)
cs_log_one

```


#xtwo
```{r}
clusts_26B_modelmerge %>% subset(cluster_type == "Xtwo") %>%
group_by(anemoneunique) %>%
  dplyr::summarize(obsfrequency = sum(frequency)) -> exp_table

mm_log_migrate_one.subset3day %>% subset(cluster_type == "Xtwo") %>%
group_by(anemoneunique, migrate.rate) %>%
  dplyr::summarize(modfrequency = sum(frequency)) -> log_table

log_table <- subset(log_table, anemoneunique != "26B.2.16")
log_table <- subset(log_table, anemoneunique != "26B.2.21")
log_table <- subset(log_table, anemoneunique != "26B.3.11")
log_table <- subset(log_table, anemoneunique != "26B.9.31")

# shifted data points by 1 to avoid 0s
log_table$modfrequency = log_table$modfrequency + 1
exp_table$obsfrequency = exp_table$obsfrequency + 1

# chi-square tests
# cs = sum ((obs - exp)^2 / exp)
logtable0 <- subset(log_table, migrate.rate == 0)
logtable0.005 <- subset(log_table, migrate.rate == 0.005)
logtable0.01 <- subset(log_table, migrate.rate == 0.01)
logtable0.015 <- subset(log_table, migrate.rate == 0.015)
logtable0.02 <- subset(log_table, migrate.rate == 0.02)
logtable0.03 <- subset(log_table, migrate.rate == 0.03)
logtable0.04 <- subset(log_table, migrate.rate == 0.04)
logtable0.07 <- subset(log_table, migrate.rate == 0.07)
logtable0.1 <- subset(log_table, migrate.rate == 0.1)


anti_join(logtable0,exp_table, by = "anemoneunique")
# all same

cs0 <- sum(((logtable0$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.005 <- sum(((logtable0.005$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)


cs0.01 <- sum(((logtable0.01$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.015<- sum(((logtable0.015$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.02 <- sum(((logtable0.02$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.03 <- sum(((logtable0.03$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.04 <- sum(((logtable0.04$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.07 <- sum(((logtable0.07$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.1 <- sum(((logtable0.1$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)


cs_log_two <- c(cs0,cs0.005,cs0.01,cs0.015,cs0.02,cs0.03,cs0.04,cs0.07,cs0.1)
cs_log_two

```


#xthreefour
```{r}
clusts_26B_modelmerge %>% subset(cluster_type == "Xthreefour") %>%
group_by(anemoneunique) %>%
  dplyr::summarize(obsfrequency = sum(frequency)) -> exp_table

mm_log_migrate_one.subset3day %>% subset(cluster_type == "Xthreefour") %>%
group_by(anemoneunique, migrate.rate) %>%
  dplyr::summarize(modfrequency = sum(frequency)) -> log_table

log_table <- subset(log_table, anemoneunique != "26B.2.16")
log_table <- subset(log_table, anemoneunique != "26B.2.21")
log_table <- subset(log_table, anemoneunique != "26B.3.11")
log_table <- subset(log_table, anemoneunique != "26B.9.31")

# shifted data points by 1 to avoid 0s
log_table$modfrequency = log_table$modfrequency + 1
exp_table$obsfrequency = exp_table$obsfrequency + 1

# chi-square tests
# cs = sum ((obs - exp)^2 / exp)
logtable0 <- subset(log_table, migrate.rate == 0)
logtable0.005 <- subset(log_table, migrate.rate == 0.005)
logtable0.01 <- subset(log_table, migrate.rate == 0.01)
logtable0.015 <- subset(log_table, migrate.rate == 0.015)
logtable0.02 <- subset(log_table, migrate.rate == 0.02)
logtable0.03 <- subset(log_table, migrate.rate == 0.03)
logtable0.04 <- subset(log_table, migrate.rate == 0.04)
logtable0.07 <- subset(log_table, migrate.rate == 0.07)
logtable0.1 <- subset(log_table, migrate.rate == 0.1)


anti_join(logtable0,exp_table, by = "anemoneunique")
# all same

cs0 <- sum(((logtable0$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.005 <- sum(((logtable0.005$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)


cs0.01 <- sum(((logtable0.01$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.015<- sum(((logtable0.015$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.02 <- sum(((logtable0.02$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.03 <- sum(((logtable0.03$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.04 <- sum(((logtable0.04$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.07 <- sum(((logtable0.07$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.1 <- sum(((logtable0.1$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)


cs_log_threefour <- c(cs0,cs0.005,cs0.01,cs0.015,cs0.02,cs0.03,cs0.04,cs0.07,cs0.1)
cs_log_threefour

```

#x5to10
```{r}
clusts_26B_modelmerge %>% subset(cluster_type == "X5to10") %>%
group_by(anemoneunique) %>%
  dplyr::summarize(obsfrequency = sum(frequency)) -> exp_table

mm_log_migrate_one.subset3day %>% subset(cluster_type == "X5to10") %>%
group_by(anemoneunique, migrate.rate) %>%
  dplyr::summarize(modfrequency = sum(frequency)) -> log_table

log_table <- subset(log_table, anemoneunique != "26B.2.16")
log_table <- subset(log_table, anemoneunique != "26B.2.21")
log_table <- subset(log_table, anemoneunique != "26B.3.11")
log_table <- subset(log_table, anemoneunique != "26B.9.31")

# shifted data points by 1 to avoid 0s
log_table$modfrequency = log_table$modfrequency + 1
exp_table$obsfrequency = exp_table$obsfrequency + 1

# chi-square tests
# cs = sum ((obs - exp)^2 / exp)
logtable0 <- subset(log_table, migrate.rate == 0)
logtable0.005 <- subset(log_table, migrate.rate == 0.005)
logtable0.01 <- subset(log_table, migrate.rate == 0.01)
logtable0.015 <- subset(log_table, migrate.rate == 0.015)
logtable0.02 <- subset(log_table, migrate.rate == 0.02)
logtable0.03 <- subset(log_table, migrate.rate == 0.03)
logtable0.04 <- subset(log_table, migrate.rate == 0.04)
logtable0.07 <- subset(log_table, migrate.rate == 0.07)
logtable0.1 <- subset(log_table, migrate.rate == 0.1)


anti_join(logtable0,exp_table, by = "anemoneunique")
# all same

cs0 <- sum(((logtable0$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.005 <- sum(((logtable0.005$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)


cs0.01 <- sum(((logtable0.01$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.015<- sum(((logtable0.015$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.02 <- sum(((logtable0.02$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.03 <- sum(((logtable0.03$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.04 <- sum(((logtable0.04$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.07 <- sum(((logtable0.07$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.1 <- sum(((logtable0.1$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)


cs_log_5to10 <- c(cs0,cs0.005,cs0.01,cs0.015,cs0.02,cs0.03,cs0.04,cs0.07,cs0.1)
cs_log_5to10

```


#xover10
```{r}
clusts_26B_modelmerge %>% subset(cluster_type == "Xover10") %>%
group_by(anemoneunique) %>%
  dplyr::summarize(obsfrequency = sum(frequency)) -> exp_table

mm_log_migrate_one.subset3day %>% subset(cluster_type == "Xover10") %>%
group_by(anemoneunique, migrate.rate) %>%
  dplyr::summarize(modfrequency = sum(frequency)) -> log_table

log_table <- subset(log_table, anemoneunique != "26B.2.16")
log_table <- subset(log_table, anemoneunique != "26B.2.21")
log_table <- subset(log_table, anemoneunique != "26B.3.11")
log_table <- subset(log_table, anemoneunique != "26B.9.31")

# shifted data points by 1 to avoid 0s
log_table$modfrequency = log_table$modfrequency + 1
exp_table$obsfrequency = exp_table$obsfrequency + 1

# chi-square tests
# cs = sum ((obs - exp)^2 / exp)
logtable0 <- subset(log_table, migrate.rate == 0)
logtable0.005 <- subset(log_table, migrate.rate == 0.005)
logtable0.01 <- subset(log_table, migrate.rate == 0.01)
logtable0.015 <- subset(log_table, migrate.rate == 0.015)
logtable0.02 <- subset(log_table, migrate.rate == 0.02)
logtable0.03 <- subset(log_table, migrate.rate == 0.03)
logtable0.04 <- subset(log_table, migrate.rate == 0.04)
logtable0.07 <- subset(log_table, migrate.rate == 0.07)
logtable0.1 <- subset(log_table, migrate.rate == 0.1)


anti_join(logtable0,exp_table, by = "anemoneunique")
# all same

cs0 <- sum(((logtable0$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.005 <- sum(((logtable0.005$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)


cs0.01 <- sum(((logtable0.01$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.015<- sum(((logtable0.015$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.02 <- sum(((logtable0.02$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.03 <- sum(((logtable0.03$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.04 <- sum(((logtable0.04$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.07 <- sum(((logtable0.07$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.1 <- sum(((logtable0.1$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)


cs_log_over10 <- c(cs0,cs0.005,cs0.01,cs0.015,cs0.02,cs0.03,cs0.04,cs0.07,cs0.1)
cs_log_over10

```
#full chisq dataframe
```{r}
df.chsq.eightrt <- rbind(cs_log_tot,cs_log_one,cs_log_two,cs_log_threefour,cs_log_5to10,cs_log_over10)
colnames(df.chsq.eightrt) <- c("0","0.005","0.01","0.015","0.02","0.03","0.04","0.07","0.1")
df.chsq.eightrt
write.csv(df.chsq.eightrt, "df.chsq.eightrt.csv")

```














# sixteen rt Data for Figure B

# Start here
```{r}
setwd("./summarycsv/migration_models/sixtrt/mr0.1/")
migrationmodels.list = list.files(pattern = ".csv")
migrationmodels.read = lapply(migrationmodels.list, read.csv, header=T, stringsAsFactors = F)
migrationmodel.log.0.1 <- rbindlist(migrationmodels.read, fill = T)

setwd("../mr0.015/")
migrationmodels.list = list.files(pattern = ".csv")
migrationmodels.read = lapply(migrationmodels.list, read.csv, header=T, stringsAsFactors = F)
migrationmodel.log.0.015 <- rbindlist(migrationmodels.read, fill = T)

setwd("../mr0.01/")
migrationmodels.list = list.files(pattern = ".csv")
migrationmodels.read = lapply(migrationmodels.list, read.csv, header=T, stringsAsFactors = F)
migrationmodel.log.0.01 <- rbindlist(migrationmodels.read, fill = T)

setwd("../mr0.005/")
migrationmodels.list = list.files(pattern = ".csv")
migrationmodels.read = lapply(migrationmodels.list, read.csv, header=T, stringsAsFactors = F)
migrationmodel.log.0.005 <- rbindlist(migrationmodels.read, fill = T)

setwd("../mr0.0/")
migrationmodels.list = list.files(pattern = ".csv")
migrationmodels.read = lapply(migrationmodels.list, read.csv, header=T, stringsAsFactors = F)
migrationmodel.log.0.0 <- rbindlist(migrationmodels.read, fill = T)

setwd("../mr0.02/")
migrationmodels.list = list.files(pattern = ".csv")
migrationmodels.read = lapply(migrationmodels.list, read.csv, header=T, stringsAsFactors = F)
migrationmodel.log.0.02 <- rbindlist(migrationmodels.read, fill = T)

setwd("../mr0.03/")
migrationmodels.list = list.files(pattern = ".csv")
migrationmodels.read = lapply(migrationmodels.list, read.csv, header=T, stringsAsFactors = F)
migrationmodel.log.0.03 <- rbindlist(migrationmodels.read, fill = T)

setwd("../mr0.04/")
migrationmodels.list = list.files(pattern = ".csv")
migrationmodels.read = lapply(migrationmodels.list, read.csv, header=T, stringsAsFactors = F)
migrationmodel.log.0.04 <- rbindlist(migrationmodels.read, fill = T)

setwd("../mr0.07/")
migrationmodels.list = list.files(pattern = ".csv")
migrationmodels.read = lapply(migrationmodels.list, read.csv, header=T, stringsAsFactors = F)
migrationmodel.log.0.07 <- rbindlist(migrationmodels.read, fill = T)
```

```{r}
migrationmodel.log.0.0$migrate.rate <- 0
migrationmodel.log.0.005$migrate.rate <- 0.005
migrationmodel.log.0.01$migrate.rate <- 0.01
migrationmodel.log.0.015$migrate.rate <- 0.015
migrationmodel.log.0.1$migrate.rate <- 0.1
migrationmodel.log.0.02$migrate.rate <- 0.02
migrationmodel.log.0.03$migrate.rate <- 0.03
migrationmodel.log.0.04$migrate.rate <- 0.04
migrationmodel.log.0.07$migrate.rate <- 0.07



migrationmodelcombine.log <- bind_rows(migrationmodel.log.0.0, migrationmodel.log.0.005, migrationmodel.log.0.01, migrationmodel.log.0.02,
migrationmodel.log.0.03,
migrationmodel.log.0.04,
migrationmodel.log.0.015,
migrationmodel.log.0.1,
migrationmodel.log.0.07
)



# round cells

migrationmodelcombine.log$cellspercluster <- round(migrationmodelcombine.log$cells)
migrationmodelcombine.log <- subset(migrationmodelcombine.log, cellspercluster > 0)




# Create breaks to divide groups


breaks = seq(1,2000,1)
breaks_names = seq(1,1999,1)



# Create frequency table


migrationmodelcombine.log$migrate.rate <- as.factor(migrationmodelcombine.log$migrate.rate)

migrationmodelcombine2.log <- migrationmodelcombine.log %>%
group_by(sample.name, Subsample, end.day, migrate.rate) %>%
  dplyr::summarize(cellspercluster = cellspercluster, histgroup = cut(cellspercluster, right = F, breaks = breaks, labels = breaks_names), freq = 1)




# turn frequency table into histogram summary table


migrationmodel_sum.log <- migrationmodelcombine2.log %>%
  group_by(sample.name, Subsample, end.day, migrate.rate, histgroup) %>%
  dplyr::summarize(frequency = sum(freq))




arrange(migrationmodel_sum.log, histgroup)

# pivot to wide

migrationmodel_sum_wide.log <- migrationmodel_sum.log %>% 
    pivot_wider(names_from = histgroup, values_from = frequency, values_fill = 0, names_sort = T)


colnames(migrationmodel_sum_wide.log) <- paste("X", colnames(migrationmodel_sum_wide.log), sep = "")

migrationmodel_sum_wide.log <- dplyr::rename(migrationmodel_sum_wide.log, sample.name = Xsample.name)
migrationmodel_sum_wide.log <- dplyr::rename(migrationmodel_sum_wide.log, Subsample = XSubsample)
migrationmodel_sum_wide.log <- dplyr::rename(migrationmodel_sum_wide.log, end.day = Xend.day)
migrationmodel_sum_wide.log <- dplyr::rename(migrationmodel_sum_wide.log, migrate.rate = Xmigrate.rate)

migmodel.ncol <- length(migrationmodel_sum_wide.log)


# create same groups as before
migrationmodel_sum_wide.log$Xone <- migrationmodel_sum_wide.log$X1

migrationmodel_sum_wide.log$Xtwo <- migrationmodel_sum_wide.log$X2

migrationmodel_sum_wide.log$Xthreefour <- migrationmodel_sum_wide.log$X3 + migrationmodel_sum_wide.log$X4
  

migrationmodel_sum_wide.log <- migrationmodel_sum_wide.log %>% ungroup %>%
  
  mutate(X3to4 = dplyr::select(., X3:X4) %>% rowSums(na.rm = TRUE))
migrationmodel_sum_wide.log <- migrationmodel_sum_wide.log %>%
    mutate(X5to10 = dplyr::select(., X5:X10) %>% rowSums(na.rm = TRUE))

migrationmodel_sum_wide.log <- migrationmodel_sum_wide.log %>%
    mutate(X15to50 = dplyr::select(., X15:X50) %>% rowSums(na.rm = TRUE))

migrationmodel_sum_wide.log <- migrationmodel_sum_wide.log %>%
    mutate(Xover50 = dplyr::select(., X51:all_of(migmodel.ncol)) %>% rowSums(na.rm = TRUE))

migrationmodel_sum_wide.log <- migrationmodel_sum_wide.log %>%
    mutate(Xover10 = dplyr::select(., X11:all_of(migmodel.ncol)) %>% rowSums(na.rm = TRUE))

migrationmodel_sum_wide.log <- migrationmodel_sum_wide.log %>%
    mutate(hist_count = dplyr::select(., X1:all_of(migmodel.ncol)) %>% rowSums(na.rm = TRUE))




# hist sums


migrationmodel_sum_wide.log %>% 
dplyr::select(., X1:all_of(migmodel.ncol)) -> histnamesubset

histnames <- as.numeric(unlist(str_extract_all(names(histnamesubset), '[0-9]+')))

histsumsubset <- data.frame(mapply(`*`,histnamesubset,histnames))

colnames(histsumsubset) <- paste(colnames(histsumsubset),"hist",sep="_")
histsumsubset$hist_sum <- rowSums(histsumsubset)




migrationmodel_sum_wide.log$hist_sum <- histsumsubset$hist_sum





# convert short to long df


migrationmodel_log_pop_long <- reshape2::melt(migrationmodel_sum_wide.log,
        # ID variables - all the variables to keep but not split apart on
    id.vars=c(1:4),
        # The source columns
        # Name of the destination column that will identify the original
        # column that the measurement came from
    variable.name="cluster_type",
    value.name="frequency"
)




mm_log_migrate_one <- subset(migrationmodel_log_pop_long, (cluster_type %in% c("Xone","Xtwo","Xthreefour","X5to10","Xover10")))

mm_log_migrate_one$day <- mm_log_migrate_one$day_post_inoc



# subsets


mm_log_migrate_one.subset3day <- mm_log_migrate_one[mm_log_migrate_one$end.day %in% c(4,7,9,11,14,16,18,21,25,29,31),]

mm_log_migrate_one.subset3day$anemone <- str_sub(mm_log_migrate_one.subset3day$sample.name,1,nchar(mm_log_migrate_one.subset3day$sample.name)-2)

mm_log_migrate_one.subset3day$anemoneunique <- str_c(mm_log_migrate_one.subset3day$anemone, sep = ".", mm_log_migrate_one.subset3day$end.day)


mm_log_migrate_one.subset3day$unique <- str_c(mm_log_migrate_one.subset3day$anemoneunique, sep = ".", mm_log_migrate_one.subset3day$Subsample)
```

```{r}
clusts_26B_modelmerge %>%
group_by(anemoneunique) %>%
  dplyr::summarize(obsfrequency = sum(frequency)) -> exp_table


mm_log_migrate_one.subset3day %>%
group_by(anemoneunique, migrate.rate) %>%
  dplyr::summarize(modfrequency = sum(frequency)) -> log_table

log_table <- subset(log_table, anemoneunique != "26B.2.16")
log_table <- subset(log_table, anemoneunique != "26B.2.21")
log_table <- subset(log_table, anemoneunique != "26B.3.11")
log_table <- subset(log_table, anemoneunique != "26B.9.31")


# chi-square tests
# cs = sum ((obs - exp)^2 / exp)
logtable0 <- subset(log_table, migrate.rate == 0)
logtable0.005 <- subset(log_table, migrate.rate == 0.005)
logtable0.01 <- subset(log_table, migrate.rate == 0.01)
logtable0.015 <- subset(log_table, migrate.rate == 0.015)
logtable0.02 <- subset(log_table, migrate.rate == 0.02)
logtable0.03 <- subset(log_table, migrate.rate == 0.03)
logtable0.04 <- subset(log_table, migrate.rate == 0.04)
logtable0.07 <- subset(log_table, migrate.rate == 0.07)
logtable0.1 <- subset(log_table, migrate.rate == 0.1)


anti_join(logtable0,exp_table, by = "anemoneunique")
# all same
```

```{r}
cs0 <- sum(((logtable0$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.005 <- sum(((logtable0.005$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.01 <- sum(((logtable0.01$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.015<- sum(((logtable0.015$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.02 <- sum(((logtable0.02$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.03 <- sum(((logtable0.03$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.04 <- sum(((logtable0.04$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.07 <- sum(((logtable0.07$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.1 <- sum(((logtable0.1$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)


cs_log_tot <- c(cs0,cs0.005,cs0.01,cs0.015,cs0.02,cs0.03,cs0.04,cs0.07,cs0.1)
cs_log_tot

```


#xone
```{r}
clusts_26B_modelmerge %>% subset(cluster_type == "Xone") %>%
group_by(anemoneunique) %>%
  dplyr::summarize(obsfrequency = sum(frequency)) -> exp_table

mm_log_migrate_one.subset3day %>% subset(cluster_type == "Xone") %>%
group_by(anemoneunique, migrate.rate) %>%
  dplyr::summarize(modfrequency = sum(frequency)) -> log_table

log_table <- subset(log_table, anemoneunique != "26B.2.16")
log_table <- subset(log_table, anemoneunique != "26B.2.21")
log_table <- subset(log_table, anemoneunique != "26B.3.11")
log_table <- subset(log_table, anemoneunique != "26B.9.31")

# shifted data points by 1 to avoid 0s
log_table$modfrequency = log_table$modfrequency + 1
exp_table$obsfrequency = exp_table$obsfrequency + 1

# chi-square tests
# cs = sum ((obs - exp)^2 / exp)
logtable0 <- subset(log_table, migrate.rate == 0)
logtable0.005 <- subset(log_table, migrate.rate == 0.005)
logtable0.01 <- subset(log_table, migrate.rate == 0.01)
logtable0.015 <- subset(log_table, migrate.rate == 0.015)
logtable0.02 <- subset(log_table, migrate.rate == 0.02)
logtable0.03 <- subset(log_table, migrate.rate == 0.03)
logtable0.04 <- subset(log_table, migrate.rate == 0.04)
logtable0.07 <- subset(log_table, migrate.rate == 0.07)
logtable0.1 <- subset(log_table, migrate.rate == 0.1)


anti_join(logtable0,exp_table, by = "anemoneunique")
# all same

cs0 <- sum(((logtable0$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.005 <- sum(((logtable0.005$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)


cs0.01 <- sum(((logtable0.01$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.015<- sum(((logtable0.015$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.02 <- sum(((logtable0.02$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.03 <- sum(((logtable0.03$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.04 <- sum(((logtable0.04$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.07 <- sum(((logtable0.07$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.1 <- sum(((logtable0.1$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)


cs_log_one <- c(cs0,cs0.005,cs0.01,cs0.015,cs0.02,cs0.03,cs0.04,cs0.07,cs0.1)
cs_log_one

```


#xtwo
```{r}
clusts_26B_modelmerge %>% subset(cluster_type == "Xtwo") %>%
group_by(anemoneunique) %>%
  dplyr::summarize(obsfrequency = sum(frequency)) -> exp_table

mm_log_migrate_one.subset3day %>% subset(cluster_type == "Xtwo") %>%
group_by(anemoneunique, migrate.rate) %>%
  dplyr::summarize(modfrequency = sum(frequency)) -> log_table

log_table <- subset(log_table, anemoneunique != "26B.2.16")
log_table <- subset(log_table, anemoneunique != "26B.2.21")
log_table <- subset(log_table, anemoneunique != "26B.3.11")
log_table <- subset(log_table, anemoneunique != "26B.9.31")

# shifted data points by 1 to avoid 0s
log_table$modfrequency = log_table$modfrequency + 1
exp_table$obsfrequency = exp_table$obsfrequency + 1

# chi-square tests
# cs = sum ((obs - exp)^2 / exp)
logtable0 <- subset(log_table, migrate.rate == 0)
logtable0.005 <- subset(log_table, migrate.rate == 0.005)
logtable0.01 <- subset(log_table, migrate.rate == 0.01)
logtable0.015 <- subset(log_table, migrate.rate == 0.015)
logtable0.02 <- subset(log_table, migrate.rate == 0.02)
logtable0.03 <- subset(log_table, migrate.rate == 0.03)
logtable0.04 <- subset(log_table, migrate.rate == 0.04)
logtable0.07 <- subset(log_table, migrate.rate == 0.07)
logtable0.1 <- subset(log_table, migrate.rate == 0.1)


anti_join(logtable0,exp_table, by = "anemoneunique")
# all same

cs0 <- sum(((logtable0$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.005 <- sum(((logtable0.005$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)


cs0.01 <- sum(((logtable0.01$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.015<- sum(((logtable0.015$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.02 <- sum(((logtable0.02$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.03 <- sum(((logtable0.03$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.04 <- sum(((logtable0.04$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.07 <- sum(((logtable0.07$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.1 <- sum(((logtable0.1$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)


cs_log_two <- c(cs0,cs0.005,cs0.01,cs0.015,cs0.02,cs0.03,cs0.04,cs0.07,cs0.1)
cs_log_two

```


#xthreefour
```{r}
clusts_26B_modelmerge %>% subset(cluster_type == "Xthreefour") %>%
group_by(anemoneunique) %>%
  dplyr::summarize(obsfrequency = sum(frequency)) -> exp_table

mm_log_migrate_one.subset3day %>% subset(cluster_type == "Xthreefour") %>%
group_by(anemoneunique, migrate.rate) %>%
  dplyr::summarize(modfrequency = sum(frequency)) -> log_table

log_table <- subset(log_table, anemoneunique != "26B.2.16")
log_table <- subset(log_table, anemoneunique != "26B.2.21")
log_table <- subset(log_table, anemoneunique != "26B.3.11")
log_table <- subset(log_table, anemoneunique != "26B.9.31")

# shifted data points by 1 to avoid 0s
log_table$modfrequency = log_table$modfrequency + 1
exp_table$obsfrequency = exp_table$obsfrequency + 1

# chi-square tests
# cs = sum ((obs - exp)^2 / exp)
logtable0 <- subset(log_table, migrate.rate == 0)
logtable0.005 <- subset(log_table, migrate.rate == 0.005)
logtable0.01 <- subset(log_table, migrate.rate == 0.01)
logtable0.015 <- subset(log_table, migrate.rate == 0.015)
logtable0.02 <- subset(log_table, migrate.rate == 0.02)
logtable0.03 <- subset(log_table, migrate.rate == 0.03)
logtable0.04 <- subset(log_table, migrate.rate == 0.04)
logtable0.07 <- subset(log_table, migrate.rate == 0.07)
logtable0.1 <- subset(log_table, migrate.rate == 0.1)


anti_join(logtable0,exp_table, by = "anemoneunique")
# all same

cs0 <- sum(((logtable0$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.005 <- sum(((logtable0.005$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)


cs0.01 <- sum(((logtable0.01$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.015<- sum(((logtable0.015$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.02 <- sum(((logtable0.02$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.03 <- sum(((logtable0.03$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.04 <- sum(((logtable0.04$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.07 <- sum(((logtable0.07$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.1 <- sum(((logtable0.1$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)


cs_log_threefour <- c(cs0,cs0.005,cs0.01,cs0.015,cs0.02,cs0.03,cs0.04,cs0.07,cs0.1)
cs_log_threefour

```

#x5to10
```{r}
clusts_26B_modelmerge %>% subset(cluster_type == "X5to10") %>%
group_by(anemoneunique) %>%
  dplyr::summarize(obsfrequency = sum(frequency)) -> exp_table

mm_log_migrate_one.subset3day %>% subset(cluster_type == "X5to10") %>%
group_by(anemoneunique, migrate.rate) %>%
  dplyr::summarize(modfrequency = sum(frequency)) -> log_table

log_table <- subset(log_table, anemoneunique != "26B.2.16")
log_table <- subset(log_table, anemoneunique != "26B.2.21")
log_table <- subset(log_table, anemoneunique != "26B.3.11")
log_table <- subset(log_table, anemoneunique != "26B.9.31")

# shifted data points by 1 to avoid 0s
log_table$modfrequency = log_table$modfrequency + 1
exp_table$obsfrequency = exp_table$obsfrequency + 1

# chi-square tests
# cs = sum ((obs - exp)^2 / exp)
logtable0 <- subset(log_table, migrate.rate == 0)
logtable0.005 <- subset(log_table, migrate.rate == 0.005)
logtable0.01 <- subset(log_table, migrate.rate == 0.01)
logtable0.015 <- subset(log_table, migrate.rate == 0.015)
logtable0.02 <- subset(log_table, migrate.rate == 0.02)
logtable0.03 <- subset(log_table, migrate.rate == 0.03)
logtable0.04 <- subset(log_table, migrate.rate == 0.04)
logtable0.07 <- subset(log_table, migrate.rate == 0.07)
logtable0.1 <- subset(log_table, migrate.rate == 0.1)


anti_join(logtable0,exp_table, by = "anemoneunique")
# all same

cs0 <- sum(((logtable0$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.005 <- sum(((logtable0.005$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)


cs0.01 <- sum(((logtable0.01$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.015<- sum(((logtable0.015$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.02 <- sum(((logtable0.02$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.03 <- sum(((logtable0.03$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.04 <- sum(((logtable0.04$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.07 <- sum(((logtable0.07$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.1 <- sum(((logtable0.1$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)


cs_log_5to10 <- c(cs0,cs0.005,cs0.01,cs0.015,cs0.02,cs0.03,cs0.04,cs0.07,cs0.1)
cs_log_5to10

```


#xover10
```{r}
clusts_26B_modelmerge %>% subset(cluster_type == "Xover10") %>%
group_by(anemoneunique) %>%
  dplyr::summarize(obsfrequency = sum(frequency)) -> exp_table

mm_log_migrate_one.subset3day %>% subset(cluster_type == "Xover10") %>%
group_by(anemoneunique, migrate.rate) %>%
  dplyr::summarize(modfrequency = sum(frequency)) -> log_table

log_table <- subset(log_table, anemoneunique != "26B.2.16")
log_table <- subset(log_table, anemoneunique != "26B.2.21")
log_table <- subset(log_table, anemoneunique != "26B.3.11")
log_table <- subset(log_table, anemoneunique != "26B.9.31")

# shifted data points by 1 to avoid 0s
log_table$modfrequency = log_table$modfrequency + 1
exp_table$obsfrequency = exp_table$obsfrequency + 1

# chi-square tests
# cs = sum ((obs - exp)^2 / exp)
logtable0 <- subset(log_table, migrate.rate == 0)
logtable0.005 <- subset(log_table, migrate.rate == 0.005)
logtable0.01 <- subset(log_table, migrate.rate == 0.01)
logtable0.015 <- subset(log_table, migrate.rate == 0.015)
logtable0.02 <- subset(log_table, migrate.rate == 0.02)
logtable0.03 <- subset(log_table, migrate.rate == 0.03)
logtable0.04 <- subset(log_table, migrate.rate == 0.04)
logtable0.07 <- subset(log_table, migrate.rate == 0.07)
logtable0.1 <- subset(log_table, migrate.rate == 0.1)


anti_join(logtable0,exp_table, by = "anemoneunique")
# all same

cs0 <- sum(((logtable0$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.005 <- sum(((logtable0.005$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)


cs0.01 <- sum(((logtable0.01$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.015<- sum(((logtable0.015$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.02 <- sum(((logtable0.02$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.03 <- sum(((logtable0.03$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.04 <- sum(((logtable0.04$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.07 <- sum(((logtable0.07$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.1 <- sum(((logtable0.1$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)


cs_log_over10 <- c(cs0,cs0.005,cs0.01,cs0.015,cs0.02,cs0.03,cs0.04,cs0.07,cs0.1)
cs_log_over10

```
#full chisq dataframe
```{r}
df.chsq.sixtrt <- rbind(cs_log_tot,cs_log_one,cs_log_two,cs_log_threefour,cs_log_5to10,cs_log_over10)
colnames(df.chsq.sixtrt) <- c("0","0.005","0.01","0.015","0.02","0.03","0.04","0.07","0.1")
df.chsq.sixtrt
write.csv(df.chsq.sixtrt, "df.chsq.sixtrt.csv")

```










# log2 rt Data for Figure B

# Start here
```{r}
setwd("./summarycsv/migration_models/log2/mr0.1/")
migrationmodels.list = list.files(pattern = ".csv")
migrationmodels.read = lapply(migrationmodels.list, read.csv, header=T, stringsAsFactors = F)
migrationmodel.log.0.1 <- rbindlist(migrationmodels.read, fill = T)

setwd("../mr0.015/")
migrationmodels.list = list.files(pattern = ".csv")
migrationmodels.read = lapply(migrationmodels.list, read.csv, header=T, stringsAsFactors = F)
migrationmodel.log.0.015 <- rbindlist(migrationmodels.read, fill = T)

setwd("../mr0.01/")
migrationmodels.list = list.files(pattern = ".csv")
migrationmodels.read = lapply(migrationmodels.list, read.csv, header=T, stringsAsFactors = F)
migrationmodel.log.0.01 <- rbindlist(migrationmodels.read, fill = T)

setwd("../mr0.005/")
migrationmodels.list = list.files(pattern = ".csv")
migrationmodels.read = lapply(migrationmodels.list, read.csv, header=T, stringsAsFactors = F)
migrationmodel.log.0.005 <- rbindlist(migrationmodels.read, fill = T)

setwd("../mr0.0/")
migrationmodels.list = list.files(pattern = ".csv")
migrationmodels.read = lapply(migrationmodels.list, read.csv, header=T, stringsAsFactors = F)
migrationmodel.log.0.0 <- rbindlist(migrationmodels.read, fill = T)

setwd("../mr0.02/")
migrationmodels.list = list.files(pattern = ".csv")
migrationmodels.read = lapply(migrationmodels.list, read.csv, header=T, stringsAsFactors = F)
migrationmodel.log.0.02 <- rbindlist(migrationmodels.read, fill = T)

setwd("../mr0.03/")
migrationmodels.list = list.files(pattern = ".csv")
migrationmodels.read = lapply(migrationmodels.list, read.csv, header=T, stringsAsFactors = F)
migrationmodel.log.0.03 <- rbindlist(migrationmodels.read, fill = T)

setwd("../mr0.04/")
migrationmodels.list = list.files(pattern = ".csv")
migrationmodels.read = lapply(migrationmodels.list, read.csv, header=T, stringsAsFactors = F)
migrationmodel.log.0.04 <- rbindlist(migrationmodels.read, fill = T)

setwd("../mr0.07/")
migrationmodels.list = list.files(pattern = ".csv")
migrationmodels.read = lapply(migrationmodels.list, read.csv, header=T, stringsAsFactors = F)
migrationmodel.log.0.07 <- rbindlist(migrationmodels.read, fill = T)
```

```{r}
migrationmodel.log.0.0$migrate.rate <- 0
migrationmodel.log.0.005$migrate.rate <- 0.005
migrationmodel.log.0.01$migrate.rate <- 0.01
migrationmodel.log.0.015$migrate.rate <- 0.015
migrationmodel.log.0.1$migrate.rate <- 0.1
migrationmodel.log.0.02$migrate.rate <- 0.02
migrationmodel.log.0.03$migrate.rate <- 0.03
migrationmodel.log.0.04$migrate.rate <- 0.04
migrationmodel.log.0.07$migrate.rate <- 0.07



migrationmodelcombine.log <- bind_rows(migrationmodel.log.0.0, migrationmodel.log.0.005, migrationmodel.log.0.01, migrationmodel.log.0.02,
migrationmodel.log.0.03,
migrationmodel.log.0.04,
migrationmodel.log.0.015,
migrationmodel.log.0.1,
migrationmodel.log.0.07
)



# round cells

migrationmodelcombine.log$cellspercluster <- round(migrationmodelcombine.log$cells)
migrationmodelcombine.log <- subset(migrationmodelcombine.log, cellspercluster > 0)




# Create breaks to divide groups


breaks = seq(1,2000,1)
breaks_names = seq(1,1999,1)



# Create frequency table


migrationmodelcombine.log$migrate.rate <- as.factor(migrationmodelcombine.log$migrate.rate)

migrationmodelcombine2.log <- migrationmodelcombine.log %>%
group_by(sample.name, Subsample, end.day, migrate.rate) %>%
  dplyr::summarize(cellspercluster = cellspercluster, histgroup = cut(cellspercluster, right = F, breaks = breaks, labels = breaks_names), freq = 1)




# turn frequency table into histogram summary table


migrationmodel_sum.log <- migrationmodelcombine2.log %>%
  group_by(sample.name, Subsample, end.day, migrate.rate, histgroup) %>%
  dplyr::summarize(frequency = sum(freq))




arrange(migrationmodel_sum.log, histgroup)

# pivot to wide

migrationmodel_sum_wide.log <- migrationmodel_sum.log %>% 
    pivot_wider(names_from = histgroup, values_from = frequency, values_fill = 0, names_sort = T)


colnames(migrationmodel_sum_wide.log) <- paste("X", colnames(migrationmodel_sum_wide.log), sep = "")

migrationmodel_sum_wide.log <- dplyr::rename(migrationmodel_sum_wide.log, sample.name = Xsample.name)
migrationmodel_sum_wide.log <- dplyr::rename(migrationmodel_sum_wide.log, Subsample = XSubsample)
migrationmodel_sum_wide.log <- dplyr::rename(migrationmodel_sum_wide.log, end.day = Xend.day)
migrationmodel_sum_wide.log <- dplyr::rename(migrationmodel_sum_wide.log, migrate.rate = Xmigrate.rate)

migmodel.ncol <- length(migrationmodel_sum_wide.log)


# create same groups as before
migrationmodel_sum_wide.log$Xone <- migrationmodel_sum_wide.log$X1

migrationmodel_sum_wide.log$Xtwo <- migrationmodel_sum_wide.log$X2

migrationmodel_sum_wide.log$Xthreefour <- migrationmodel_sum_wide.log$X3 + migrationmodel_sum_wide.log$X4
  

migrationmodel_sum_wide.log <- migrationmodel_sum_wide.log %>% ungroup %>%
  
  mutate(X3to4 = dplyr::select(., X3:X4) %>% rowSums(na.rm = TRUE))
migrationmodel_sum_wide.log <- migrationmodel_sum_wide.log %>%
    mutate(X5to10 = dplyr::select(., X5:X10) %>% rowSums(na.rm = TRUE))

migrationmodel_sum_wide.log <- migrationmodel_sum_wide.log %>%
    mutate(X15to50 = dplyr::select(., X15:X50) %>% rowSums(na.rm = TRUE))

migrationmodel_sum_wide.log <- migrationmodel_sum_wide.log %>%
    mutate(Xover50 = dplyr::select(., X51:all_of(migmodel.ncol)) %>% rowSums(na.rm = TRUE))

migrationmodel_sum_wide.log <- migrationmodel_sum_wide.log %>%
    mutate(Xover10 = dplyr::select(., X11:all_of(migmodel.ncol)) %>% rowSums(na.rm = TRUE))

migrationmodel_sum_wide.log <- migrationmodel_sum_wide.log %>%
    mutate(hist_count = dplyr::select(., X1:all_of(migmodel.ncol)) %>% rowSums(na.rm = TRUE))




# hist sums


migrationmodel_sum_wide.log %>% 
dplyr::select(., X1:all_of(migmodel.ncol)) -> histnamesubset

histnames <- as.numeric(unlist(str_extract_all(names(histnamesubset), '[0-9]+')))

histsumsubset <- data.frame(mapply(`*`,histnamesubset,histnames))

colnames(histsumsubset) <- paste(colnames(histsumsubset),"hist",sep="_")
histsumsubset$hist_sum <- rowSums(histsumsubset)




migrationmodel_sum_wide.log$hist_sum <- histsumsubset$hist_sum





# convert short to long df


migrationmodel_log_pop_long <- reshape2::melt(migrationmodel_sum_wide.log,
        # ID variables - all the variables to keep but not split apart on
    id.vars=c(1:4),
        # The source columns
        # Name of the destination column that will identify the original
        # column that the measurement came from
    variable.name="cluster_type",
    value.name="frequency"
)




mm_log_migrate_one <- subset(migrationmodel_log_pop_long, (cluster_type %in% c("Xone","Xtwo","Xthreefour","X5to10","Xover10")))

mm_log_migrate_one$day <- mm_log_migrate_one$day_post_inoc



# subsets


mm_log_migrate_one.subset3day <- mm_log_migrate_one[mm_log_migrate_one$end.day %in% c(4,7,9,11,14,16,18,21,25,29,31),]

mm_log_migrate_one.subset3day$anemone <- str_sub(mm_log_migrate_one.subset3day$sample.name,1,nchar(mm_log_migrate_one.subset3day$sample.name)-2)

mm_log_migrate_one.subset3day$anemoneunique <- str_c(mm_log_migrate_one.subset3day$anemone, sep = ".", mm_log_migrate_one.subset3day$end.day)


mm_log_migrate_one.subset3day$unique <- str_c(mm_log_migrate_one.subset3day$anemoneunique, sep = ".", mm_log_migrate_one.subset3day$Subsample)
```

```{r}
clusts_26B_modelmerge %>%
group_by(anemoneunique) %>%
  dplyr::summarize(obsfrequency = sum(frequency)) -> exp_table


mm_log_migrate_one.subset3day %>%
group_by(anemoneunique, migrate.rate) %>%
  dplyr::summarize(modfrequency = sum(frequency)) -> log_table

log_table <- subset(log_table, anemoneunique != "26B.2.16")
log_table <- subset(log_table, anemoneunique != "26B.2.21")
log_table <- subset(log_table, anemoneunique != "26B.3.11")
log_table <- subset(log_table, anemoneunique != "26B.9.31")


# chi-square tests
# cs = sum ((obs - exp)^2 / exp)
logtable0 <- subset(log_table, migrate.rate == 0)
logtable0.005 <- subset(log_table, migrate.rate == 0.005)
logtable0.01 <- subset(log_table, migrate.rate == 0.01)
logtable0.015 <- subset(log_table, migrate.rate == 0.015)
logtable0.02 <- subset(log_table, migrate.rate == 0.02)
logtable0.03 <- subset(log_table, migrate.rate == 0.03)
logtable0.04 <- subset(log_table, migrate.rate == 0.04)
logtable0.07 <- subset(log_table, migrate.rate == 0.07)
logtable0.1 <- subset(log_table, migrate.rate == 0.1)


anti_join(logtable0,exp_table, by = "anemoneunique")
anti_join(exp_table,logtable0, by = "anemoneunique")

# all same
```

```{r}
cs0 <- sum(((logtable0$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.005 <- sum(((logtable0.005$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.01 <- sum(((logtable0.01$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.015<- sum(((logtable0.015$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.02 <- sum(((logtable0.02$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.03 <- sum(((logtable0.03$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.04 <- sum(((logtable0.04$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.07 <- sum(((logtable0.07$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.1 <- sum(((logtable0.1$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)


cs_log_tot <- c(cs0,cs0.005,cs0.01,cs0.015,cs0.02,cs0.03,cs0.04,cs0.07,cs0.1)
cs_log_tot

```


#xone
```{r}
clusts_26B_modelmerge %>% subset(cluster_type == "Xone") %>%
group_by(anemoneunique) %>%
  dplyr::summarize(obsfrequency = sum(frequency)) -> exp_table

mm_log_migrate_one.subset3day %>% subset(cluster_type == "Xone") %>%
group_by(anemoneunique, migrate.rate) %>%
  dplyr::summarize(modfrequency = sum(frequency)) -> log_table

log_table <- subset(log_table, anemoneunique != "26B.2.16")
log_table <- subset(log_table, anemoneunique != "26B.2.21")
log_table <- subset(log_table, anemoneunique != "26B.3.11")
log_table <- subset(log_table, anemoneunique != "26B.9.31")

# shifted data points by 1 to avoid 0s
log_table$modfrequency = log_table$modfrequency + 1
exp_table$obsfrequency = exp_table$obsfrequency + 1

# chi-square tests
# cs = sum ((obs - exp)^2 / exp)
logtable0 <- subset(log_table, migrate.rate == 0)
logtable0.005 <- subset(log_table, migrate.rate == 0.005)
logtable0.01 <- subset(log_table, migrate.rate == 0.01)
logtable0.015 <- subset(log_table, migrate.rate == 0.015)
logtable0.02 <- subset(log_table, migrate.rate == 0.02)
logtable0.03 <- subset(log_table, migrate.rate == 0.03)
logtable0.04 <- subset(log_table, migrate.rate == 0.04)
logtable0.07 <- subset(log_table, migrate.rate == 0.07)
logtable0.1 <- subset(log_table, migrate.rate == 0.1)


anti_join(logtable0,exp_table, by = "anemoneunique")
# all same

cs0 <- sum(((logtable0$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.005 <- sum(((logtable0.005$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)


cs0.01 <- sum(((logtable0.01$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.015<- sum(((logtable0.015$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.02 <- sum(((logtable0.02$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.03 <- sum(((logtable0.03$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.04 <- sum(((logtable0.04$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.07 <- sum(((logtable0.07$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.1 <- sum(((logtable0.1$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)


cs_log_one <- c(cs0,cs0.005,cs0.01,cs0.015,cs0.02,cs0.03,cs0.04,cs0.07,cs0.1)
cs_log_one

```


#xtwo
```{r}
clusts_26B_modelmerge %>% subset(cluster_type == "Xtwo") %>%
group_by(anemoneunique) %>%
  dplyr::summarize(obsfrequency = sum(frequency)) -> exp_table

mm_log_migrate_one.subset3day %>% subset(cluster_type == "Xtwo") %>%
group_by(anemoneunique, migrate.rate) %>%
  dplyr::summarize(modfrequency = sum(frequency)) -> log_table

log_table <- subset(log_table, anemoneunique != "26B.2.16")
log_table <- subset(log_table, anemoneunique != "26B.2.21")
log_table <- subset(log_table, anemoneunique != "26B.3.11")
log_table <- subset(log_table, anemoneunique != "26B.9.31")

# shifted data points by 1 to avoid 0s
log_table$modfrequency = log_table$modfrequency + 1
exp_table$obsfrequency = exp_table$obsfrequency + 1

# chi-square tests
# cs = sum ((obs - exp)^2 / exp)
logtable0 <- subset(log_table, migrate.rate == 0)
logtable0.005 <- subset(log_table, migrate.rate == 0.005)
logtable0.01 <- subset(log_table, migrate.rate == 0.01)
logtable0.015 <- subset(log_table, migrate.rate == 0.015)
logtable0.02 <- subset(log_table, migrate.rate == 0.02)
logtable0.03 <- subset(log_table, migrate.rate == 0.03)
logtable0.04 <- subset(log_table, migrate.rate == 0.04)
logtable0.07 <- subset(log_table, migrate.rate == 0.07)
logtable0.1 <- subset(log_table, migrate.rate == 0.1)


anti_join(logtable0,exp_table, by = "anemoneunique")
# all same

cs0 <- sum(((logtable0$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.005 <- sum(((logtable0.005$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)


cs0.01 <- sum(((logtable0.01$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.015<- sum(((logtable0.015$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.02 <- sum(((logtable0.02$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.03 <- sum(((logtable0.03$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.04 <- sum(((logtable0.04$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.07 <- sum(((logtable0.07$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.1 <- sum(((logtable0.1$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)


cs_log_two <- c(cs0,cs0.005,cs0.01,cs0.015,cs0.02,cs0.03,cs0.04,cs0.07,cs0.1)
cs_log_two

```


#xthreefour
```{r}
clusts_26B_modelmerge %>% subset(cluster_type == "Xthreefour") %>%
group_by(anemoneunique) %>%
  dplyr::summarize(obsfrequency = sum(frequency)) -> exp_table

mm_log_migrate_one.subset3day %>% subset(cluster_type == "Xthreefour") %>%
group_by(anemoneunique, migrate.rate) %>%
  dplyr::summarize(modfrequency = sum(frequency)) -> log_table

log_table <- subset(log_table, anemoneunique != "26B.2.16")
log_table <- subset(log_table, anemoneunique != "26B.2.21")
log_table <- subset(log_table, anemoneunique != "26B.3.11")
log_table <- subset(log_table, anemoneunique != "26B.9.31")

# shifted data points by 1 to avoid 0s
log_table$modfrequency = log_table$modfrequency + 1
exp_table$obsfrequency = exp_table$obsfrequency + 1

# chi-square tests
# cs = sum ((obs - exp)^2 / exp)
logtable0 <- subset(log_table, migrate.rate == 0)
logtable0.005 <- subset(log_table, migrate.rate == 0.005)
logtable0.01 <- subset(log_table, migrate.rate == 0.01)
logtable0.015 <- subset(log_table, migrate.rate == 0.015)
logtable0.02 <- subset(log_table, migrate.rate == 0.02)
logtable0.03 <- subset(log_table, migrate.rate == 0.03)
logtable0.04 <- subset(log_table, migrate.rate == 0.04)
logtable0.07 <- subset(log_table, migrate.rate == 0.07)
logtable0.1 <- subset(log_table, migrate.rate == 0.1)


anti_join(logtable0,exp_table, by = "anemoneunique")
# all same

cs0 <- sum(((logtable0$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.005 <- sum(((logtable0.005$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)


cs0.01 <- sum(((logtable0.01$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.015<- sum(((logtable0.015$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.02 <- sum(((logtable0.02$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.03 <- sum(((logtable0.03$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.04 <- sum(((logtable0.04$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.07 <- sum(((logtable0.07$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.1 <- sum(((logtable0.1$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)


cs_log_threefour <- c(cs0,cs0.005,cs0.01,cs0.015,cs0.02,cs0.03,cs0.04,cs0.07,cs0.1)
cs_log_threefour

```

#x5to10
```{r}
clusts_26B_modelmerge %>% subset(cluster_type == "X5to10") %>%
group_by(anemoneunique) %>%
  dplyr::summarize(obsfrequency = sum(frequency)) -> exp_table

mm_log_migrate_one.subset3day %>% subset(cluster_type == "X5to10") %>%
group_by(anemoneunique, migrate.rate) %>%
  dplyr::summarize(modfrequency = sum(frequency)) -> log_table

log_table <- subset(log_table, anemoneunique != "26B.2.16")
log_table <- subset(log_table, anemoneunique != "26B.2.21")
log_table <- subset(log_table, anemoneunique != "26B.3.11")
log_table <- subset(log_table, anemoneunique != "26B.9.31")

# shifted data points by 1 to avoid 0s
log_table$modfrequency = log_table$modfrequency + 1
exp_table$obsfrequency = exp_table$obsfrequency + 1

# chi-square tests
# cs = sum ((obs - exp)^2 / exp)
logtable0 <- subset(log_table, migrate.rate == 0)
logtable0.005 <- subset(log_table, migrate.rate == 0.005)
logtable0.01 <- subset(log_table, migrate.rate == 0.01)
logtable0.015 <- subset(log_table, migrate.rate == 0.015)
logtable0.02 <- subset(log_table, migrate.rate == 0.02)
logtable0.03 <- subset(log_table, migrate.rate == 0.03)
logtable0.04 <- subset(log_table, migrate.rate == 0.04)
logtable0.07 <- subset(log_table, migrate.rate == 0.07)
logtable0.1 <- subset(log_table, migrate.rate == 0.1)


anti_join(logtable0,exp_table, by = "anemoneunique")
# all same

cs0 <- sum(((logtable0$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.005 <- sum(((logtable0.005$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)


cs0.01 <- sum(((logtable0.01$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.015<- sum(((logtable0.015$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.02 <- sum(((logtable0.02$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.03 <- sum(((logtable0.03$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.04 <- sum(((logtable0.04$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.07 <- sum(((logtable0.07$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.1 <- sum(((logtable0.1$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)


cs_log_5to10 <- c(cs0,cs0.005,cs0.01,cs0.015,cs0.02,cs0.03,cs0.04,cs0.07,cs0.1)
cs_log_5to10

```


#xover10
```{r}
clusts_26B_modelmerge %>% subset(cluster_type == "Xover10") %>%
group_by(anemoneunique) %>%
  dplyr::summarize(obsfrequency = sum(frequency)) -> exp_table

mm_log_migrate_one.subset3day %>% subset(cluster_type == "Xover10") %>%
group_by(anemoneunique, migrate.rate) %>%
  dplyr::summarize(modfrequency = sum(frequency)) -> log_table

log_table <- subset(log_table, anemoneunique != "26B.2.16")
log_table <- subset(log_table, anemoneunique != "26B.2.21")
log_table <- subset(log_table, anemoneunique != "26B.3.11")
log_table <- subset(log_table, anemoneunique != "26B.9.31")

# shifted data points by 1 to avoid 0s
log_table$modfrequency = log_table$modfrequency + 1
exp_table$obsfrequency = exp_table$obsfrequency + 1

# chi-square tests
# cs = sum ((obs - exp)^2 / exp)
logtable0 <- subset(log_table, migrate.rate == 0)
logtable0.005 <- subset(log_table, migrate.rate == 0.005)
logtable0.01 <- subset(log_table, migrate.rate == 0.01)
logtable0.015 <- subset(log_table, migrate.rate == 0.015)
logtable0.02 <- subset(log_table, migrate.rate == 0.02)
logtable0.03 <- subset(log_table, migrate.rate == 0.03)
logtable0.04 <- subset(log_table, migrate.rate == 0.04)
logtable0.07 <- subset(log_table, migrate.rate == 0.07)
logtable0.1 <- subset(log_table, migrate.rate == 0.1)


anti_join(logtable0,exp_table, by = "anemoneunique")
# all same

cs0 <- sum(((logtable0$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.005 <- sum(((logtable0.005$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)


cs0.01 <- sum(((logtable0.01$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.015<- sum(((logtable0.015$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.02 <- sum(((logtable0.02$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.03 <- sum(((logtable0.03$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.04 <- sum(((logtable0.04$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.07 <- sum(((logtable0.07$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)

cs0.1 <- sum(((logtable0.1$modfrequency - exp_table$obsfrequency)^2)/exp_table$obsfrequency)


cs_log_over10 <- c(cs0,cs0.005,cs0.01,cs0.015,cs0.02,cs0.03,cs0.04,cs0.07,cs0.1)
cs_log_over10

```

#full chisq dataframe
```{r}
df.chsq.log2 <- rbind(cs_log_tot,cs_log_one,cs_log_two,cs_log_threefour,cs_log_5to10,cs_log_over10)
colnames(df.chsq.log2) <- c("0","0.005","0.01","0.015","0.02","0.03","0.04","0.07","0.1")
df.chsq.log2
write.csv(df.chsq.log2, "df.chsq.log2.csv")

```












```{r}
clusts_26B_modelmerge %>% 
group_by(anemoneunique, day) %>%
  dplyr::summarize(obsfrequency = sum(frequency)) -> exp_table

exp_table %>% 
group_by(day) %>%
  dplyr::summarize(medfrequency = median(obsfrequency),
                   meanfreq = mean(obsfrequency),
                   stdfreq = sd(obsfrequency)) -> exp_table_clusts

exp_table_clusts$medr <- c(tail(exp_table_clusts$medfrequency, 15),tail(exp_table_clusts$medfrequency, 1))


exp_table_clusts$meanr <- c(tail(exp_table_clusts$meanfreq, 15),tail(exp_table_clusts$meanfreq, 1))

exp_table_clusts$dayr <- c(tail(exp_table_clusts$day, 15),tail(exp_table_clusts$day, 1))

exp_table_clusts$mr_mean <- (exp_table_clusts$meanr - exp_table_clusts$meanfreq)/exp_table_clusts$meanr

exp_table_clusts$mr <- (exp_table_clusts$medr - exp_table_clusts$medfrequency)/exp_table_clusts$medr

exp_table_clusts$mrperday <- exp_table_clusts$mr/(exp_table_clusts$dayr - exp_table_clusts$day)

exp_table_clusts$mrmeanperday <- exp_table_clusts$mr_mean/(exp_table_clusts$dayr - exp_table_clusts$day)

exp_table_clusts <- exp_table_clusts[exp_table_clusts$day %in% c(4,7,9,11,14,16,18,21,25,29,31),]

mean(exp_table_clusts$mrperday)
```





```{r}
M <- as.table(rbind(obsexptest$modfrequency, obsexptest$obsfrequency))
dimnames(M) <- list(dataset = c("modeled", "expected"),
                    samplename = obsexptest$anemoneunique)

Xsq <- chisq.test(M)
Xsq
```

```{r}

obsexptest$chisquare <- ((obsexptest$modfrequency - obsexptest$obsfrequency)^2)/obsexptest$obsfrequency

sum(obsexptest$chisquare)


```


```{r}

mm_log_migrate_one.subset3.0 <- subset(mm_log_migrate_one.subset3day, migrate.rate == 0.0)
mm_log_migrate_one.subset3.005 <- subset(mm_log_migrate_one.subset3day, migrate.rate == 0.005)
mm_log_migrate_one.subset3.01 <- subset(mm_log_migrate_one.subset3day, migrate.rate == 0.01)
mm_log_migrate_one.subset3.02 <- subset(mm_log_migrate_one.subset3day, migrate.rate == 0.02)

mm_log_migrate_one.subset3.03 <- subset(mm_log_migrate_one.subset3day, migrate.rate == 0.03)
mm_log_migrate_one.subset3.04 <- subset(mm_log_migrate_one.subset3day, migrate.rate == 0.04)
mm_log_migrate_one.subset3.015 <- subset(mm_log_migrate_one.subset3day, migrate.rate == 0.015)
mm_log_migrate_one.subset3.07 <- subset(mm_log_migrate_one.subset3day, migrate.rate == 0.07)
mm_log_migrate_one.subset3.1 <- subset(mm_log_migrate_one.subset3day, migrate.rate == 0.1)
```



```{r}
mm_log_migrate_one.subset3.015$int <- interaction(mm_log_migrate_one.subset3.015$anemone, mm_log_migrate_one.subset3.015$day)
mm_log_migrate_one.subset3.015$int <- as.factor(mm_log_migrate_one.subset3.015$int)
  



```