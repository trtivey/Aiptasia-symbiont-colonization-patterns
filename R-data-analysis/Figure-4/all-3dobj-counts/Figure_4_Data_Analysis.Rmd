---
title: "Figure 4 Data Analysis"
author: "Trevor Tivey"
date: "1/14/2022"
output: html_document
---

# Setup
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(plyr)
library(dplyr)
library(data.table)
library(tidyr)
library(splitstackshape)
library(ggplot2)
library(Hmisc)
library(tidyverse)
library(rstatix)
library(ggpubr)
library(car)
library(multcomp)
```

# Setup
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(plyr)
library(dplyr)
library(data.table)
library(tidyr)
library(splitstackshape)
library(ggplot2)
library(Hmisc)
library(tidyverse)
library(rstatix)
library(ggpubr)
library(car)
library(multcomp)

table_glht <- function(x) {
  pq <- summary(x)$test
  mtests <- cbind(pq$coefficients, pq$sigma, pq$tstat, pq$pvalues)
  error <- attr(pq$pvalues, "error")
  pname <- switch(x$alternativ, less = paste("Pr(<", ifelse(x$df ==0, "z", "t"), ")", sep = ""), 
  greater = paste("Pr(>", ifelse(x$df == 0, "z", "t"), ")", sep = ""), two.sided = paste("Pr(>|",ifelse(x$df == 0, "z", "t"), "|)", sep = ""))
  colnames(mtests) <- c("Estimate", "Std. Error", ifelse(x$df ==0, "z value", "t value"), pname)
  return(mtests)}
```

# Set appropriate breakpoints for cell cluster size discrimination
```{r mfsingle, include=FALSE, results=}


breaks1 = c(0.001, 0.2001, 0.4001, 0.5001, 0.6001, 0.7001, 0.8001, 1.001, 1.251, 1.401, 1.801, 2.001, 2.201, 2.301, 2.401, 2.601, 2.801, 3.001, 3.301)
breaks2 = seq(3.501,1000.001,0.5)
breaks3 = seq(3.501,999.501,0.5)
breaks = c(breaks1,breaks2)
breaks_names = c(breaks1,breaks3)
```

# Create cluster lists
```{r mfsingle, include=FALSE, results=}

# Set directory
setwd("./all-3dobj-counts/")

# List txt file outputs generated by ImageJ2 3D Object Counter
clusterlist = list.files(pattern = ".txt")

# Loop through files to select sample name, object area, cut sizes according to breaks, and write output to new file.


## note, reading tab separated txt files as csv input.
## e.g. sample_file <-read.csv("Movie-11-Image Export-443merge.txt", header = T, sep = "\t")

for(i in 1:length(clusterlist)) {
  sample_file <- read.csv(clusterlist[i], header = T, sep = "\t")
  sample_name = clusterlist[i]
  if(nrow(sample_file) > 1) {
    sample_file$X.1 <- seq.int(nrow(sample_file))
    sample_file2 <- sample_file %>% dplyr::select(1, 3)
    sample_file2$clustersize <- sample_file2$Surface..pixel.2./100
    sample_file2$name <- sample_name
    
    print(sample_file2)
    
    clustersize.cut = cut(sample_file2$clustersize, breaks, right=FALSE)

    clustertable <- table(clustersize.cut)
    clusterdf <- data.frame(clustertable)

    
    clusterdft <- t(clusterdf)
    clust_size <- breaks_names
    colnames(clusterdft) <- clust_size
    
    sample_image <- c(sample_name,sample_name)
    
    sample_file_clust_hist <- cbind(sample_image,clusterdft)
    
    setwd("../output-3dobj-counts-with-zeros/")
    write.csv(sample_file2, clusterlist[i])
    setwd("../output-hists-with-zeros/")
    write.csv(sample_file_clust_hist, clusterlist[i])
    setwd("../all-3dobj-counts/")

  } 
  # If input file has no objects, placeholder file created.
  else {
    X.1 <- c(1)
    Surface..pixel.2. <- c(0)
    clustersize <- c(0)
    name <- c(sample_name)
    sample_file2 <- data.frame(X.1,Surface..pixel.2.,clustersize,name)
    
    print(sample_file2)
    
    clustersize.cut = cut(sample_file2$clustersize, breaks, right=FALSE)
    #print(clustersize.cut)
    clustertable <- table(clustersize.cut)
    clusterdf <- data.frame(clustertable)
    # print(clusterdf)
    
    clusterdft <- t(clusterdf)
    clust_size <- breaks_names
    colnames(clusterdft) <- clust_size
    
    sample_image <- c(sample_name,sample_name)
    
    sample_file_clust_hist <- cbind(sample_image,clusterdft)

    
    setwd("../output-3dobj-counts-with-zeros/")
    write.csv(sample_file2, clusterlist[i])
    setwd("../output-hists-with-zeros/")
    write.csv(sample_file_clust_hist, clusterlist[i])
    setwd("../all-3dobj-counts/")
    
  }
}

```

# Double-check break names is same as cluster tables
```{r}
length(breaks_names)
length(clustertable)
```

# Summarize into summary files with and without including zeros
```{r}

setwd("./output-3dobj-counts-with-zeros/")
objcount_w_zeros.list = list.files(pattern = ".txt")
ocount_w_zeros.1 = lapply(objcount_w_zeros.list, read.csv, header=T, stringsAsFactors = F)
ocount_w_zeros.2 <- rbindlist(ocount_w_zeros.1, fill = T)


setwd("../output-hists-with-zeros/")
hist_w_zeros.list = list.files(pattern = ".txt")
hist_w_zeros.1 = lapply(hist_w_zeros.list, read.csv, header=T, stringsAsFactors = F)
hist_w_zeros.2 <- rbindlist(hist_w_zeros.1, fill = T)
hist_w_zeros.3 <- subset(hist_w_zeros.2, X == "Freq")
colnames(hist_w_zeros.3) <- substring(colnames(hist_w_zeros.3), 2)
colnames(hist_w_zeros.3)[1] <- "category"
colnames(hist_w_zeros.3)[2] <- "sample_name"
```

# Write summary files
```{r}
numeric_column_id = 3:2014 # column ids to change to numeric
hist_w_zeros.4 <- mutate_each(hist_w_zeros.3, funs(as.numeric), numeric_column_id)
hist_w_zeros.4$greater_than_50 <- rowSums(hist_w_zeros.4[,116:1003])
hist_w_zeros.5 <- hist_w_zeros.4[,2:115]
hist_w_zeros.6 <- cbind(hist_w_zeros.5,hist_w_zeros.4$greater_than_50)

setwd("./summary csv/")

write.csv(hist_w_zeros.4, "hist-0-long.csv")
write.csv(hist_w_zeros.6, "hist-0-short.csv")
write.csv(ocount_w_zeros.2, "obj_count_combined_w0.csv")
```



## summarize obj_count_combined to get total cluster number, total cluster volume, total cluster size, by name
```{r}
setwd("./summary csv/")

### link both csvs

clusts_bleach <- read.csv("finalcluster2020.csv", header = T)
# grouping cluster groups
clusts_plus_bleach <- clusts_bleach


clusts_plus_bleach <- clusts_plus_bleach %>%
    mutate(Xone = dplyr::select(., X0.001:X0.4001) %>% rowSums(na.rm = TRUE))
clusts_plus_bleach <- clusts_plus_bleach %>%
    mutate(Xtwo = dplyr::select(., X0.5001:X1.001) %>% rowSums(na.rm = TRUE))
clusts_plus_bleach <- clusts_plus_bleach %>%
    mutate(Xthree = dplyr::select(., X1.251:X1.801) %>% rowSums(na.rm = TRUE))
clusts_plus_bleach <- clusts_plus_bleach %>%
    mutate(Xfour = dplyr::select(., X2.001:X2.801) %>% rowSums(na.rm = TRUE))
clusts_plus_bleach <- clusts_plus_bleach %>%
    mutate(Xthreefour = dplyr::select(., X1.251:X2.801) %>% rowSums(na.rm = TRUE))
clusts_plus_bleach <- clusts_plus_bleach %>%
    mutate(Xfive = dplyr::select(., X3.001:X3.301) %>% rowSums(na.rm = TRUE))
clusts_plus_bleach <- clusts_plus_bleach %>%
    mutate(X6to9 = dplyr::select(., X3.501:X5.001) %>% rowSums(na.rm = TRUE))
clusts_plus_bleach <- clusts_plus_bleach %>%
    mutate(X5to10 = dplyr::select(., X3.001:X5.501) %>% rowSums(na.rm = TRUE))
clusts_plus_bleach <- clusts_plus_bleach %>%
    mutate(Xover10 = dplyr::select(., X6.001:X999.501) %>% rowSums(na.rm = TRUE))
clusts_plus_bleach <- clusts_plus_bleach %>%
    mutate(X10to15 = dplyr::select(., X5.501:X8.001) %>% rowSums(na.rm = TRUE))
clusts_plus_bleach <- clusts_plus_bleach %>%
    mutate(Xover15 = dplyr::select(., X8.501:X999.501) %>% rowSums(na.rm = TRUE))
clusts_plus_bleach <- clusts_plus_bleach %>%
    mutate(X15to50 = dplyr::select(., X8.501:X25.001) %>% rowSums(na.rm = TRUE))
clusts_plus_bleach <- clusts_plus_bleach %>%
    mutate(Xover50 = dplyr::select(., X25.501:X999.501) %>% rowSums(na.rm = TRUE))
```


# Counting total clusters
```{r}
clusts_plus_bleach <- clusts_plus_bleach %>%
    mutate(X_50_100 = dplyr::select(., X25.501:X50.501) %>% rowSums(na.rm = TRUE))
clusts_plus_bleach <- clusts_plus_bleach %>%
    mutate(X_100_200 = dplyr::select(., X51.001:X100.501) %>% rowSums(na.rm = TRUE))
clusts_plus_bleach <- clusts_plus_bleach %>%
    mutate(X_200_300 = dplyr::select(., X101.001:X150.501) %>% rowSums(na.rm = TRUE))
clusts_plus_bleach <- clusts_plus_bleach %>%
    mutate(X_300_400 = dplyr::select(., X151.001:X200.501) %>% rowSums(na.rm = TRUE))
clusts_plus_bleach <- clusts_plus_bleach %>%
    mutate(X_400_500 = dplyr::select(., X201.001:X250.501) %>% rowSums(na.rm = TRUE))
clusts_plus_bleach <- clusts_plus_bleach %>%
    mutate(X_500_600 = dplyr::select(., X251.001:X300.501) %>% rowSums(na.rm = TRUE))
clusts_plus_bleach <- clusts_plus_bleach %>%
    mutate(X_600_700 = dplyr::select(., X301.001:X350.501) %>% rowSums(na.rm = TRUE))
clusts_plus_bleach <- clusts_plus_bleach %>%
    mutate(X_700_800 = dplyr::select(., X351.001:X400.501) %>% rowSums(na.rm = TRUE))
clusts_plus_bleach <- clusts_plus_bleach %>%
    mutate(X_800_900 = dplyr::select(., X401.001:X450.501) %>% rowSums(na.rm = TRUE))
clusts_plus_bleach <- clusts_plus_bleach %>%
    mutate(X_900_1000 = dplyr::select(., X451.001:X500.501) %>% rowSums(na.rm = TRUE))
clusts_plus_bleach <- clusts_plus_bleach %>%
    mutate(X_1000_1100 = dplyr::select(., X501.001:X550.501) %>% rowSums(na.rm = TRUE))
clusts_plus_bleach <- clusts_plus_bleach %>%
    mutate(X_1100_1200 = dplyr::select(., X551.001:X600.501) %>% rowSums(na.rm = TRUE))
clusts_plus_bleach <- clusts_plus_bleach %>%
    mutate(X_1200_1300 = dplyr::select(., X601.001:X650.501) %>% rowSums(na.rm = TRUE))
clusts_plus_bleach <- clusts_plus_bleach %>%
    mutate(X_1300_1400 = dplyr::select(., X651.001:X700.501) %>% rowSums(na.rm = TRUE))
clusts_plus_bleach <- clusts_plus_bleach %>%
    mutate(X_1400_1500 = dplyr::select(., X701.001:X750.501) %>% rowSums(na.rm = TRUE))
clusts_plus_bleach <- clusts_plus_bleach %>%
    mutate(X_1500_1600 = dplyr::select(., X751.001:X800.501) %>% rowSums(na.rm = TRUE))
clusts_plus_bleach <- clusts_plus_bleach %>%
    mutate(X_1600_1700 = dplyr::select(., X801.001:X850.501) %>% rowSums(na.rm = TRUE))
clusts_plus_bleach <- clusts_plus_bleach %>%
    mutate(X_1700_1800 = dplyr::select(., X851.001:X900.501) %>% rowSums(na.rm = TRUE))
clusts_plus_bleach <- clusts_plus_bleach %>%
    mutate(X_1800_1900 = dplyr::select(., X901.001:X950.501) %>% rowSums(na.rm = TRUE))
clusts_plus_bleach <- clusts_plus_bleach %>%
    mutate(X_1900_2000 = dplyr::select(., X951.001:X999.501) %>% rowSums(na.rm = TRUE))
```


# Counting total cells
```{r}
clusts_plus_bleach$hist_sum_one <- clusts_plus_bleach$Xone
clusts_plus_bleach$hist_sum_two <- 2*clusts_plus_bleach$Xtwo
clusts_plus_bleach$hist_sum_three <- 3*clusts_plus_bleach$Xthree
clusts_plus_bleach$hist_sum_four <- 4*clusts_plus_bleach$Xfour
clusts_plus_bleach$hist_sum_five <- 5*clusts_plus_bleach$Xfive
clusts_plus_bleach$hist_sum_6to9 <- 6*clusts_plus_bleach$X3.501 +
  7*clusts_plus_bleach$X4.001 +
  8*clusts_plus_bleach$X4.501 +
  9*clusts_plus_bleach$X5.001
clusts_plus_bleach$hist_sum_10to15 <- 10*clusts_plus_bleach$X5.501 +
  11*clusts_plus_bleach$X6.001 +
  12*clusts_plus_bleach$X6.501 +
  13*clusts_plus_bleach$X7.001 +
  14*clusts_plus_bleach$X7.501 +
  15*clusts_plus_bleach$X8.001
clusts_plus_bleach$hist_sum_over15 <- 16*clusts_plus_bleach$X8.501 +
  17*clusts_plus_bleach$X9.001 +
  18*clusts_plus_bleach$X9.501 +
  19*clusts_plus_bleach$X10.001 +
  20*clusts_plus_bleach$X10.501 +
  21*clusts_plus_bleach$X11.001 +
  22*clusts_plus_bleach$X11.501 +
  23*clusts_plus_bleach$X12.001 +
  24*clusts_plus_bleach$X12.501 +
  25*clusts_plus_bleach$X13.001 +
  26*clusts_plus_bleach$X13.501 +
  27*clusts_plus_bleach$X14.001 +
  28*clusts_plus_bleach$X14.501 +
  29*clusts_plus_bleach$X15.001 +
  30*clusts_plus_bleach$X15.501 +
  31*clusts_plus_bleach$X16.001 +
  32*clusts_plus_bleach$X16.501 +
  33*clusts_plus_bleach$X17.001 +
  34*clusts_plus_bleach$X17.501 +
  35*clusts_plus_bleach$X18.001 +
  36*clusts_plus_bleach$X18.501 +
  37*clusts_plus_bleach$X19.001 +
  38*clusts_plus_bleach$X19.501 +
  39*clusts_plus_bleach$X20.001 +
  40*clusts_plus_bleach$X20.501 +
  41*clusts_plus_bleach$X21.001 +
  42*clusts_plus_bleach$X21.501 +
  43*clusts_plus_bleach$X22.001 +
  44*clusts_plus_bleach$X22.501 +
  45*clusts_plus_bleach$X23.001 +
  46*clusts_plus_bleach$X23.501 +
  47*clusts_plus_bleach$X24.001 +
  48*clusts_plus_bleach$X24.501 +
  49*clusts_plus_bleach$X25.001 +
  75*clusts_plus_bleach$X_50_100 +
  150*clusts_plus_bleach$X_100_200 +
  250*clusts_plus_bleach$X_200_300 +
  350*clusts_plus_bleach$X_300_400 +
  450*clusts_plus_bleach$X_400_500 +
  550*clusts_plus_bleach$X_500_600 +
  650*clusts_plus_bleach$X_600_700 +
  750*clusts_plus_bleach$X_700_800 +
  850*clusts_plus_bleach$X_800_900 +
  950*clusts_plus_bleach$X_900_1000 +
  1050*clusts_plus_bleach$X_1000_1100 +
  1150*clusts_plus_bleach$X_1100_1200 +
  1250*clusts_plus_bleach$X_1200_1300 +
  1350*clusts_plus_bleach$X_1300_1400 +
  1450*clusts_plus_bleach$X_1400_1500 +
  1550*clusts_plus_bleach$X_1500_1600 +
  1650*clusts_plus_bleach$X_1600_1700 +
  1750*clusts_plus_bleach$X_1700_1800 +
  1850*clusts_plus_bleach$X_1800_1900 +
  1950*clusts_plus_bleach$X_1900_2000



clusts_plus_bleach$hist_sum <- 
  clusts_plus_bleach$Xone + 
  2*clusts_plus_bleach$Xtwo +
  3*clusts_plus_bleach$Xthree + 
  4*clusts_plus_bleach$Xfour +
  5*clusts_plus_bleach$Xfive +
  6*clusts_plus_bleach$X3.501 +
  7*clusts_plus_bleach$X4.001 +
  8*clusts_plus_bleach$X4.501 +
  9*clusts_plus_bleach$X5.001 +
  10*clusts_plus_bleach$X5.501 +
  11*clusts_plus_bleach$X6.001 +
  12*clusts_plus_bleach$X6.501 +
  13*clusts_plus_bleach$X7.001 +
  14*clusts_plus_bleach$X7.501 +
  15*clusts_plus_bleach$X8.001 +
  16*clusts_plus_bleach$X8.501 +
  17*clusts_plus_bleach$X9.001 +
  18*clusts_plus_bleach$X9.501 +
  19*clusts_plus_bleach$X10.001 +
  20*clusts_plus_bleach$X10.501 +
  21*clusts_plus_bleach$X11.001 +
  22*clusts_plus_bleach$X11.501 +
  23*clusts_plus_bleach$X12.001 +
  24*clusts_plus_bleach$X12.501 +
  25*clusts_plus_bleach$X13.001 +
  26*clusts_plus_bleach$X13.501 +
  27*clusts_plus_bleach$X14.001 +
  28*clusts_plus_bleach$X14.501 +
  29*clusts_plus_bleach$X15.001 +
  30*clusts_plus_bleach$X15.501 +
  31*clusts_plus_bleach$X16.001 +
  32*clusts_plus_bleach$X16.501 +
  33*clusts_plus_bleach$X17.001 +
  34*clusts_plus_bleach$X17.501 +
  35*clusts_plus_bleach$X18.001 +
  36*clusts_plus_bleach$X18.501 +
  37*clusts_plus_bleach$X19.001 +
  38*clusts_plus_bleach$X19.501 +
  39*clusts_plus_bleach$X20.001 +
  40*clusts_plus_bleach$X20.501 +
  41*clusts_plus_bleach$X21.001 +
  42*clusts_plus_bleach$X21.501 +
  43*clusts_plus_bleach$X22.001 +
  44*clusts_plus_bleach$X22.501 +
  45*clusts_plus_bleach$X23.001 +
  46*clusts_plus_bleach$X23.501 +
  47*clusts_plus_bleach$X24.001 +
  48*clusts_plus_bleach$X24.501 +
  49*clusts_plus_bleach$X25.001 +
  75*clusts_plus_bleach$X_50_100 +
  150*clusts_plus_bleach$X_100_200 +
  250*clusts_plus_bleach$X_200_300 +
  350*clusts_plus_bleach$X_300_400 +
  450*clusts_plus_bleach$X_400_500 +
  550*clusts_plus_bleach$X_500_600 +
  650*clusts_plus_bleach$X_600_700 +
  750*clusts_plus_bleach$X_700_800 +
  850*clusts_plus_bleach$X_800_900 +
  950*clusts_plus_bleach$X_900_1000 +
  1050*clusts_plus_bleach$X_1000_1100 +
  1150*clusts_plus_bleach$X_1100_1200 +
  1250*clusts_plus_bleach$X_1200_1300 +
  1350*clusts_plus_bleach$X_1300_1400 +
  1450*clusts_plus_bleach$X_1400_1500 +
  1550*clusts_plus_bleach$X_1500_1600 +
  1650*clusts_plus_bleach$X_1600_1700 +
  1750*clusts_plus_bleach$X_1700_1800 +
  1850*clusts_plus_bleach$X_1800_1900 +
  1950*clusts_plus_bleach$X_1900_2000

```

# Total cluster count
```{r}
clusts_plus_bleach$hist_count <- 
  clusts_plus_bleach$Xone + 
  clusts_plus_bleach$Xtwo +
  clusts_plus_bleach$Xthree + 
  clusts_plus_bleach$Xfour +
  clusts_plus_bleach$Xfive +
  clusts_plus_bleach$X3.501 +
  clusts_plus_bleach$X4.001 +
  clusts_plus_bleach$X4.501 +
  clusts_plus_bleach$X5.001 +
  clusts_plus_bleach$X5.501 +
  clusts_plus_bleach$X6.001 +
  clusts_plus_bleach$X6.501 +
  clusts_plus_bleach$X7.001 +
  clusts_plus_bleach$X7.501 +
  clusts_plus_bleach$X8.001 +
  clusts_plus_bleach$X8.501 +
  clusts_plus_bleach$X9.001 +
  clusts_plus_bleach$X9.501 +
  clusts_plus_bleach$X10.001 +
  clusts_plus_bleach$X10.501 +
  clusts_plus_bleach$X11.001 +
  clusts_plus_bleach$X11.501 +
  clusts_plus_bleach$X12.001 +
  clusts_plus_bleach$X12.501 +
  clusts_plus_bleach$X13.001 +
  clusts_plus_bleach$X13.501 +
  clusts_plus_bleach$X14.001 +
  clusts_plus_bleach$X14.501 +
  clusts_plus_bleach$X15.001 +
  clusts_plus_bleach$X15.501 +
  clusts_plus_bleach$X16.001 +
  clusts_plus_bleach$X16.501 +
  clusts_plus_bleach$X17.001 +
  clusts_plus_bleach$X17.501 +
  clusts_plus_bleach$X18.001 +
  clusts_plus_bleach$X18.501 +
  clusts_plus_bleach$X19.001 +
  clusts_plus_bleach$X19.501 +
  clusts_plus_bleach$X20.001 +
  clusts_plus_bleach$X20.501 +
  clusts_plus_bleach$X21.001 +
  clusts_plus_bleach$X21.501 +
  clusts_plus_bleach$X22.001 +
  clusts_plus_bleach$X22.501 +
  clusts_plus_bleach$X23.001 +
  clusts_plus_bleach$X23.501 +
  clusts_plus_bleach$X24.001 +
  clusts_plus_bleach$X24.501 +
  clusts_plus_bleach$X25.001 +
  clusts_plus_bleach$X_50_100 +
  clusts_plus_bleach$X_100_200 +
  clusts_plus_bleach$X_200_300 +
  clusts_plus_bleach$X_300_400 +
  clusts_plus_bleach$X_400_500 +
  clusts_plus_bleach$X_500_600 +
  clusts_plus_bleach$X_600_700 +
  clusts_plus_bleach$X_700_800 +
  clusts_plus_bleach$X_800_900 +
  clusts_plus_bleach$X_900_1000 +
  clusts_plus_bleach$X_1000_1100 +
  clusts_plus_bleach$X_1100_1200 +
  clusts_plus_bleach$X_1200_1300 +
  clusts_plus_bleach$X_1300_1400 +
  clusts_plus_bleach$X_1400_1500 +
  clusts_plus_bleach$X_1500_1600 +
  clusts_plus_bleach$X_1600_1700 +
  clusts_plus_bleach$X_1700_1800 +
  clusts_plus_bleach$X_1800_1900 +
  clusts_plus_bleach$X_1900_2000
```

# Subset dataset
```{r}
clusts_plus_bleach <- subset(clusts_plus_bleach, sample != 9785)
clusts_plus_bleach <- subset(clusts_plus_bleach, sample != 9793)

clusts_plus_bleach <- subset(clusts_plus_bleach, sample != 9879)
clusts_plus_bleach <- subset(clusts_plus_bleach, sample != 9905)

clusts_plus_bleach <- subset(clusts_plus_bleach, sample != 9562)
clusts_plus_bleach <- subset(clusts_plus_bleach, sample != 9987)
clusts_plus_bleach <- subset(clusts_plus_bleach, sample != 7705)
```



# melt data set to long form
```{r}

clusts_plus_long_bleach <- reshape2::melt(clusts_plus_bleach,
        # ID variables - all the variables to keep but not split apart on
    id.vars=c(1:18),
        # The source columns
        # Name of the destination column that will identify the original
        # column that the measurement came from
    variable.name="cluster_type",
    value.name="frequency"
)

```


# Subset into species and temperature specific datasets
```{r}
clusts_26A <- subset(clusts_plus_long_bleach, treatment == "A26")
clusts_26A <- subset(clusts_26A, (cluster_type %in% c("Xone","Xtwo","Xthreefour","X5to10","Xover10")))

clusts_26B <- subset(clusts_plus_long_bleach, treatment == "B26")
clusts_26B <- subset(clusts_26B, (cluster_type %in% c("Xone","Xtwo","Xthreefour","X5to10","Xover10")))

clusts_26C <- subset(clusts_plus_long_bleach, treatment == "C26")
clusts_26C <- subset(clusts_26C, (cluster_type %in% c("Xone","Xtwo","Xthreefour","X5to10","Xover10")))

clusts_32A <- subset(clusts_plus_long_bleach, treatment == "A32")
clusts_32A <- subset(clusts_32A, (cluster_type %in% c("Xone","Xtwo","Xthreefour","X5to10","Xover10")))

clusts_32B <- subset(clusts_plus_long_bleach, treatment == "B32")
clusts_32B <- subset(clusts_32B, (cluster_type %in% c("Xone","Xtwo","Xthreefour","X5to10","Xover10")))

clusts_32C <- subset(clusts_plus_long_bleach, treatment == "C32")
clusts_32C <- subset(clusts_32C, (cluster_type %in% c("Xone","Xtwo","Xthreefour","X5to10","Xover10")))
```

# Filtering inaccurate 3d counts
```{r}
clusts_32A <- subset(clusts_32A, sample != 9785)
clusts_32A <- subset(clusts_32A, sample != 9793)

clusts_32B <- subset(clusts_32B, sample != 9879)
clusts_32B <- subset(clusts_32B, sample != 9905)

clusts_26A <- subset(clusts_26A, sample != 9562)
clusts_26A <- subset(clusts_26A, sample != 9987)
clusts_26A <- subset(clusts_26A, sample != 7705)
clusts_26A <- subset(clusts_26A, sample != 8784)

#ggplot(data = clusts_26A, x = day, y = frequency, group = cluster_type) + #stat_summary()
```


# Subset datasets to common time measurements only
```{r}

#(plots only bleach and nonbleach comparisons)
clusts_32A <- subset(clusts_32A, day %in% c(4,7,9,11,14,16,18,21,25,31))
clusts_32B <- subset(clusts_32B, day %in% c(4,7,9,11,14,16,18,21,25,31))
clusts_32C <- subset(clusts_32C, day %in% c(4,7,9,11,14,16,18,21,25,31))

clusts_26A <- subset(clusts_26A, day %in% c(4,7,9,11,14,16,18,21,25,31))
clusts_26B <- subset(clusts_26B, day %in% c(4,7,9,11,14,16,18,21,25,31))
clusts_26C <- subset(clusts_26C, day %in% c(4,7,9,11,14,16,18,21,25,31))

```








# Data Visualization

```{r}
clusts_plus_bleach_cells_clusters <- subset(clusts_plus_bleach, day %in% c(4,7,9,11,14,16,18,21,25,31))
```

# Fig 4A: cells over time
```{r}
plot_cells_line_2 <- ggplot(clusts_plus_bleach_cells_clusters,aes(x=day,y=hist_sum,color=treatment, shape = treatment, linetype = treatment)) + stat_summary(fun.data=mean_se,position=position_dodge(2),geom="errorbar") +
    stat_summary(fun=mean,position=position_dodge(width=2),geom="line", alpha = 0.5) + stat_summary(fun=mean,position=position_dodge(width=2),geom="point") +
  theme_linedraw() +
  xlab("Days post inoculation") + ylab("Total # of cells per image-stack   ") +
  scale_shape_manual(values = c(16,21,18,23,17,24), name = "Treatment", labels = c("A26-A26","A26-A32","B26-B26","B26-B32","D26-D26","D26-D32")) +
  scale_color_manual(values = c("#DDAA33","#DDAA33", "#004488", "#004488","#BB5566","#BB5566"), name = "Treatment", labels = c("A26-A26","A26-A32","B26-B26","B26-B32","D26-D26","D26-D32")) +
  scale_fill_manual(values = c("#DDAA33","#DDAA33", "#004488", "#004488","#BB5566","#BB5566"), name = "Treatment", labels = c("A26-A26","A26-A32","B26-B26","B26-B32","D26-D26","D26-D32")) +
  scale_linetype_manual(values = c("solid","dashed","solid","dashed","solid","dashed"), name = "Treatment", labels = c("A26-A26","A26-A32","B26-B26","B26-B32","D26-D26","D26-D32")) + scale_x_continuous(limits=c(2,32), breaks = c(2,4,7,9,11,14,16,18,21,25,31)) +
  geom_vline(xintercept=c(13), linetype="dotted") +
  annotate("text", x = c(2), y = c(1260), label='underline("26˚C")', parse = T, hjust=0, vjust=0) +
  annotate("text", x = c(2), y = c(-100), label='underline("26˚C")', parse = T, hjust=0, vjust=0, color = "grey40") +
  annotate("text", x = c(14), y = c(1260), label='underline("26˚C")', parse = T, hjust=0, vjust=0) +
  annotate("text", x = c(14), y = c(-100), label='underline("32˚C")', parse = T, hjust=0, vjust=0, color = "grey40") +
  coord_cartesian(ylim = c(-50,1350)) +
  theme(panel.grid.minor.x = element_blank()) +
  geom_signif(y_position = c(670,670,870,770,1170,1320), 
              xmin = c(14,16,18,21,25,31),
              xmax = c(14,16,18,21,25,31), size = 0, textsize = 2.5,
              annotation = c("b"), tip_length = 0,color = "black")+
  geom_signif(y_position = c(290,320), 
              xmin = c(24.1,30.1),
              xmax = c(24.1,30.1), size = 0, textsize = 2.5,
              annotation = c("a"), tip_length = 0,color = "black") +
  geom_signif(y_position = c(100,145,138,138,145,285,505,485), 
              xmin = c(7.5,11.5,14.5,16.5,18.5,21.5,25.5,31.5),
              xmax = c(7.5,11.5,14.5,16.5,18.5,21.5,25.5,31.5), size = 0, textsize = 2.5,
              annotation = c("d"), tip_length = 0,color = "black") +
  theme(legend.position = "bottom", legend.box = "horizontal",
        legend.margin=margin(0,0,0,0), legend.box.margin=margin(-10,-10,-10,-10)) + 
  guides(fill=guide_legend(nrow=1),
         colour = guide_legend(nrow = 1),
         linetype = guide_legend(nrow = 1),
         shape = guide_legend(nrow = 1))
plot_cells_line_2
```

# plot clusters over time
```{r}
plot_clusters_line_2 <- ggplot(clusts_plus_bleach_cells_clusters,aes(x=day,y=hist_count,color=treatment, shape = treatment, linetype = treatment)) + stat_summary(fun.data=mean_se,position=position_dodge(2),geom="errorbar", width=2) +
    stat_summary(fun=mean,position=position_dodge(width=2),geom="line", alpha = 0.5, width = 2) + stat_summary(fun=mean,position=position_dodge(width=2),geom="point", width = 2) +
  theme_linedraw() +
  xlab("") + ylab("Total # of clusters per image-stack") +
  scale_shape_manual(values = c(16,21,18,23,17,24), name = "Treatment", labels = c("A26-A26","A26-A32","B26-B26","B26-B32","D26-D26","D26-D32")) +
  scale_color_manual(values = c("#DDAA33","#DDAA33", "#004488", "#004488","#BB5566","#BB5566"), name = "Treatment", labels = c("A26-A26","A26-A32","B26-B26","B26-B32","D26-D26","D26-D32")) +
  scale_fill_manual(values = c("black","grey40","black","grey40","black","grey40"), name = "Treatment", labels = c("A26-A26","A26-A32","B26-B26","B26-B32","D26-D26","D26-D32")) +
  scale_linetype_manual(values = c("solid","dashed","solid","dashed","solid","dashed"), name = "Treatment", labels = c("A26-A26","A26-A32","B26-B26","B26-B32","D26-D26","D26-D32")) + scale_x_continuous(limits=c(2,35), breaks = c(2,4,7,9,11,14,16,18,21,25,31)) +
  geom_vline(xintercept=c(13), linetype="dotted") +
  annotate("text", x = c(2), y = c(185), label='underline("26˚C")', parse = T, hjust=0, vjust=0) +
  annotate("text", x = c(2), y = c(-10), label='underline("26˚C")', parse = T, hjust=0, vjust=0, color="grey40") +
  annotate("text", x = c(14), y = c(185), label='underline("26˚C")', parse = T, hjust=0, vjust=0) +
  annotate("text", x = c(14), y = c(-10), label='underline("32˚C")', parse = T, hjust=0, vjust=0, color="grey40") +
  coord_cartesian(ylim = c(-5,190)) +
  theme(panel.grid.minor.x = element_blank()) +
  geom_signif(y_position = c(55,75,85,100,190,185), 
              xmin = c(14,16,18,21,25,31),
              xmax = c(14,16,18,21,25,31), size = 0, textsize = 2.5,
              annotation = c("b"), tip_length = 0,color = "black")+
  geom_signif(y_position = c(40,40), 
              xmin = c(24.2,30.2),
              xmax = c(24.2,30.2), size = 0, textsize = 2.5,
              annotation = c("a"), tip_length = 0,color = "black") +
  geom_signif(y_position = c(14,14,15,17,20,30,70,80), 
              xmin = c(7.5,11.5,14.5,16.5,18.5,21.5,25.5,31.5),
              xmax = c(7.5,11.5,14.5,16.5,18.5,21.5,25.5,31.5), size = 0, textsize = 2.5,
              annotation = c("d"), tip_length = 0,color = "black")
             
plot_clusters_line_2



```


```{r}
plot_cells_clusters_2 <- 
ggarrange(plot_cells_line_2,
          plot_clusters_line_2,
          labels = c("A","B"),
          nrow = 1, ncol = 2, common.legend = T, legend = "right")
plot_cells_clusters_2

```



# Figure 4C
# S. microadriaticum
```{r}
total_A_plot_26_32 <- ggplot(clusts_32A,aes(x=day,y=-frequency,fill=cluster_type)) + 
 
  stat_summary(fun.data=mean_se,position=position_dodge(1.75),geom="errorbar",color = "black", width=1.25) +
    stat_summary(fun=mean,position=position_dodge(width=1.75),geom="bar", color = "black", alpha = 0.5, width = 1.25) +
  stat_summary(data = clusts_26A, mapping = aes(x=day,y=frequency,fill=cluster_type), fun.data=mean_se,position=position_dodge(1.75),geom="errorbar",color = "black", width=1.25) +
    stat_summary(data = clusts_26A, mapping = aes(x=day,y=frequency,fill=cluster_type), fun=mean,position=position_dodge(width=1.75),geom="bar", color = "black", width = 1.25) +
  theme_linedraw() + 
scale_fill_manual(values = c("#000000", "#E69F00", "#56B4E9", "#009E73", 
                       "#F0E442", "#0072B2", "#D55E00", "#CC79A7"), name = "Cluster size (cells)", labels = c("1","2","3-4","5-10","over 10","","","")) + ylab("Mean # of \n clusters per image-stack") + scale_x_continuous(limits = c(0,100), breaks = c(0,2,4,7,9,11,14,16,18,21,25,31), minor_breaks = seq(0,100,1)) + xlab("") +
  scale_color_manual(values = c("black","purple"))+ theme(legend.position="bottom") + guides(fill = guide_legend(nrow=1, byrow=TRUE)) + coord_cartesian(xlim = c(2.75,31.25),ylim =c(-7,21)) + 
  scale_y_continuous(breaks=seq(-120,120,by=10),labels=abs(seq(-120,120,by=10))) +
  annotate("text", x = c(0), y = c(105), label="", hjust=0, vjust=0, fontface = "italic") + scale_alpha(guide = "none") + scale_color_manual(values = c("black","purple"), guide = "none") + 
      geom_vline(xintercept=c(13), linetype="dotted") +
  annotate("text", x = c(2), y = c(17), label='underline("26˚C")', parse = T, hjust=0, vjust=0) +
  annotate("text", x = c(2), y = c(-7), label='underline("26˚C")', parse = T, hjust=0, vjust=0) +
  annotate("text", x = c(11.6), y = c(17), label='underline("26˚C")', parse = T, hjust=0, vjust=0) +
  annotate("text", x = c(11.6), y = c(-7), label='underline("32˚C")', parse = T, hjust=0, vjust=0) +
  geom_hline(yintercept=c(0)) +
  annotate("text", x = c(2), y = c(12), label="S. microadriaticum", hjust=0, vjust=0, fontface = "italic") +
    geom_signif(y_position = c(-4), 
              xmin = c(30),
              xmax = c(31.6), size = 0.5,
              annotation = c(""), tip_length = -0.002,color = "black") +
  annotate("text", x = c(17.7), y = c(-4), label="**")  +

    annotate("text", x = c(24.65), y = c(-5), label="*")  +
  annotate("text", x = c(25), y = c(-6), label="**")  +

  annotate("text", x = c(31), y = c(-7), label="*") +
    annotate("text", x = c(31.9), y = c(-2), label="NS", size = 2.5) 
total_A_plot_26_32
```

# Figure 4D
# D trenchii 
```{r}
total_D_plot_26_32 <- ggplot(clusts_32C,aes(x=day,y=-frequency,fill=cluster_type)) + 
 
  stat_summary(fun.data=mean_se,position=position_dodge(1.75),geom="errorbar",color = "black", width=1.25) +
    stat_summary(fun=mean,position=position_dodge(width=1.75),geom="bar", color = "black", alpha = 0.5, width = 1.25) +
  stat_summary(data = clusts_26C, mapping = aes(x=day,y=frequency,fill=cluster_type), fun.data=mean_se,position=position_dodge(1.75),geom="errorbar",color = "black", width=1.25) +
    stat_summary(data = clusts_26C, mapping = aes(x=day,y=frequency,fill=cluster_type), fun=mean,position=position_dodge(width=1.75),geom="bar", color = "black", width = 1.25) +
  theme_linedraw() + 
scale_fill_manual(values = c("#000000", "#E69F00", "#56B4E9", "#009E73", 
                       "#F0E442", "#0072B2", "#D55E00", "#CC79A7"), name = "Cluster size (cells)", labels = c("1","2","3-4","5-10","over 10")) + ylab("Mean # of clusters \n per image-stack") + scale_x_continuous(limits = c(0,100), breaks = c(0,2,4,7,9,11,14,16,18,21,25,31), minor_breaks = seq(0,100,1)) + xlab("Days post inoculation") +
  scale_color_manual(values = c("black","purple"))+ theme(legend.position="bottom") + guides(fill = guide_legend(nrow=1, byrow=TRUE)) + coord_cartesian(xlim = c(2.75,31.25),ylim =c(-5,35)) + 
  scale_y_continuous(breaks=seq(-120,120,by=10),labels=abs(seq(-120,120,by=10))) +
  annotate("text", x = c(0), y = c(105), label="", hjust=0, vjust=0, fontface = "italic") + scale_alpha(guide=FALSE) + scale_color_manual(values = c("black","purple"), guide=FALSE) + 
      geom_vline(xintercept=c(13), linetype="dotted") +
  annotate("text", x = c(2), y = c(32), label='underline("26˚C")', parse = T, hjust=0, vjust=0) +
  annotate("text", x = c(2), y = c(-5.5), label='underline("26˚C")', parse = T, hjust=0, vjust=0) +
  annotate("text", x = c(11.6), y = c(32), label='underline("26˚C")', parse = T, hjust=0, vjust=0) +
  annotate("text", x = c(11.6), y = c(-5.5), label='underline("32˚C")', parse = T, hjust=0, vjust=0) +
  geom_hline(yintercept=c(0)) +
  annotate("text", x = c(2), y = c(26), label="D. trenchii", hjust=0, vjust=0, fontface = "italic") +
      geom_signif(y_position = c(-3,-3,-3.5,-2,-2,-2), 
              xmin = c(13.5,15.5,17.5,20.5,24,30),
              xmax = c(14.2,16.2,18.2,21.7,25.8,31.8), size = 0.5,
              annotation = c(""), tip_length = -0.002,color = "black") +
  annotate("text", x = c(13.9), y = c(-5), label="**")  +
  annotate("text", x = c(15.9), y = c(-5), label="**")  +
  annotate("text", x = c(17.9), y = c(-5.5), label="**")  +
  annotate("text", x = c(21.1), y = c(-4), label="*")  +
    annotate("text", x = c(20.1), y = c(-3), label="NS", size = 2)  +
  annotate("text", x = c(6.9), y = c(10), label="**")  +
  annotate("text", x = c(31), y = c(-4), label="**")  +
    annotate("text", x = c(25), y = c(-4), label="**")  +
  annotate("text", x = c(10.9), y = c(8), label="**")  

total_D_plot_26_32
```

# Figure 4B
# B. minutum
```{r}
total_B_plot_26_32 <- ggplot(clusts_32B,aes(x=day,y=-frequency,fill=cluster_type)) + 
 
  stat_summary(fun.data=mean_se,position=position_dodge(1.75),geom="errorbar",color = "black", width=1.25) +
    stat_summary(fun=mean,position=position_dodge(width=1.75),geom="bar", color = "black", alpha = 0.5, width = 1.25) +
  stat_summary(data = clusts_26B, mapping = aes(x=day,y=frequency,fill=cluster_type), fun.data=mean_se,position=position_dodge(1.75),geom="errorbar",color = "black", width=1.25) +
    stat_summary(data = clusts_26B, mapping = aes(x=day,y=frequency,fill=cluster_type), fun=mean,position=position_dodge(width=1.75),geom="bar", color = "black", width = 1.25) +
  theme_linedraw() + 
scale_fill_manual(values = c("#000000", "#E69F00", "#56B4E9", "#009E73", 
                       "#F0E442", "#0072B2", "#D55E00", "#CC79A7"), name = "Cluster size (cells)", labels = c("1","2","3-4","5-10","over 10","","","")) + ylab("Mean # of clusters \n per image-stack") + scale_x_continuous(limits = c(0,100), breaks = c(0,2,4,7,9,11,14,16,18,21,25,31), minor_breaks = seq(0,100,1)) + xlab("") +
  scale_color_manual(values = c("black","purple"))+ theme(legend.position="bottom") + guides(fill = guide_legend(nrow=1, byrow=TRUE)) + coord_cartesian(xlim = c(2.75,31.25),ylim =c(-15,83)) + 
  scale_y_continuous(breaks=seq(-120,120,by=10),labels=abs(seq(-120,120,by=10))) +
  annotate("text", x = c(0), y = c(105), label="", hjust=0, vjust=0, fontface = "italic") + scale_alpha(guide=FALSE) + scale_color_manual(values = c("black","purple"), guide=FALSE) + 
      geom_vline(xintercept=c(13), linetype="dotted") +
  annotate("text", x = c(2), y = c(80), label='underline("26˚C")', parse = T, hjust=0, vjust=0) +
  annotate("text", x = c(2), y = c(-18), label='underline("32˚C")', parse = T, hjust=0, vjust=0) +
  annotate("text", x = c(14), y = c(80), label='underline("26˚C")', parse = T, hjust=0, vjust=0) +
  annotate("text", x = c(14), y = c(-18), label='underline("32˚C")', parse = T, hjust=0, vjust=0) +
  geom_hline(yintercept=c(0)) +
  annotate("text", x = c(32), y = c(-18), label="B. minutum", hjust=1, vjust=0, fontface = "italic") +
    geom_signif(y_position = c(-7.5,-9), 
              xmin = c(13.22,13.6),
              xmax = c(13.22,13.6), size = 0, textsize = 2.5,
              annotation = c("NS"), tip_length = 0,color = "black") +
    geom_signif(y_position = c(-7,-5,-5,-5,-5,-5), 
              xmin = c(14,15.2,17.2,20.2,24.2,30.2),
              xmax = c(14.8,16.8,18.8,21.8,25.8,31.8), size = 0.5,
              annotation = c(""), tip_length = -0.005,color = "black") +
  annotate("text", x = c(14.4), y = c(-13), label='bold("***")', parse = T, hjust=0.5, vjust=0, fontface = "italic") +
  annotate("text", x = c(16), y = c(-12), label='bold("***")', parse = T, hjust=0.5, vjust=0, fontface = "italic") +
  annotate("text", x = c(18), y = c(-12), label='bold("***")', parse = T, hjust=0.5, vjust=0, fontface = "italic") +
  annotate("text", x = c(21), y = c(-12), label='bold("***")', parse = T, hjust=0.5, vjust=0, fontface = "italic") +
  annotate("text", x = c(25), y = c(-12), label='bold("***")', parse = T, hjust=0.5, vjust=0, fontface = "italic") +
  annotate("text", x = c(31), y = c(-12), label='bold("***")', parse = T, hjust=0.5, vjust=0, fontface = "italic") 





#plot_26a_one + geom_line(data=clusts_plus_one_plot, aes(x=day, y=hist_sum, fill = "grey"))

#plot_26a_one
total_B_plot_26_32
```

# Figure 4 Combined cluster plots
```{r}
plot_26_32_abd_clusts_2 <-
ggarrange(total_B_plot_26_32, 
          NULL, 
          total_A_plot_26_32, 
          NULL,
          total_D_plot_26_32, 
                       labels = c("B","","C","","D"),
                       ncol = 1, nrow = 5, common.legend = TRUE, legend = "bottom", heights = c(7,-0.3,2.5,-0.3, 3.5))
plot_26_32_abd_clusts_2
```
# Figure 4 full
```{r}
plot_26_32_abd_clusts_3 <-
ggarrange(plot_cells_line_2,
          NULL,
          plot_26_32_abd_clusts_2, 
                       labels = c("A","",""),
                       ncol = 1, nrow = 3, common.legend = FALSE, heights = c(4,0.1,12))
plot_26_32_abd_clusts_3

ggsave("plot_26_32_abd_clusts4.png", height = 12, width = 8.67)
```


# Setups for supplemental figures 4-6
```{r}
plot_cells_line_A_supp <- ggplot(subset(clusts_plus_bleach_cells_clusters, treatment == "A26"),aes(x=day,y=hist_sum,color=anemone, shape = anemone, linetype = anemone)) +
    stat_summary(fun=mean,position=position_dodge(width=1),geom="line", alpha = 0.5, width = 1) + stat_summary(fun=mean,position=position_dodge(width=1),geom="point", width = 1) +
  theme_linedraw() +
  xlab("Days post inoculation") + ylab("Total # of cells \n per image-stack") +
  scale_shape_manual(values = c(16,21,18,23,17,24,16,21,18,23,17,24), name = "Anemone", labels = c("1","2","3","4","5","6","7","8","9","10","11","12")) +
  scale_color_manual(values = c("#EBAC23","#B80058","#008CF9","#006E00","#D163E6","#B24502","#FF9287","#5954D6","#00C6F8","#878500","#00A76C","#BDBDBD"), name = "Anemone", labels = c("1","2","3","4","5","6","7","8","9","10","11","12"))+
  scale_fill_manual(values = c("#EBAC23","#B80058","#008CF9","#006E00","#D163E6","#B24502","#FF9287","#5954D6","#00C6F8","#878500","#00A76C","#BDBDBD"), name = "Anemone", labels = c("1","2","3","4","5","6","7","8","9","10","11","12")) +
  scale_linetype_manual(values = c("solid","dashed","solid","dashed","solid","dashed","solid","dashed","solid","dashed","solid","dashed"), name = "Anemone", labels = c("1","2","3","4","5","6","7","8","9","10","11","12")) + scale_x_continuous(limits=c(0,32), breaks = c(2,4,7,9,11,14,16,18,21,25,31)) +
  geom_vline(xintercept=c(13), linetype="dotted") +
  annotate("text", x = c(2), y = c(1260), label='underline("26˚C")', parse = T, hjust=0, vjust=0) +
  annotate("text", x = c(14), y = c(1260), label='underline("26˚C")', parse = T, hjust=0, vjust=0) +

  coord_cartesian(ylim = c(-50,1300)) +
  theme(panel.grid.minor.x = element_blank()) 
  theme(legend.position = "bottom", legend.box = "horizontal",
        legend.margin=margin(0,0,0,0), legend.box.margin=margin(-10,-10,-10,-10)) + 
  guides(fill=guide_legend(nrow=1),
         colour = guide_legend(nrow = 1),
         linetype = guide_legend(nrow = 1),
         shape = guide_legend(nrow = 1))
plot_cells_line_A_supp

plot_cells_line_A_supp_32 <- ggplot(subset(clusts_plus_bleach_cells_clusters, treatment == "A32"),aes(x=day,y=hist_sum,color=anemone, shape = anemone, linetype = anemone)) +
    stat_summary(fun=mean,position=position_dodge(width=1),geom="line", alpha = 0.5, width = 1) + stat_summary(fun=mean,position=position_dodge(width=1),geom="point", width = 1) +
  theme_linedraw() +
  xlab("Days post inoculation") + ylab("Total # of cells \n per image-stack") +
  scale_shape_manual(values = c(16,21,18,23,17,24,16,21,18,23,17,24), name = "Anemone", labels = c("1","2","3","4","5","6","7","8","9","10","11","12")) +
  scale_color_manual(values = c("#EBAC23","#B80058","#008CF9","#006E00","#D163E6","#B24502","#FF9287","#5954D6","#00C6F8","#878500","#00A76C","#BDBDBD"), name = "Anemone", labels = c("1","2","3","4","5","6","7","8","9","10","11","12"))+
  scale_fill_manual(values = c("#EBAC23","#B80058","#008CF9","#006E00","#D163E6","#B24502","#FF9287","#5954D6","#00C6F8","#878500","#00A76C","#BDBDBD"), name = "Anemone", labels = c("1","2","3","4","5","6","7","8","9","10","11","12")) +
  scale_linetype_manual(values = c("solid","dashed","solid","dashed","solid","dashed","solid","dashed","solid","dashed","solid","dashed"), name = "Anemone", labels = c("1","2","3","4","5","6","7","8","9","10","11","12")) + scale_x_continuous(limits=c(0,32), breaks = c(2,4,7,9,11,14,16,18,21,25,31)) +
  geom_vline(xintercept=c(13), linetype="dotted") +
  annotate("text", x = c(2), y = c(1260), label='underline("26˚C")', parse = T, hjust=0, vjust=0) +
  annotate("text", x = c(14), y = c(1260), label='underline("32˚C")', parse = T, hjust=0, vjust=0) +

  coord_cartesian(ylim = c(-50,1300)) +
  theme(panel.grid.minor.x = element_blank()) 
  theme(legend.position = "bottom", legend.box = "horizontal",
        legend.margin=margin(0,0,0,0), legend.box.margin=margin(-10,-10,-10,-10)) + 
  guides(fill=guide_legend(nrow=1),
         colour = guide_legend(nrow = 1),
         linetype = guide_legend(nrow = 1),
         shape = guide_legend(nrow = 1))
plot_cells_line_A_supp_32

```

```{r}
plot_cells_line_B_supp <- ggplot(subset(clusts_plus_bleach_cells_clusters, treatment == "B26"),aes(x=day,y=hist_sum,color=anemone, shape = anemone, linetype = anemone)) + 
    stat_summary(fun=mean,position=position_dodge(width=1),geom="line", alpha = 0.5, width = 1) + stat_summary(fun=mean,position=position_dodge(width=1),geom="point", width = 1) +
  theme_linedraw() +
  xlab("Days post inoculation") + ylab("Total # of cells \n per image-stack") +
  scale_shape_manual(values = c(16,21,18,23,17,24,16,21,18,23,17,24), name = "Anemone", labels = c("1","2","3","4","5","6","7","8","9","10","11","12")) +
  scale_color_manual(values = c("#EBAC23","#B80058","#008CF9","#006E00","#D163E6","#B24502","#FF9287","#5954D6","#00C6F8","#878500","#00A76C","#BDBDBD"), name = "Anemone", labels = c("1","2","3","4","5","6","7","8","9","10","11","12"))+
  scale_fill_manual(values = c("#EBAC23","#B80058","#008CF9","#006E00","#D163E6","#B24502","#FF9287","#5954D6","#00C6F8","#878500","#00A76C","#BDBDBD"), name = "Anemone", labels = c("1","2","3","4","5","6","7","8","9","10","11","12")) +
  scale_linetype_manual(values = c("solid","dashed","solid","dashed","solid","dashed","solid","dashed","solid","dashed","solid","dashed"), name = "Anemone", labels = c("1","2","3","4","5","6","7","8","9","10","11","12")) + scale_x_continuous(limits=c(0,32), breaks = c(2,4,7,9,11,14,16,18,21,25,31)) +
  geom_vline(xintercept=c(13), linetype="dotted") +
  annotate("text", x = c(2), y = c(1900), label='underline("26˚C")', parse = T, hjust=0, vjust=0) +
  annotate("text", x = c(14), y = c(1900), label='underline("26˚C")', parse = T, hjust=0, vjust=0) +

  coord_cartesian(ylim = c(-50,2000)) +
  theme(panel.grid.minor.x = element_blank()) 
  theme(legend.position = "bottom", legend.box = "horizontal",
        legend.margin=margin(0,0,0,0), legend.box.margin=margin(-10,-10,-10,-10)) + 
  guides(fill=guide_legend(nrow=1),
         colour = guide_legend(nrow = 1),
         linetype = guide_legend(nrow = 1),
         shape = guide_legend(nrow = 1))
plot_cells_line_B_supp

plot_cells_line_B_supp_32 <- ggplot(subset(clusts_plus_bleach_cells_clusters, treatment == "B32"),aes(x=day,y=hist_sum,color=anemone, shape = anemone, linetype = anemone)) + 
    stat_summary(fun=mean,position=position_dodge(width=1),geom="line", alpha = 0.5, width = 1) + stat_summary(fun=mean,position=position_dodge(width=1),geom="point", width = 1) +
  theme_linedraw() +
  xlab("Days post inoculation") + ylab("Total # of cells \n per image-stack") +
  scale_shape_manual(values = c(16,21,18,23,17,24,16,21,18,23,17,24), name = "Anemone", labels = c("1","2","3","4","5","6","7","8","9","10","11","12")) +
  scale_color_manual(values = c("#EBAC23","#B80058","#008CF9","#006E00","#D163E6","#B24502","#FF9287","#5954D6","#00C6F8","#878500","#00A76C","#BDBDBD"), name = "Anemone", labels = c("1","2","3","4","5","6","7","8","9","10","11","12"))+
  scale_fill_manual(values = c("#EBAC23","#B80058","#008CF9","#006E00","#D163E6","#B24502","#FF9287","#5954D6","#00C6F8","#878500","#00A76C","#BDBDBD"), name = "Anemone", labels = c("1","2","3","4","5","6","7","8","9","10","11","12")) +
  scale_linetype_manual(values = c("solid","dashed","solid","dashed","solid","dashed","solid","dashed","solid","dashed","solid","dashed"), name = "Anemone", labels = c("1","2","3","4","5","6","7","8","9","10","11","12")) + scale_x_continuous(limits=c(0,32), breaks = c(2,4,7,9,11,14,16,18,21,25,31)) +
  geom_vline(xintercept=c(13), linetype="dotted") +
  annotate("text", x = c(2), y = c(1900), label='underline("26˚C")', parse = T, hjust=0, vjust=0) +
  annotate("text", x = c(14), y = c(1900), label='underline("32˚C")', parse = T, hjust=0, vjust=0) +

  coord_cartesian(ylim = c(-50,2000)) +
  theme(panel.grid.minor.x = element_blank()) 
  theme(legend.position = "bottom", legend.box = "horizontal",
        legend.margin=margin(0,0,0,0), legend.box.margin=margin(-10,-10,-10,-10)) + 
  guides(fill=guide_legend(nrow=1),
         colour = guide_legend(nrow = 1),
         linetype = guide_legend(nrow = 1),
         shape = guide_legend(nrow = 1))
plot_cells_line_B_supp_32

```

```{r}
plot_cells_line_D_supp <- ggplot(subset(clusts_plus_bleach_cells_clusters, treatment == "C26"),aes(x=day,y=hist_sum,color=anemone, shape = anemone, linetype = anemone)) +
    stat_summary(fun=mean,position=position_dodge(width=1),geom="line", alpha = 0.5, width = 1) + stat_summary(fun=mean,position=position_dodge(width=1),geom="point", width = 1) +
  theme_linedraw() +
  xlab("Days post inoculation") + ylab("Total # of cells \n per image-stack") +
  scale_shape_manual(values = c(16,21,18,23,17,24,16,21,18,23,17,24), name = "Anemone", labels = c("1","2","3","4","5","6","7","8","9","10","11","12")) +
  scale_color_manual(values = c("#EBAC23","#B80058","#008CF9","#006E00","#D163E6","#B24502","#FF9287","#5954D6","#00C6F8","#878500","#00A76C","#BDBDBD"), name = "Anemone", labels = c("1","2","3","4","5","6","7","8","9","10","11","12"))+
  scale_fill_manual(values = c("#EBAC23","#B80058","#008CF9","#006E00","#D163E6","#B24502","#FF9287","#5954D6","#00C6F8","#878500","#00A76C","#BDBDBD"), name = "Anemone", labels = c("1","2","3","4","5","6","7","8","9","10","11","12")) +
  scale_linetype_manual(values = c("solid","dashed","solid","dashed","solid","dashed","solid","dashed","solid","dashed","solid","dashed"), name = "Anemone", labels = c("1","2","3","4","5","6","7","8","9","10","11","12")) + scale_x_continuous(limits=c(0,32), breaks = c(2,4,7,9,11,14,16,18,21,25,31)) +
  geom_vline(xintercept=c(13), linetype="dotted") +
  annotate("text", x = c(2), y = c(1260), label='underline("26˚C")', parse = T, hjust=0, vjust=0) +
  annotate("text", x = c(14), y = c(1260), label='underline("26˚C")', parse = T, hjust=0, vjust=0) +

  coord_cartesian(ylim = c(-50,1300)) +
  theme(panel.grid.minor.x = element_blank()) 
  theme(legend.position = "bottom", legend.box = "horizontal",
        legend.margin=margin(0,0,0,0), legend.box.margin=margin(-10,-10,-10,-10)) + 
  guides(fill=guide_legend(nrow=1),
         colour = guide_legend(nrow = 1),
         linetype = guide_legend(nrow = 1),
         shape = guide_legend(nrow = 1))
plot_cells_line_D_supp

plot_cells_line_D_supp_32 <- ggplot(subset(clusts_plus_bleach_cells_clusters, treatment == "C32"),aes(x=day,y=hist_sum,color=anemone, shape = anemone, linetype = anemone)) +
    stat_summary(fun=mean,position=position_dodge(width=1),geom="line", alpha = 0.5, width = 1) + stat_summary(fun=mean,position=position_dodge(width=1),geom="point", width = 2) +
  theme_linedraw() +
  xlab("Days post inoculation") + ylab("Total # of cells \n per image-stack") +
  scale_shape_manual(values = c(16,21,18,23,17,24,16,21,18,23,17,24), name = "Anemone", labels = c("1","2","3","4","5","6","7","8","9","10","11","12")) +
  scale_color_manual(values = c("#EBAC23","#B80058","#008CF9","#006E00","#D163E6","#B24502","#FF9287","#5954D6","#00C6F8","#878500","#00A76C","#BDBDBD"), name = "Anemone", labels = c("1","2","3","4","5","6","7","8","9","10","11","12"))+
  scale_fill_manual(values = c("#EBAC23","#B80058","#008CF9","#006E00","#D163E6","#B24502","#FF9287","#5954D6","#00C6F8","#878500","#00A76C","#BDBDBD"), name = "Anemone", labels = c("1","2","3","4","5","6","7","8","9","10","11","12")) +
  scale_linetype_manual(values = c("solid","dashed","solid","dashed","solid","dashed","solid","dashed","solid","dashed","solid","dashed"), name = "Anemone", labels = c("1","2","3","4","5","6","7","8","9","10","11","12")) + scale_x_continuous(limits=c(0,32), breaks = c(2,4,7,9,11,14,16,18,21,25,31)) +
  geom_vline(xintercept=c(13), linetype="dotted") +
  annotate("text", x = c(2), y = c(1260), label='underline("26˚C")', parse = T, hjust=0, vjust=0) +
  annotate("text", x = c(14), y = c(1260), label='underline("32˚C")', parse = T, hjust=0, vjust=0) +

  coord_cartesian(ylim = c(-50,1300)) +
  theme(panel.grid.minor.x = element_blank()) 
  theme(legend.position = "bottom", legend.box = "horizontal",
        legend.margin=margin(0,0,0,0), legend.box.margin=margin(-10,-10,-10,-10)) + 
  guides(fill=guide_legend(nrow=1),
         colour = guide_legend(nrow = 1),
         linetype = guide_legend(nrow = 1),
         shape = guide_legend(nrow = 1))
plot_cells_line_D_supp_32

```

```{r}
plot_cells_line_A_supp_cluster <- ggplot(subset(clusts_plus_bleach_cells_clusters, treatment == "A26"),aes(x=day,y=hist_count,color=anemone, shape = anemone, linetype = anemone)) +
    stat_summary(fun=mean,position=position_dodge(width=1),geom="line", alpha = 0.5, width = 1) + stat_summary(fun=mean,position=position_dodge(width=1),geom="point", width = 1) +
  theme_linedraw() +
  xlab("Days post inoculation") + ylab("Total # of clusters \n per image-stack") +
  scale_shape_manual(values = c(16,21,18,23,17,24,16,21,18,23,17,24), name = "Anemone", labels = c("1","2","3","4","5","6","7","8","9","10","11","12")) +
  scale_color_manual(values = c("#EBAC23","#B80058","#008CF9","#006E00","#D163E6","#B24502","#FF9287","#5954D6","#00C6F8","#878500","#00A76C","#BDBDBD"), name = "Anemone", labels = c("1","2","3","4","5","6","7","8","9","10","11","12"))+
  scale_fill_manual(values = c("#EBAC23","#B80058","#008CF9","#006E00","#D163E6","#B24502","#FF9287","#5954D6","#00C6F8","#878500","#00A76C","#BDBDBD"), name = "Anemone", labels = c("1","2","3","4","5","6","7","8","9","10","11","12")) +
  scale_linetype_manual(values = c("solid","dashed","solid","dashed","solid","dashed","solid","dashed","solid","dashed","solid","dashed"), name = "Anemone", labels = c("1","2","3","4","5","6","7","8","9","10","11","12")) + scale_x_continuous(limits=c(0,32), breaks = c(2,4,7,9,11,14,16,18,21,25,31)) +
  geom_vline(xintercept=c(13), linetype="dotted") +
  annotate("text", x = c(2), y = c(190), label='underline("26˚C")', parse = T, hjust=0, vjust=0) +
  annotate("text", x = c(14), y = c(190), label='underline("26˚C")', parse = T, hjust=0, vjust=0) +

  coord_cartesian(ylim = c(-10,210)) +
  theme(panel.grid.minor.x = element_blank()) 
  theme(legend.position = "bottom", legend.box = "horizontal",
        legend.margin=margin(0,0,0,0), legend.box.margin=margin(-10,-10,-10,-10)) + 
  guides(fill=guide_legend(nrow=1),
         colour = guide_legend(nrow = 1),
         linetype = guide_legend(nrow = 1),
         shape = guide_legend(nrow = 1))
plot_cells_line_A_supp_cluster

plot_cells_line_A_supp_32_cluster <- ggplot(subset(clusts_plus_bleach_cells_clusters, treatment == "A32"),aes(x=day,y=hist_count,color=anemone, shape = anemone, linetype = anemone)) +
    stat_summary(fun=mean,position=position_dodge(width=1),geom="line", alpha = 0.5, width = 1) + stat_summary(fun=mean,position=position_dodge(width=1),geom="point", width = 1) +
  theme_linedraw() +
  xlab("Days post inoculation") + ylab("Total # of clusters \n per image-stack") +
  scale_shape_manual(values = c(16,21,18,23,17,24,16,21,18,23,17,24), name = "Anemone", labels = c("1","2","3","4","5","6","7","8","9","10","11","12")) +
  scale_color_manual(values = c("#EBAC23","#B80058","#008CF9","#006E00","#D163E6","#B24502","#FF9287","#5954D6","#00C6F8","#878500","#00A76C","#BDBDBD"), name = "Anemone", labels = c("1","2","3","4","5","6","7","8","9","10","11","12"))+
  scale_fill_manual(values = c("#EBAC23","#B80058","#008CF9","#006E00","#D163E6","#B24502","#FF9287","#5954D6","#00C6F8","#878500","#00A76C","#BDBDBD"), name = "Anemone", labels = c("1","2","3","4","5","6","7","8","9","10","11","12")) +
  scale_linetype_manual(values = c("solid","dashed","solid","dashed","solid","dashed","solid","dashed","solid","dashed","solid","dashed"), name = "Anemone", labels = c("1","2","3","4","5","6","7","8","9","10","11","12")) + scale_x_continuous(limits=c(0,32), breaks = c(2,4,7,9,11,14,16,18,21,25,31)) +
  geom_vline(xintercept=c(13), linetype="dotted") +
  annotate("text", x = c(2), y = c(190), label='underline("26˚C")', parse = T, hjust=0, vjust=0) +
  annotate("text", x = c(14), y = c(190), label='underline("32˚C")', parse = T, hjust=0, vjust=0) +

  coord_cartesian(ylim = c(-10,210)) +
  theme(panel.grid.minor.x = element_blank()) 
  theme(legend.position = "bottom", legend.box = "horizontal",
        legend.margin=margin(0,0,0,0), legend.box.margin=margin(-10,-10,-10,-10)) + 
  guides(fill=guide_legend(nrow=1),
         colour = guide_legend(nrow = 1),
         linetype = guide_legend(nrow = 1),
         shape = guide_legend(nrow = 1))
plot_cells_line_A_supp_32_cluster

```

```{r}
plot_cells_line_B_supp_cluster <- ggplot(subset(clusts_plus_bleach_cells_clusters, treatment == "B26"),aes(x=day,y=hist_count,color=anemone, shape = anemone, linetype = anemone)) + 
    stat_summary(fun=mean,position=position_dodge(width=1),geom="line", alpha = 0.5, width = 1) + stat_summary(fun=mean,position=position_dodge(width=1),geom="point", width = 1) +
  theme_linedraw() +
  xlab("Days post inoculation") + ylab("Total # of clusters \n per image-stack") +
  scale_shape_manual(values = c(16,21,18,23,17,24,16,21,18,23,17,24), name = "Anemone", labels = c("1","2","3","4","5","6","7","8","9","10","11","12")) +
  scale_color_manual(values = c("#EBAC23","#B80058","#008CF9","#006E00","#D163E6","#B24502","#FF9287","#5954D6","#00C6F8","#878500","#00A76C","#BDBDBD"), name = "Anemone", labels = c("1","2","3","4","5","6","7","8","9","10","11","12"))+
  scale_fill_manual(values = c("#EBAC23","#B80058","#008CF9","#006E00","#D163E6","#B24502","#FF9287","#5954D6","#00C6F8","#878500","#00A76C","#BDBDBD"), name = "Anemone", labels = c("1","2","3","4","5","6","7","8","9","10","11","12")) +
  scale_linetype_manual(values = c("solid","dashed","solid","dashed","solid","dashed","solid","dashed","solid","dashed","solid","dashed"), name = "Anemone", labels = c("1","2","3","4","5","6","7","8","9","10","11","12")) + scale_x_continuous(limits=c(0,32), breaks = c(2,4,7,9,11,14,16,18,21,25,31)) +
  geom_vline(xintercept=c(13), linetype="dotted") +
  annotate("text", x = c(2), y = c(380), label='underline("26˚C")', parse = T, hjust=0, vjust=0) +
  annotate("text", x = c(14), y = c(380), label='underline("26˚C")', parse = T, hjust=0, vjust=0) +

  coord_cartesian(ylim = c(-10,410)) +
  theme(panel.grid.minor.x = element_blank()) 
  theme(legend.position = "bottom", legend.box = "horizontal",
        legend.margin=margin(0,0,0,0), legend.box.margin=margin(-10,-10,-10,-10)) + 
  guides(fill=guide_legend(nrow=1),
         colour = guide_legend(nrow = 1),
         linetype = guide_legend(nrow = 1),
         shape = guide_legend(nrow = 1))
plot_cells_line_B_supp_cluster

plot_cells_line_B_supp_32_cluster <- ggplot(subset(clusts_plus_bleach_cells_clusters, treatment == "B32"),aes(x=day,y=hist_count,color=anemone, shape = anemone, linetype = anemone)) + 
    stat_summary(fun=mean,position=position_dodge(width=1),geom="line", alpha = 0.5, width = 1) + stat_summary(fun=mean,position=position_dodge(width=1),geom="point", width = 1) +
  theme_linedraw() +
  xlab("Days post inoculation") + ylab("Total # of clusters \n per image-stack") +
  scale_shape_manual(values = c(16,21,18,23,17,24,16,21,18,23,17,24), name = "Anemone", labels = c("1","2","3","4","5","6","7","8","9","10","11","12")) +
  scale_color_manual(values = c("#EBAC23","#B80058","#008CF9","#006E00","#D163E6","#B24502","#FF9287","#5954D6","#00C6F8","#878500","#00A76C","#BDBDBD"), name = "Anemone", labels = c("1","2","3","4","5","6","7","8","9","10","11","12"))+
  scale_fill_manual(values = c("#EBAC23","#B80058","#008CF9","#006E00","#D163E6","#B24502","#FF9287","#5954D6","#00C6F8","#878500","#00A76C","#BDBDBD"), name = "Anemone", labels = c("1","2","3","4","5","6","7","8","9","10","11","12")) +
  scale_linetype_manual(values = c("solid","dashed","solid","dashed","solid","dashed","solid","dashed","solid","dashed","solid","dashed"), name = "Anemone", labels = c("1","2","3","4","5","6","7","8","9","10","11","12")) + scale_x_continuous(limits=c(0,32), breaks = c(2,4,7,9,11,14,16,18,21,25,31)) +
  geom_vline(xintercept=c(13), linetype="dotted") +
  annotate("text", x = c(2), y = c(380), label='underline("26˚C")', parse = T, hjust=0, vjust=0) +
  annotate("text", x = c(14), y = c(380), label='underline("32˚C")', parse = T, hjust=0, vjust=0) +

  coord_cartesian(ylim = c(-10,410)) +
  theme(panel.grid.minor.x = element_blank()) 
  theme(legend.position = "bottom", legend.box = "horizontal",
        legend.margin=margin(0,0,0,0), legend.box.margin=margin(-10,-10,-10,-10)) + 
  guides(fill=guide_legend(nrow=1),
         colour = guide_legend(nrow = 1),
         linetype = guide_legend(nrow = 1),
         shape = guide_legend(nrow = 1))
plot_cells_line_B_supp_32_cluster

```

```{r}
plot_cells_line_D_supp_cluster <- ggplot(subset(clusts_plus_bleach_cells_clusters, treatment == "C26"),aes(x=day,y=hist_count,color=anemone, shape = anemone, linetype = anemone)) +
    stat_summary(fun=mean,position=position_dodge(width=1),geom="line", alpha = 0.5, width = 1) + stat_summary(fun=mean,position=position_dodge(width=1),geom="point", width = 1) +
  theme_linedraw() +
  xlab("Days post inoculation") + ylab("Total # of clusters \n per image-stack") +
  scale_shape_manual(values = c(16,21,18,23,17,24,16,21,18,23,17,24), name = "Anemone", labels = c("1","2","3","4","5","6","7","8","9","10","11","12")) +
  scale_color_manual(values = c("#EBAC23","#B80058","#008CF9","#006E00","#D163E6","#B24502","#FF9287","#5954D6","#00C6F8","#878500","#00A76C","#BDBDBD"), name = "Anemone", labels = c("1","2","3","4","5","6","7","8","9","10","11","12"))+
  scale_fill_manual(values = c("#EBAC23","#B80058","#008CF9","#006E00","#D163E6","#B24502","#FF9287","#5954D6","#00C6F8","#878500","#00A76C","#BDBDBD"), name = "Anemone", labels = c("1","2","3","4","5","6","7","8","9","10","11","12")) +
  scale_linetype_manual(values = c("solid","dashed","solid","dashed","solid","dashed","solid","dashed","solid","dashed","solid","dashed"), name = "Anemone", labels = c("1","2","3","4","5","6","7","8","9","10","11","12")) + scale_x_continuous(limits=c(0,32), breaks = c(2,4,7,9,11,14,16,18,21,25,31)) +
  geom_vline(xintercept=c(13), linetype="dotted") +
  annotate("text", x = c(2), y = c(250), label='underline("26˚C")', parse = T, hjust=0, vjust=0) +
  annotate("text", x = c(14), y = c(250), label='underline("26˚C")', parse = T, hjust=0, vjust=0) +

  coord_cartesian(ylim = c(-10,270)) +
  theme(panel.grid.minor.x = element_blank()) 
  theme(legend.position = "bottom", legend.box = "horizontal",
        legend.margin=margin(0,0,0,0), legend.box.margin=margin(-10,-10,-10,-10)) + 
  guides(fill=guide_legend(nrow=1),
         colour = guide_legend(nrow = 1),
         linetype = guide_legend(nrow = 1),
         shape = guide_legend(nrow = 1))
plot_cells_line_D_supp_cluster

plot_cells_line_D_supp_32_cluster <- ggplot(subset(clusts_plus_bleach_cells_clusters, treatment == "C32"),aes(x=day,y=hist_count,color=anemone, shape = anemone, linetype = anemone)) +
    stat_summary(fun=mean,position=position_dodge(width=1),geom="line", alpha = 0.5, width = 1) + stat_summary(fun=mean,position=position_dodge(width=1),geom="point", width = 2) +
  theme_linedraw() +
  xlab("Days post inoculation") + ylab("Total # of clusters \n per image-stack") +
  scale_shape_manual(values = c(16,21,18,23,17,24,16,21,18,23,17,24), name = "Anemone", labels = c("1","2","3","4","5","6","7","8","9","10","11","12")) +
  scale_color_manual(values = c("#EBAC23","#B80058","#008CF9","#006E00","#D163E6","#B24502","#FF9287","#5954D6","#00C6F8","#878500","#00A76C","#BDBDBD"), name = "Anemone", labels = c("1","2","3","4","5","6","7","8","9","10","11","12"))+
  scale_fill_manual(values = c("#EBAC23","#B80058","#008CF9","#006E00","#D163E6","#B24502","#FF9287","#5954D6","#00C6F8","#878500","#00A76C","#BDBDBD"), name = "Anemone", labels = c("1","2","3","4","5","6","7","8","9","10","11","12")) +
  scale_linetype_manual(values = c("solid","dashed","solid","dashed","solid","dashed","solid","dashed","solid","dashed","solid","dashed"), name = "Anemone", labels = c("1","2","3","4","5","6","7","8","9","10","11","12")) + scale_x_continuous(limits=c(0,32), breaks = c(2,4,7,9,11,14,16,18,21,25,31)) +
  geom_vline(xintercept=c(13), linetype="dotted") +
  annotate("text", x = c(2), y = c(250), label='underline("26˚C")', parse = T, hjust=0, vjust=0) +
  annotate("text", x = c(14), y = c(250), label='underline("32˚C")', parse = T, hjust=0, vjust=0) +

  coord_cartesian(ylim = c(-10,270)) +
  theme(panel.grid.minor.x = element_blank()) 
  theme(legend.position = "bottom", legend.box = "horizontal",
        legend.margin=margin(0,0,0,0), legend.box.margin=margin(-10,-10,-10,-10)) + 
  guides(fill=guide_legend(nrow=1),
         colour = guide_legend(nrow = 1),
         linetype = guide_legend(nrow = 1),
         shape = guide_legend(nrow = 1))
plot_cells_line_D_supp_32_cluster

```

# Supp Fig 4,5,6

# Supp Fig 5: replicate S. micro data
```{r}
ggarrange(plot_cells_line_A_supp,
          plot_cells_line_A_supp_32,
          plot_cells_line_A_supp_cluster,
          plot_cells_line_A_supp_32_cluster,
          
          labels = c("A","B","C","D"),
                       ncol = 2, nrow = 2, common.legend = TRUE, legend = "bottom", heights = c(1,1,1,1))
  
ggsave("suppfig5.png", height = 7, width = 10)

```


# Supp Fig 4: replicate B. min data

```{r}
ggarrange(plot_cells_line_B_supp,
          plot_cells_line_B_supp_32,
          plot_cells_line_B_supp_cluster,
          plot_cells_line_B_supp_32_cluster,
          
          labels = c("A","B","C","D"),
                       ncol = 2, nrow = 2, common.legend = TRUE, legend = "bottom", heights = c(1,1,1,1))
  
ggsave("suppfig4.png", height = 7, width = 10)

```

# Supp Fig 6: replicate D. trenchii data

```{r}
ggarrange(plot_cells_line_D_supp,
          plot_cells_line_D_supp_32,
          plot_cells_line_D_supp_cluster,
          plot_cells_line_D_supp_32_cluster,
          
          labels = c("A","B","C","D"),
                       ncol = 2, nrow = 2, common.legend = TRUE, legend = "bottom", heights = c(1,1,1,1))
  
ggsave("suppfig6.png", height = 7, width = 10)

```


